<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—</title>
    <url>/2025/09/07/Chronyd-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%8E%92%E9%94%99%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="Chronyd-å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—"><a href="#Chronyd-å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—" class="headerlink" title="Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—"></a>Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li>Chronyd å®‰è£…ä¸é…ç½®</li>
<li>ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®</li>
<li>æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­</li>
<li>ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ</li>
<li>æ—¶åŒºé…ç½®</li>
</ol>
<hr>
<h2 id="1-Chronyd-å®‰è£…ä¸é…ç½®"><a href="#1-Chronyd-å®‰è£…ä¸é…ç½®" class="headerlink" title="1. Chronyd å®‰è£…ä¸é…ç½®"></a>1. Chronyd å®‰è£…ä¸é…ç½®</h2><h3 id="å®‰è£…-Chronyd"><a href="#å®‰è£…-Chronyd" class="headerlink" title="å®‰è£… Chronyd"></a>å®‰è£… Chronyd</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install chronyd -y</span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥æ—¶é—´åŒæ­¥æº"><a href="#æ£€æŸ¥æ—¶é—´åŒæ­¥æº" class="headerlink" title="æ£€æŸ¥æ—¶é—´åŒæ­¥æº"></a>æ£€æŸ¥æ—¶é—´åŒæ­¥æº</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chronyc sources -v</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯-Chronyd-æœåŠ¡çŠ¶æ€"><a href="#éªŒè¯-Chronyd-æœåŠ¡çŠ¶æ€" class="headerlink" title="éªŒè¯ Chronyd æœåŠ¡çŠ¶æ€"></a>éªŒè¯ Chronyd æœåŠ¡çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -nlap | grep 123  <span class="comment"># æŸ¥çœ‹ UDP ç«¯å£ï¼Œç¡®è®¤ chronyd å·²å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®"><a href="#2-ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®" class="headerlink" title="2. ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®"></a>2. ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®</h2><h3 id="æ£€æŸ¥-UDP-ç«¯å£è¿é€šæ€§"><a href="#æ£€æŸ¥-UDP-ç«¯å£è¿é€šæ€§" class="headerlink" title="æ£€æŸ¥ UDP ç«¯å£è¿é€šæ€§"></a>æ£€æŸ¥ UDP ç«¯å£è¿é€šæ€§</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ¡ˆ1ï¼šä½¿ç”¨ nmap</span></span><br><span class="line">nmap -sU 192.168.70.2 -p 123 -Pn</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ¡ˆ2ï¼šä½¿ç”¨ netcat</span></span><br><span class="line">nc -uvz 192.168.70.2 123</span><br></pre></td></tr></table></figure>

<h3 id="ç«¯å£çŠ¶æ€è¯´æ˜"><a href="#ç«¯å£çŠ¶æ€è¯´æ˜" class="headerlink" title="ç«¯å£çŠ¶æ€è¯´æ˜"></a>ç«¯å£çŠ¶æ€è¯´æ˜</h3><ul>
<li><strong>æ­£å¸¸çŠ¶æ€</strong>: <code>123/udp open ntp</code></li>
<li><strong>å¼‚å¸¸çŠ¶æ€</strong>: <code>123/udp open|filtered ntp</code> (è¡¨ç¤ºç«¯å£ä¸å¯ç”¨)</li>
</ul>
<h3 id="é…ç½®é˜²ç«å¢™è§„åˆ™-UFW-ç¤ºä¾‹"><a href="#é…ç½®é˜²ç«å¢™è§„åˆ™-UFW-ç¤ºä¾‹" class="headerlink" title="é…ç½®é˜²ç«å¢™è§„åˆ™ (UFW ç¤ºä¾‹)"></a>é…ç½®é˜²ç«å¢™è§„åˆ™ (UFW ç¤ºä¾‹)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é˜²ç«å¢™è§„åˆ™</span></span><br><span class="line">ufw status</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æ”¾ NTP æœåŠ¡æ‰€éœ€ç«¯å£</span></span><br><span class="line">ufw allow 123/udp</span><br><span class="line">ufw allow 323/udp</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­"><a href="#3-æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­" class="headerlink" title="3. æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­"></a>3. æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­</h2><h3 id="å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹"><a href="#å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹" class="headerlink" title="å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹"></a>å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ chrony æœåŠ¡çŠ¶æ€</span></span><br><span class="line">chronyc sources</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^? 192.168.70.2                  0   9     0     -     +0ns[   +0ns] +/-    0ns</span><br></pre></td></tr></table></figure>

<h3 id="æ­£å¸¸çŠ¶æ€ç¤ºä¾‹"><a href="#æ­£å¸¸çŠ¶æ€ç¤ºä¾‹" class="headerlink" title="æ­£å¸¸çŠ¶æ€ç¤ºä¾‹"></a>æ­£å¸¸çŠ¶æ€ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^* 192.168.70.2                 10   6    17     1    -12us[+23us] +/- 276us</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#4-ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>4. ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€"><a href="#æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€" class="headerlink" title="æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€"></a>æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">date</span>                    <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --show          <span class="comment"># æŸ¥çœ‹ç¡¬ä»¶æ—¶é’Ÿæ—¶é—´</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ"><a href="#ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ" class="headerlink" title="ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ"></a>ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿæ—¶é—´</span></span><br><span class="line">hwclock --<span class="built_in">set</span> --<span class="built_in">date</span> <span class="string">&#x27;2018-08-20 14:05:25&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ­¥ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --hctosys       <span class="comment"># ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --systohc       <span class="comment"># ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ—¶é’Ÿè®¾ç½®</span></span><br><span class="line">clock -w</span><br></pre></td></tr></table></figure>

<h3 id="é«˜çº§æ—¶é—´ç®¡ç†"><a href="#é«˜çº§æ—¶é—´ç®¡ç†" class="headerlink" title="é«˜çº§æ—¶é—´ç®¡ç†"></a>é«˜çº§æ—¶é—´ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€</span></span><br><span class="line">chronyc sourcestats -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³æ‰‹åŠ¨åŒæ­¥æ—¶é—´ï¼ˆé€‚ç”¨äºæ—¶é—´åå·®è¾ƒå¤§æ—¶ï¼‰</span></span><br><span class="line">chronyc -a makestep</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¡å‡†æ—¶é—´æœåŠ¡å™¨</span></span><br><span class="line">chronyc tracking</span><br></pre></td></tr></table></figure>

<h3 id="ç¡¬ä»¶æ—¶é’Ÿé…ç½®"><a href="#ç¡¬ä»¶æ—¶é’Ÿé…ç½®" class="headerlink" title="ç¡¬ä»¶æ—¶é’Ÿé…ç½®"></a>ç¡¬ä»¶æ—¶é’Ÿé…ç½®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ç¡¬ä»¶æ—¶é’Ÿé…ç½®</span></span><br><span class="line">timedatectl | grep <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨æœ¬åœ°æ—¶åŒº</span></span><br><span class="line">timedatectl set-local-rtc 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨ UTCï¼ˆæ¨èï¼‰</span></span><br><span class="line">timedatectl set-local-rtc 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ NTP æ—¶é—´åŒæ­¥</span></span><br><span class="line">timedatectl set-ntp <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-æ—¶åŒºé…ç½®"><a href="#5-æ—¶åŒºé…ç½®" class="headerlink" title="5. æ—¶åŒºé…ç½®"></a>5. æ—¶åŒºé…ç½®</h2><h3 id="æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä»-EST-æ”¹ä¸º-CSTï¼‰"><a href="#æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä»-EST-æ”¹ä¸º-CSTï¼‰" class="headerlink" title="æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä» EST æ”¹ä¸º CSTï¼‰"></a>æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä» EST æ”¹ä¸º CSTï¼‰</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½åŸæ—¶åŒºé…ç½®</span></span><br><span class="line"><span class="built_in">mv</span> /etc/localtime /etc/localtime.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸Šæµ·æ—¶åŒºï¼ˆä¸­å›½æ ‡å‡†æ—¶é—´ CSTï¼‰</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ•…éšœæ’é™¤æµç¨‹å›¾"><a href="#æ•…éšœæ’é™¤æµç¨‹å›¾" class="headerlink" title="æ•…éšœæ’é™¤æµç¨‹å›¾"></a>æ•…éšœæ’é™¤æµç¨‹å›¾</h2><ol>
<li><strong>æ—¶é—´ä¸åŒæ­¥</strong><ul>
<li>æ£€æŸ¥ <code>chronyc sources</code> è¾“å‡º</li>
<li>éªŒè¯ NTP ç«¯å£è¿é€šæ€§</li>
<li>ç¡®è®¤é˜²ç«å¢™é…ç½®</li>
</ul>
</li>
<li><strong>ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é—´ä¸ä¸€è‡´</strong><ul>
<li>ä½¿ç”¨ <code>hwclock --hctosys</code> æˆ– <code>hwclock --systohc</code> åŒæ­¥</li>
<li>æ£€æŸ¥æ—¶åŒºè®¾ç½®æ˜¯å¦æ­£ç¡®</li>
</ul>
</li>
<li><strong>æ—¶åŒºé”™è¯¯</strong><ul>
<li>ä½¿ç”¨ <code>timedatectl</code> æ£€æŸ¥å½“å‰æ—¶åŒº</li>
<li>é‡æ–°é“¾æ¥æ­£ç¡®çš„æ—¶åŒºæ–‡ä»¶</li>
</ul>
</li>
</ol>
<hr>
<h2 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨"><a href="#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨" class="headerlink" title="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨"></a>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</h2><table>
<thead>
<tr>
<th align="left">å‘½ä»¤</th>
<th align="left">åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>chronyc sources</code></td>
<td align="left">æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€</td>
</tr>
<tr>
<td align="left"><code>chronyc -a makestep</code></td>
<td align="left">ç«‹å³å¼ºåˆ¶æ—¶é—´åŒæ­¥</td>
</tr>
<tr>
<td align="left"><code>hwclock --hctosys</code></td>
<td align="left">ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´</td>
</tr>
<tr>
<td align="left"><code>hwclock --systohc</code></td>
<td align="left">ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</td>
</tr>
<tr>
<td align="left"><code>timedatectl set-local-rtc 1</code></td>
<td align="left">è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨æœ¬åœ°æ—¶åŒº</td>
</tr>
<tr>
<td align="left"><code>timedatectl set-ntp yes</code></td>
<td align="left">å¯ç”¨ NTP æ—¶é—´åŒæ­¥</td>
</tr>
</tbody></table>
<hr>
<p><strong>é€‚ç”¨ç³»ç»Ÿ</strong>: CentOS&#x2F;RHEL 7+ã€Ubuntu 16.04+</p>
<blockquote>
<p>æç¤ºï¼šç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®å°†ç¡¬ä»¶æ—¶é’Ÿè®¾ç½®ä¸º UTC (<code>timedatectl set-local-rtc 0</code>)ï¼Œå¹¶ç¡®ä¿é˜²ç«å¢™æ­£ç¡®é…ç½®å…è®¸ NTP æµé‡ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>chrony</tag>
      </tags>
  </entry>
  <entry>
    <title>ADPçš„å­¦ä¹ ä¹‹è·¯01</title>
    <url>/2025/09/19/ADP%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF01/</url>
    <content><![CDATA[<p>å‡è®¾ä½ çš„ç›®æ ‡æ˜¯ <strong>â€œåšä¸€é¡¿ä¸°ç››çš„æ™šé¤â€</strong>ï¼š</p>
<ul>
<li><strong>åªç”¨ RAGï¼š</strong> ä½ é—®å®ƒâ€œçº¢çƒ§è‚‰æ€ä¹ˆåšï¼Ÿâ€ï¼Œå®ƒå»ç¿»èœè°±ï¼Œç„¶åç»™ä½ ä¸€ä¸ªæœ€æ­£å®—çš„åšæ³•ã€‚ä½†å®ƒä¸ä¼šåŠ¨æ‰‹åšã€‚</li>
<li><strong>åªç”¨ Workflowï¼š</strong> ä½ è®¾ç½®å¥½ä¸€ä¸ªæµç¨‹ï¼š1. æ´—èœ -&gt; 2. åˆ‡èœ -&gt; 3. ç‚’èœ -&gt; 4. è£…ç›˜ã€‚å®ƒä¼šæŠŠæ¯ä¸€æ­¥éƒ½è‡ªåŠ¨åŒ–æ‰§è¡Œï¼Œä½†å¦‚æœä½ çªç„¶æƒ³æ”¹åšæ¸…è’¸é±¼ï¼Œæ•´ä¸ªæµç¨‹å°±å¾—é‡å†™ã€‚</li>
<li><strong>ä½¿ç”¨ Agentï¼š</strong> ä½ ç›´æ¥å‘Šè¯‰å®ƒâ€œæˆ‘é¥¿äº†ï¼Œæƒ³åšç‚¹å¥½åƒçš„ï¼Œå†°ç®±é‡Œæœ‰æ’éª¨å’ŒåœŸè±†â€ã€‚å®ƒä¼šè‡ªå·±å†³å®šæ˜¯åšç³–é†‹æ’éª¨è¿˜æ˜¯åœŸè±†çƒ§æ’éª¨ï¼Œç„¶åè‡ªå·±å»æœç´¢åšæ³•ï¼Œæ§åˆ¶ç‚’èœæœºã€ç”µé¥­ç…²ç­‰å·¥å…·ï¼Œæœ€åæŠŠèœç«¯åˆ°ä½ é¢å‰ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ™ºèƒ½ä½“</category>
      </categories>
      <tags>
        <tag>ADP</tag>
      </tags>
  </entry>
  <entry>
    <title>ETCDåŸºæœ¬ä½¿ç”¨åŠé—®é¢˜å¤„ç†01</title>
    <url>/2025/09/11/ETCD%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%8601/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.æ‹·è´etcdå‘½ä»¤å¹¶æŒ‡å®šå¹¶ä½¿ç”¨etcdctlv3çš„ç‰ˆæœ¬</span><br><span class="line"><span class="built_in">which</span> etcdctl || docker <span class="built_in">cp</span> $(docker ps | grep  etcd-10 | grep -v pause | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>):/usr/local/bin/etcdctl  /usr/local/bin/</span><br><span class="line"><span class="built_in">export</span> ETCDCTL_API=3</span><br><span class="line">2.æŸ¥è¯¢etcd member</span><br><span class="line">etcdctl --endpoints=https://127.0.0.1:2379  --cacert=/etc/kubernetes/pki/etcd/ca.crt  --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key  member list --write-out=table</span><br><span class="line">3.æŸ¥è¯¢etcd leader</span><br><span class="line">etcdctl  --endpoints=10.0.3.1xx:2379,10.0.3.1yy:2379,10.0.3.2zz:2379  --cacert=/etc/kubernetes/pki/etcd/ca.crt  --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key  endpoint status --write-out=table</span><br><span class="line">3.æ£€æŸ¥æ¯ä¸ªendpointçš„å¥åº·çŠ¶å†µï¼Œä¸»å¤‡å‡æ­£å¸¸ï¼Œendpointså¡«ä¸Šé¢åˆ—å‡ºçš„æ¯æ¡<span class="string">&quot;CLIENT ADDRS&quot;</span>ä¸­çš„IP:PORT</span><br><span class="line">etcdctl --endpoints=10.30.2.8:2379,10.30.2.7:2379,10.30.2.6:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key endpoint health --write-out=table</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ä¸­é—´</category>
      </categories>
      <tags>
        <tag>ETCD</tag>
      </tags>
  </entry>
  <entry>
    <title>ESåŸºæœ¬ä½¿ç”¨åŠé—®é¢˜å¤„ç†01</title>
    <url>/2025/09/08/ES%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%8601/</url>
    <content><![CDATA[<p>é¡¹ç›®é—®é¢˜1ï¼šä¸šåŠ¡è¿›è¡Œå‹æµ‹ï¼Œåé¢é€ æˆESæ•°æ®æ»¡äº†ï¼Œæœ‰90%å‘Šè­¦ã€‚é’ˆå¯¹è¯¥æƒ…å†µéœ€è¦æ¸…ç†ESï¼Œæ•°æ®å¯ä»¥æ­£å¸¸å†™å…¥ã€‚</p>
<h3 id="æ¸…ç†æ•°æ®"><a href="#æ¸…ç†æ•°æ®" class="headerlink" title="æ¸…ç†æ•°æ®"></a>æ¸…ç†æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -I -m 10 -o /dev/null -s -w %&#123;http_code&#125; -X GET <span class="string">&quot;<span class="variable">$&#123;dst_es_schema&#125;</span>://<span class="variable">$&#123;dst_es_user&#125;</span>:<span class="variable">$&#123;dst_es_passwd&#125;</span>@<span class="variable">$&#123;dst_es_host&#125;</span>:<span class="variable">$&#123;dst_es_port&#125;</span>/_cluster/health?pretty&quot;</span></span><br><span class="line"><span class="comment"># å¦‚éœ€ç”¨æˆ·åä¸å¯†ç åˆ™éœ€ curl -u xxx:&#x27;xxx&#x27;, å¯†ç æœ‰ç‰¹æ®Šå­—ç¬¦å¯ç”¨å•å¼•å·</span></span><br><span class="line">curl 10.25.83.242:9200/_cluster/health?pretty <span class="comment">#æŸ¥çœ‹ç›‘æ§</span></span><br><span class="line">curl 10.25.83.242:9200/_cat/indices?v |grep gb <span class="comment">#æŸ¥çœ‹æ•°æ®</span></span><br><span class="line">curl -XDELETE 10.25.83.242:9200/xxxxx <span class="comment">#åˆ é™¤æ•°æ®</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ•°æ®æ¸…ç†è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">index_prefix=tsf</span><br><span class="line">es_url=<span class="variable">$1</span></span><br><span class="line">es_port=<span class="variable">$2</span></span><br><span class="line">es_user=<span class="variable">$3</span></span><br><span class="line">es_pass=<span class="variable">$4</span></span><br><span class="line">ttl_date=2</span><br><span class="line"></span><br><span class="line">current=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y/%m/%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">date2stamp</span></span> () &#123;</span><br><span class="line">    <span class="built_in">date</span> --utc --<span class="built_in">date</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> +%s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">dateDiff</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        -s)   sec=1;      <span class="built_in">shift</span>;;</span><br><span class="line">        -m)   sec=60;     <span class="built_in">shift</span>;;</span><br><span class="line">        -h)   sec=3600;   <span class="built_in">shift</span>;;</span><br><span class="line">        -d)   sec=86400;  <span class="built_in">shift</span>;;</span><br><span class="line">        *)    sec=86400;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    dte1=$(date2stamp <span class="variable">$1</span>)</span><br><span class="line">    dte2=$(date2stamp <span class="variable">$2</span>)</span><br><span class="line">    diffSec=$((dte2-dte1))</span><br><span class="line">    <span class="keyword">if</span> ((diffSec &lt; <span class="number">0</span>)); <span class="keyword">then</span> abs=-1; <span class="keyword">else</span> abs=1; <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> $((diffSec/sec*abs))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$es_url</span> == *<span class="string">&quot;:&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">  indices=$(curl -s -u <span class="string">&quot;<span class="variable">$&#123;es_user&#125;</span>&quot;</span>:<span class="string">&quot;<span class="variable">$&#123;es_pass&#125;</span>&quot;</span> -6 -g <span class="string">&quot;[<span class="variable">$&#123;es_url&#125;</span>]:<span class="variable">$&#123;es_port&#125;</span>/_cat/indices?v&amp;s=index&quot;</span> | grep -E <span class="string">&quot;<span class="variable">$&#123;index_prefix&#125;</span>-*&quot;</span> | grep -v <span class="string">&quot;tsf-oss&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  indices=$(curl -s -u <span class="string">&quot;<span class="variable">$&#123;es_user&#125;</span>&quot;</span>:<span class="string">&quot;<span class="variable">$&#123;es_pass&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;es_url&#125;</span>:<span class="variable">$&#123;es_port&#125;</span>/_cat/indices?v&amp;s=index&quot;</span> | grep -E <span class="string">&quot;<span class="variable">$&#123;index_prefix&#125;</span>-*&quot;</span> | grep -v <span class="string">&quot;tsf-oss&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="variable">$indices</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">date</span>=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$index</span>&quot;</span> | awk -F<span class="string">&#x27;@&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$date</span> ]; <span class="keyword">then</span></span><br><span class="line">      cond=$(<span class="built_in">date</span> +%Y-%m-%d)</span><br><span class="line">	    diff=$(dateDiff -d <span class="variable">$date</span> <span class="variable">$cond</span>)</span><br><span class="line">	    <span class="keyword">if</span> [ <span class="variable">$&#123;diff&#125;</span> -gt <span class="variable">$&#123;ttl_date&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">        rsp=$(curl -s -u <span class="string">&quot;<span class="variable">$&#123;es_user&#125;</span>&quot;</span>:<span class="string">&quot;<span class="variable">$&#123;es_pass&#125;</span>&quot;</span> -XDELETE <span class="string">&quot;<span class="variable">$&#123;es_url&#125;</span>:<span class="variable">$&#123;es_port&#125;</span>/<span class="variable">$&#123;index&#125;</span>&quot;</span>)</span><br><span class="line">        res=$(<span class="built_in">echo</span> <span class="variable">$rsp</span> | awk -F<span class="string">&quot;[,:&#125;]&quot;</span> <span class="string">&#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;if($i~/&#x27;</span>acknowledged<span class="string">&#x27;\042/)&#123;print $(i+1)&#125;&#125;&#125;&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;&quot;&#x27;</span> | sed -n 1p)</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$res</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> delete success&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> delete failed: <span class="variable">$res</span>&quot;</span> &gt;&amp;2</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> still lives&quot;</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	      result=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$index</span>&quot;</span> | grep <span class="string">&quot;failed&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$result</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            rsp=$(curl -s -u <span class="string">&quot;<span class="variable">$&#123;es_user&#125;</span>&quot;</span>:<span class="string">&quot;<span class="variable">$&#123;es_pass&#125;</span>&quot;</span> -XDELETE <span class="string">&quot;<span class="variable">$&#123;es_url&#125;</span>:<span class="variable">$&#123;es_port&#125;</span>/<span class="variable">$&#123;index&#125;</span>&quot;</span>)</span><br><span class="line">            res=$(<span class="built_in">echo</span> <span class="variable">$rsp</span> | awk -F<span class="string">&quot;[,:&#125;]&quot;</span> <span class="string">&#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;if($i~/&#x27;</span>acknowledged<span class="string">&#x27;\042/)&#123;print $(i+1)&#125;&#125;&#125;&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;&quot;&#x27;</span> | sed -n 1p)</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$res</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">              <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> delete success&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> delete failed: <span class="variable">$res</span>&quot;</span> &gt;&amp;2</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;current&#125;</span> <span class="variable">$&#123;index&#125;</span> has no date field&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p><strong>åªè¯»æ ‡è®°æœªæ‰‹åŠ¨æ¸…é™¤</strong>ï¼šè¿™æ˜¯æœ€å¸¸è§çš„åŸå› ã€‚Elasticsearch <strong>ä¸ä¼šè‡ªåŠ¨</strong>å°†ç´¢å¼•çš„ <code>read_only_allow_delete</code> å±æ€§æ”¹å› <code>false</code></p>
<p><strong>ç£ç›˜ç©ºé—´æœªçœŸæ­£æœ‰æ•ˆé‡Šæ”¾</strong>ï¼š</p>
<ul>
<li><p><strong>å»¶è¿Ÿé‡Šæ”¾</strong>ï¼šä½¿ç”¨ <code>DELETE</code> æ“ä½œæˆ– <code>_delete_by_query</code> è¿›è¡Œæ•°æ®åˆ é™¤æ—¶ï¼ŒElasticsearch é‡‡ç”¨çš„æ˜¯â€œæ ‡è®°åˆ é™¤â€è€Œéç«‹å³ä»ç£ç›˜æ“¦é™¤ã€‚çœŸæ­£çš„ç©ºé—´é‡Šæ”¾éœ€è¦ç­‰å¾… <strong>Segment Merge</strong> è¿‡ç¨‹å®Œæˆã€‚</p>
</li>
<li><p><strong>æ¸…ç†é‡ä¸è¶³</strong>ï¼šå¯èƒ½åˆ é™¤çš„æ•°æ®é‡ä¸è¶³ä»¥è®©æ‰€æœ‰ç£ç›˜çš„ä½¿ç”¨ç‡éƒ½é™åˆ°æ°´ä½çº¿ï¼ˆç‰¹åˆ«æ˜¯ flood_stage, ä¾‹å¦‚95%ï¼‰ä»¥ä¸‹ã€‚Elasticsearch ä¼šæ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹ç£ç›˜ç©ºé—´ã€‚</p>
</li>
</ul>
<p>æ°´ä½çº¿æ£€æŸ¥æœ‰å»¶è¿Ÿæˆ–ç¼“å­˜ï¼šElasticsearch æ£€æµ‹ç£ç›˜ç©ºé—´å’Œä½¿ç”¨ç‡å˜åŒ–å¯èƒ½å­˜åœ¨çŸ­æš‚å»¶è¿Ÿã€‚</p>
<p>åˆ†ç‰‡åˆ†é…é—®é¢˜ï¼šå³ä½¿ç©ºé—´è¶³å¤Ÿï¼Œå¦‚æœä¹‹å‰å› ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´åˆ†ç‰‡æœªåˆ†é…ï¼Œç©ºé—´é‡Šæ”¾åå¯èƒ½éœ€è¦æ‰‹åŠ¨æ¢å¤åˆ†ç‰‡åˆ†é…æˆ–ç­‰å¾…é›†ç¾¤è‡ªåŠ¨é‡æ–°å¹³è¡¡ã€‚</p>
<h4 id="ğŸ“–-æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤"><a href="#ğŸ“–-æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤" class="headerlink" title="ğŸ“– æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤"></a>ğŸ“– æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤</h4><table>
<thead>
<tr>
<th align="left">æ­¥éª¤</th>
<th align="left">æ“ä½œ</th>
<th align="left">å‘½ä»¤&#x2F;æ“ä½œç¤ºä¾‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1ï¸âƒ£</td>
<td align="left"><strong>ç¡®è®¤ç£ç›˜ç©ºé—´</strong></td>
<td align="left"><code>GET /_cat/allocation?v</code></td>
<td align="left">æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„ç£ç›˜ä½¿ç”¨ç‡ï¼Œç¡®ä¿å‡ä½äºæ´ªæ°´æ°´ä½çº¿ï¼ˆå¦‚95%ï¼‰</td>
</tr>
<tr>
<td align="left">2ï¸âƒ£</td>
<td align="left"><strong>æ£€æŸ¥ç´¢å¼•è®¾ç½®</strong></td>
<td align="left"><code>GET your_index_name/_settings</code></td>
<td align="left">ç¡®è®¤ <code>index.blocks.read_only_allow_delete</code> æ˜¯å¦ä¸º <code>true</code></td>
</tr>
<tr>
<td align="left">3ï¸âƒ£</td>
<td align="left"><strong>æ‰‹åŠ¨è§£é™¤åªè¯»</strong></td>
<td align="left">curl  -H â€œContent-Type:application&#x2F;jsonâ€ -XPUT 10.25.83.242:9200&#x2F;_cluster&#x2F;settings -d â€˜{   â€œpersistentâ€: {     â€œcluster.blocks.read_only_allow_deleteâ€: false   } }â€™</td>
<td align="left">æ ¸å¿ƒæ­¥éª¤ï¼šæ‰‹åŠ¨æ¸…é™¤ç´¢å¼•çš„åªè¯»æ ‡è®°</td>
</tr>
<tr>
<td align="left">4ï¸âƒ£</td>
<td align="left">xxx</td>
<td align="left">curl -H â€œContent-Type: application&#x2F;jsonâ€  -XPUT â€˜10.25.83.242:9200&#x2F;_all&#x2F;_settingsâ€™ -d â€˜{â€œindexâ€:{â€œblocksâ€:{â€œread_only_allow_deleteâ€:null}}}â€™</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">5ï¸âƒ£</td>
<td align="left"><strong>éªŒè¯å†™å…¥</strong></td>
<td align="left"><code>POST your_index_name/_doc &#123; &quot;test&quot;: &quot;data&quot; &#125;</code></td>
<td align="left">å°è¯•å†™å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸ</td>
</tr>
</tbody></table>
<h3 id="æ•°æ®è¿ç§»"><a href="#æ•°æ®è¿ç§»" class="headerlink" title="æ•°æ®è¿ç§»"></a>æ•°æ®è¿ç§»</h3><p>é¡¹ç›®èƒŒæ™¯ï¼šç›®å‰é¡¹ç›®ç”±ä¸¤å¥—ç¯å¢ƒï¼Œéœ€è¦å°†Aç¯å¢ƒçš„æ•°æ®è¿ç§»è‡³ç¯å¢ƒBã€‚é¡¹ç›®Bä¸­æœ¬èº«ä¹Ÿæœ‰æ•°æ®ã€‚æ•…éœ€æ±‚æ˜¯éœ€è¦å…ˆå°†é¡¹ç›®Bä¸­çš„ESæ•°æ®æ¸…ç©ºåå†å°†é¡¹ç›®Açš„ESæ•°æ®è¿ç§»è¿‡æ¥ã€‚å› ä¸ºAã€Bä¸¤ä¸ªç¯å¢ƒçš„ç½‘ç»œå¯ä¸´æ—¶å¼€é€šç«¯å£ä¸”ä¸¤ä¸ªç¯å¢ƒæ²¡æœ‰HDFSã€s3è¿™æ ·çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿï¼Œä½†å¯éƒ¨ç½²ntfsç³»ç»Ÿã€‚æ•…eså¤‡ä»½æ¢å¤ä½¿ç”¨çš„æ˜¯multielasticdumpè¿›è¡Œçš„å¤‡ä»½ä¸æ¢å¤ã€‚</p>
<h4 id="å¤‡ä»½å·¥å…·åŒºåˆ«é€‰æ‹©"><a href="#å¤‡ä»½å·¥å…·åŒºåˆ«é€‰æ‹©" class="headerlink" title="å¤‡ä»½å·¥å…·åŒºåˆ«é€‰æ‹©"></a>å¤‡ä»½å·¥å…·åŒºåˆ«é€‰æ‹©</h4><table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left">elasticdump</th>
<th align="left">multielasticdump</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ ¸å¿ƒåŸç†</strong></td>
<td align="left">å•è¿›ç¨‹å·¥å…·</td>
<td align="left"><strong>elasticdump çš„åŒ…è£…å™¨</strong>ï¼Œç®¡ç†å¤šä¸ªè¿›ç¨‹</td>
</tr>
<tr>
<td align="left"><strong>å¤„ç†æ–¹å¼</strong></td>
<td align="left"><strong>ä¸²è¡Œ</strong>ï¼šä¸€æ¬¡å¤„ç†ä¸€ä¸ªç´¢å¼•æˆ–ä¸€ç§æ•°æ®ç±»å‹</td>
<td align="left"><strong>å¹¶è¡Œ</strong>ï¼šåŒæ—¶å¤„ç†å¤šä¸ªç´¢å¼•</td>
</tr>
<tr>
<td align="left"><strong>æ•ˆç‡</strong></td>
<td align="left">é€Ÿåº¦è¾ƒæ…¢ï¼Œå°¤å…¶å½“ç´¢å¼•å¾ˆå¤šæ—¶</td>
<td align="left"><strong>é€Ÿåº¦éå¸¸å¿«</strong>ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPUå’Œç½‘ç»œå¸¦å®½</td>
</tr>
<tr>
<td align="left"><strong>ä½¿ç”¨åœºæ™¯</strong></td>
<td align="left">å¤‡ä»½æˆ–è¿ç§»<strong>å•ä¸ªæˆ–å°‘é‡å‡ ä¸ªç´¢å¼•</strong></td>
<td align="left">å¤‡ä»½æˆ–è¿ç§»<strong>æ•´ä¸ªé›†ç¾¤</strong>æˆ–å¤§é‡ç´¢å¼•</td>
</tr>
<tr>
<td align="left"><strong>è¾“å‡ºç»“æ„</strong></td>
<td align="left">è¾“å‡ºæ˜¯æŒ‡å®šçš„å•ä¸ªæ–‡ä»¶</td>
<td align="left">ä¸º<strong>æ¯ä¸ªç´¢å¼•åˆ›å»ºå­æ–‡ä»¶å¤¹</strong>ï¼Œæ–‡ä»¶å¤¹å†…åŒ…å«è¯¥ç´¢å¼•çš„å„ç§ç±»å‹æ–‡ä»¶ï¼ˆdata, mappingç­‰ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>èµ„æºå ç”¨</strong></td>
<td align="left">å ç”¨èµ„æºè¾ƒå°‘</td>
<td align="left">å ç”¨èµ„æºè¾ƒå¤šï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œè¿æ¥æ•°ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>æ§åˆ¶ç²’åº¦</strong></td>
<td align="left"><strong>é«˜</strong>ï¼šå¯ä»¥éå¸¸ç²¾ç»†åœ°æ§åˆ¶å•ä¸ªç´¢å¼•çš„ä¼ è¾“</td>
<td align="left"><strong>ä½</strong>ï¼šä»¥ç´¢å¼•ä¸ºå•å…ƒè¿›è¡Œæ‰¹é‡æ“ä½œ</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left"><code>elasticdump</code> &#x2F; <code>multielasticdump</code></th>
<th align="left">Elasticsearch å¿«ç…§&#x2F;æ¢å¤ (Snapshot&#x2F;Restore)</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ ¼å¼</strong></td>
<td align="left"><strong>çº¯æ–‡æœ¬ JSON</strong></td>
<td align="left"><strong>ä¸“æœ‰çš„äºŒè¿›åˆ¶æ ¼å¼</strong></td>
</tr>
<tr>
<td align="left"><strong>å¯è¯»æ€§</strong></td>
<td align="left"><strong>é«˜</strong>ã€‚å¯ä»¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ã€<code>cat</code>, <code>head</code>, <code>jq</code> ç­‰å·¥å…·ç›´æ¥æŸ¥çœ‹å’Œåˆ†æã€‚</td>
<td align="left"><strong>ä½</strong>ã€‚åªèƒ½ç”± Elasticsearch æœ¬èº«è¯†åˆ«å’Œè§£æã€‚</td>
</tr>
<tr>
<td align="left"><strong>ç”¨é€”</strong></td>
<td align="left"><strong>é€»è¾‘å¤‡ä»½</strong>ã€‚æ•°æ®è¿ç§»ã€å°‘é‡æ•°æ®æ¢å¤ã€æ•°æ®å®¡è®¡ã€è½¬æ¢æ ¼å¼ã€‚</td>
<td align="left"><strong>ç‰©ç†å¤‡ä»½</strong>ã€‚å®Œæ•´çš„é›†ç¾¤å¿«ç…§ï¼Œç”¨äºç¾éš¾æ¢å¤ã€å…¨é‡å¤‡ä»½ã€‚</td>
</tr>
<tr>
<td align="left"><strong>é€Ÿåº¦</strong></td>
<td align="left">ç›¸å¯¹è¾ƒæ…¢ï¼ˆéœ€è¦å°†äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºJSONæ–‡æœ¬å¹¶ä¼ è¾“ï¼‰</td>
<td align="left"><strong>éå¸¸å¿«</strong>ï¼ˆç›´æ¥æ‹·è´åº•å±‚çš„æ®µæ–‡ä»¶ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å­˜å‚¨ç©ºé—´</strong></td>
<td align="left"><strong>æ›´å¤§</strong>ï¼ˆæ–‡æœ¬æ ¼å¼é€šå¸¸æ¯”äºŒè¿›åˆ¶è¡¨ç¤ºæ›´å ç©ºé—´ï¼‰</td>
<td align="left"><strong>æ›´å°</strong>ï¼ˆæ˜¯é«˜æ•ˆçš„äºŒè¿›åˆ¶å‹ç¼©æ ¼å¼ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>ç³»ç»Ÿè¦æ±‚</strong></td>
<td align="left">ä»»ä½•æœ‰æ–‡ä»¶ç³»ç»Ÿçš„åœ°æ–¹</td>
<td align="left">å¿…é¡»é…ç½®åœ¨æ”¯æŒçš„<strong>å¿«ç…§ä»“åº“</strong>ä¸­ï¼ˆå¦‚ S3, HDFS, NFS, å…±äº«FSï¼‰</td>
</tr>
</tbody></table>
<h4 id="æ•°æ®è¿ç§»è¿‡ç¨‹"><a href="#æ•°æ®è¿ç§»è¿‡ç¨‹" class="headerlink" title="æ•°æ®è¿ç§»è¿‡ç¨‹"></a>æ•°æ®è¿ç§»è¿‡ç¨‹</h4><p>æŸ¥çœ‹æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl [--user &lt;è´¦å·&gt;:&lt;å¯†ç &gt;] -XGET <span class="string">&#x27;&lt;ES_IP&gt;:9200/_cluster/health?pretty&#x27;</span></span><br><span class="line">1. ä½¿ç”¨ GET /_cat/indices å‘½ä»¤</span><br><span class="line">curl [--user &lt;è´¦å·&gt;:&lt;å¯†ç &gt;] -XGET <span class="string">&#x27;&lt;ES_IP&gt;:9200/_cat/indices?v&#x27;</span> | grep red</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•</span></span><br><span class="line">curl -u elastic:<span class="string">&#x27;your_password&#x27;</span> http://localhost:9200/_cat/indices?v</span><br></pre></td></tr></table></figure>

<p>æ•°æ®æ¸…ç†,å°†æ‰€æœ‰çš„ç´¢å¼•çš„æ•°æ®éƒ½æ¸…ç†å¹²å‡€ã€‚ä¹Ÿå¯ä»¥ç”¨åˆ é™¤ç´¢å¼•çš„æ–¹å¼å°†å…¶éƒ½åˆ é™¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -u <span class="string">&quot;elastic:å¯†ç &quot;</span> -X POST <span class="string">&quot;http://localhost:9200/&lt;ç´¢å¼•å&gt;/_delete_by_query&quot;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d<span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;match_all&quot;: &#123;&#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ•°æ®å¤‡ä»½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">date_dir=`<span class="built_in">date</span> +%Y%m%d`</span><br><span class="line">multielasticdump \</span><br><span class="line">    --direction=dump \</span><br><span class="line">    --match=<span class="string">&#x27;^.*$&#x27;</span> \</span><br><span class="line">    --includeType=<span class="string">&#x27;data,mapping,analyzer,alias,settings,template&#x27;</span> \</span><br><span class="line">    --input=http://<span class="variable">$&#123;es_user&#125;</span>:<span class="variable">$&#123;es_passwd&#125;</span>@<span class="variable">$&#123;es_host&#125;</span>:<span class="variable">$&#123;es_port&#125;</span> \</span><br><span class="line">    --output=<span class="variable">$backup_dir</span>/elasticsearch-dump/<span class="variable">$date_dir</span> </span><br></pre></td></tr></table></figure>

<p>æ•°æ®æ¢å¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">multielasticdump \</span><br><span class="line">  --direction=load \</span><br><span class="line">  --skip-existing \</span><br><span class="line">  --match=<span class="string">&#x27;^.*$&#x27;</span> \</span><br><span class="line">  --includeType=<span class="string">&#x27;data,mapping,analyzer,alias,settings,template&#x27;</span> \</span><br><span class="line">  --ignoreChildError \</span><br><span class="line">  --input=<span class="variable">$backup_data</span> \</span><br><span class="line">  --output=http://<span class="variable">$&#123;ES_USER&#125;</span>:<span class="variable">$&#123;ES_PASSWD&#125;</span>@<span class="variable">$ES_HOST</span>:<span class="variable">$ES_PORT</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ä¸­é—´ä»¶</category>
      </categories>
      <tags>
        <tag>ES</tag>
      </tags>
  </entry>
  <entry>
    <title>ZKåŸºæœ¬ä½¿ç”¨åŠé—®é¢˜å¤„ç†01</title>
    <url>/2025/09/22/ZK%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%8601/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#å®¹å™¨åœºæ™¯å’Œä¸»æœºåœºæ™¯åªæ˜¯ä¿®æ”¹äº†è¿™ä¸ªé…ç½®</span></span><br><span class="line">file=/etc/zoo.cfg.runtime   </span><br><span class="line">clientPort=$(<span class="built_in">cat</span> <span class="variable">$file</span> | grep clientPort| awk -F <span class="string">&#x27;=&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">hostlist=$(<span class="built_in">cat</span> <span class="variable">$file</span> | grep server. | awk -F <span class="string">&#x27;=&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-15s %-10s %-10s  %-10s  %-10s\n&quot;</span> <span class="string">&quot;ip&quot;</span> <span class="string">&quot;status&quot;</span> <span class="string">&quot;zxid&quot;</span> <span class="string">&quot;zk_ephemerals_count&quot;</span> <span class="string">&quot;zk_znode_count&quot;</span></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> <span class="variable">$hostlist</span>; <span class="keyword">do</span></span><br><span class="line">  domain=<span class="variable">$host</span></span><br><span class="line">  ip=$(ping -c 1 <span class="variable">$domain</span> | grep -oE <span class="string">&#x27;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+&#x27;</span> | <span class="built_in">head</span> -n 1)</span><br><span class="line">  state=$(<span class="built_in">echo</span> mntr| nc -w 3 <span class="variable">$ip</span> <span class="variable">$clientPort</span> | grep zk_server_state | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  zxid=$(<span class="built_in">echo</span> -n srvr | nc <span class="variable">$ip</span> <span class="variable">$clientPort</span> | grep -i <span class="string">&quot;zxid&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  zk_ephemerals_count=$(<span class="built_in">echo</span> mntr |nc <span class="variable">$ip</span> <span class="variable">$clientPort</span> |grep zk_ephemerals_count | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  zk_znode_count=$(<span class="built_in">echo</span> mntr |nc <span class="variable">$ip</span> <span class="variable">$clientPort</span> |grep zk_znode_count | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;%-15s %-10s %-10s  %-20s  %-10s\n&quot;</span> <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> <span class="string">&quot;<span class="variable">$state</span>&quot;</span> <span class="string">&quot;<span class="variable">$zxid</span>&quot;</span> <span class="string">&quot;<span class="variable">$zk_ephemerals_count</span>&quot;</span> <span class="string">&quot;<span class="variable">$zk_znode_count</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>clickhouseåˆ†å¸ƒå¼åŸºæœ¬ä½¿ç”¨</title>
    <url>/2025/09/08/clickhouse%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>ç›®å‰clickhouseåˆ›å»ºæ˜¯2å‰¯æœ¬çš„,ä¸šåŠ¡é¡µé¢è®¿é—®clickhouse å‘ç°ä¸¤ä¸ªclickhouseçš„æ•°æ®ä¸åŒæ­¥ã€‚ä¸»è¦åŸå› æ˜¯æœªåˆ›å»ºåˆ†å¸ƒå¼clickhouseå®ä¾‹ã€‚ç›®å‰é’ˆå¯¹è¯¥åœºæ™¯è¿›è¡Œè®°å½•clickhouseåˆ†å¸ƒå¼çš„ä½¿ç”¨</p>
<h3 id="å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“"><a href="#å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“" class="headerlink" title="å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“"></a>å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">kubectl  <span class="built_in">exec</span> -it -n sso     clickhouse-sso-test-clickhhouse-0-ss-0  -c clickhouse -- clickhouse-client --user root --password testclickhouse  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse"><a href="#æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse" class="headerlink" title="æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse"></a>æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse</h3><p>ç›®å‰ä¸šåŠ¡å¯ä¾æ®ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä½¿ç”¨ä»£ç è¿›è¡Œåˆ›å»ºã€‚æˆ–è€…ä½¿ç”¨å¯è§†åŒ–è§†å›¾è¿›è¡Œåˆ›å»ºã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  <span class="string">&quot;http://10.25.83.231:8123/?user=root&amp;password=testclickhouse&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;create database test0814 on cluster defaultCluster;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºåˆ†å¸ƒå¼åº“"><a href="#åˆ›å»ºåˆ†å¸ƒå¼åº“" class="headerlink" title="åˆ›å»ºåˆ†å¸ƒå¼åº“"></a>åˆ›å»ºåˆ†å¸ƒå¼åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#test0813 ä¸ºæ•°æ®åº“å</span></span><br><span class="line"><span class="comment">#defaultCluster çš„ ClickHouse é›†ç¾¤</span></span><br><span class="line">create database test0813 on cluster defaultCluster;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæœ¬åœ°è¡¨"><a href="#åˆ›å»ºæœ¬åœ°è¡¨" class="headerlink" title="åˆ›å»ºæœ¬åœ°è¡¨"></a>åˆ›å»ºæœ¬åœ°è¡¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#SHOW CREATE TABLE test0813.local_table å¯æŸ¥çœ‹è¡¨ç»“æ„</span></span><br><span class="line">CREATE TABLE test0813.local_table ON CLUSTER defaultCluster</span><br><span class="line">(</span><br><span class="line">    event_date Date,</span><br><span class="line">    user_id UInt64,</span><br><span class="line">    action_type Enum(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    device Array(String)</span><br><span class="line">)</span><br><span class="line">ENGINE = ReplicatedMergeTree(<span class="string">&#x27;/clickhouse/tables/&#123;shard&#125;/test0813/local_table&#x27;</span>, <span class="string">&#x27;&#123;replica&#125;&#x27;</span>)</span><br><span class="line">PARTITION BY toYYYYMM(event_date)</span><br><span class="line">ORDER BY (user_id, action_type)</span><br><span class="line">SETTINGS index_granularity = 8192;</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>1.test0813.local_tableï¼šåˆ›å»ºåœ¨ test0813 æ•°æ®åº“ä¸­çš„ local_table è¡¨</p>
<p>2.ON CLUSTER defaultClusterï¼šåœ¨åä¸º defaultCluster çš„ ClickHouse é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ›å»ºæ­¤è¡¨</p>
<p>3.ReplicatedMergeTreeè¿™ä¸ªå¼•æ“ç”¨äºåˆ›å»ºå…·æœ‰å¤åˆ¶åŠŸèƒ½çš„è¡¨ï¼Œç¡®ä¿æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´åŒæ­¥ã€‚</p>
<table>
<thead>
<tr>
<th><strong>è·¯å¾„ç»„ä»¶</strong></th>
<th><strong>è¯´æ˜</strong></th>
<th><strong>ç¤ºä¾‹å€¼</strong></th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;clickhouse&#x2F;tables</td>
<td>æ ¹è·¯å¾„ï¼ˆClickHouse çº¦å®šï¼‰</td>
<td>å›ºå®šå€¼</td>
</tr>
<tr>
<td>{shard}</td>
<td><strong>åˆ†ç‰‡æ ‡è¯†ç¬¦å ä½ç¬¦</strong></td>
<td>01, shard1</td>
</tr>
<tr>
<td>test0813</td>
<td>æ•°æ®åº“åç§°</td>
<td>æ‚¨çš„æ•°æ®åº“å</td>
</tr>
<tr>
<td>local_table</td>
<td>æœ¬åœ°è¡¨åç§°</td>
<td>æ‚¨çš„è¡¨å</td>
</tr>
</tbody></table>
<p>4.PARTITION BY toYYYYMM(event_date) <em>â€“ æŒ‰æœˆåˆ†åŒº</em></p>
<p>5.ORDER BY (user_id, action_type) <em>â€“ ä¸»é”®ç´¢å¼•</em></p>
<p>6.SETTINGS index_granularity &#x3D; 8192 <em>â€“ ç´¢å¼•ç²’åº¦</em></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ç´¢å¼•ç²’åº¦ï¼šæ¯ 8192 è¡Œç”Ÿæˆä¸€ä¸ªç´¢å¼•æ ‡è®°</span><br><span class="line">æ€§èƒ½å½±å“ï¼š</span><br><span class="line">å€¼è¶Šå° â†’ ç´¢å¼•æ›´ç²¾ç»† â†’ æŸ¥è¯¢æ›´å¿« â†’ ç´¢å¼•æ›´å¤§</span><br><span class="line">å€¼è¶Šå¤§ â†’ ç´¢å¼•æ›´ç²—ç³™ â†’ æŸ¥è¯¢ç¨æ…¢ â†’ ç´¢å¼•æ›´å°</span><br><span class="line">é»˜è®¤å€¼ï¼š8192ï¼ˆå¹³è¡¡é€‰æ‹©ï¼‰</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºåˆ†å¸ƒå¼è¡¨"><a href="#åˆ›å»ºåˆ†å¸ƒå¼è¡¨" class="headerlink" title="åˆ›å»ºåˆ†å¸ƒå¼è¡¨"></a>åˆ›å»ºåˆ†å¸ƒå¼è¡¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test0813.user_data ON CLUSTER defaultCluster</span><br><span class="line">(</span><br><span class="line">    event_date Date,</span><br><span class="line">    user_id UInt64,</span><br><span class="line">    action_type Enum(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    device Array(String)</span><br><span class="line">)</span><br><span class="line">ENGINE = Distributed(</span><br><span class="line">    defaultCluster,   -- é›†ç¾¤åç§°</span><br><span class="line">    <span class="string">&#x27;test0813&#x27;</span>,       -- æ•°æ®åº“å</span><br><span class="line">    <span class="string">&#x27;local_table&#x27;</span>,    -- åº•å±‚æœ¬åœ°è¡¨å</span><br><span class="line">    rand()            -- åˆ†ç‰‡é”®ï¼ˆéšæœºåˆ†å¸ƒï¼‰</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡åˆ†å¸ƒå¼è¡¨æ’å…¥ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰</span></span><br><span class="line">INSERT INTO test0813.user_data </span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">&#x27;2023-08-11&#x27;</span>, 1001, <span class="string">&#x27;login&#x27;</span>, [<span class="string">&#x27;iPhone&#x27;</span>,<span class="string">&#x27;iOS 15&#x27;</span>]),</span><br><span class="line">    (<span class="string">&#x27;2023-08-11&#x27;</span>, 1002, <span class="string">&#x27;logout&#x27;</span>, [<span class="string">&#x27;Android&#x27;</span>,<span class="string">&#x27;Chrome&#x27;</span>]),</span><br><span class="line">    (<span class="string">&#x27;2023-08-12&#x27;</span>, 1003, <span class="string">&#x27;login&#x27;</span>, [<span class="string">&#x27;Windows&#x27;</span>,<span class="string">&#x27;Firefox&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰å…¨åˆ é™¤åˆ†å¸ƒå¼è¡¨ï¼Œåˆ é™¤åˆ†å¸ƒå¼è¡¨ï¼ˆä¸å½±å“æ•°æ®ï¼‰</span></span><br><span class="line">DROP TABLE IF EXISTS test0813.user_data ON CLUSTER defaultCluster</span><br><span class="line"><span class="comment">#åˆ é™¤æœ¬åœ°è¡¨ï¼ˆæ°¸ä¹…åˆ é™¤æ•°æ®ï¼‰</span></span><br><span class="line">DROP TABLE IF EXISTS test0813.local_table ON CLUSTER defaultCluster</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–è¯´æ˜"><a href="#å…¶ä»–è¯´æ˜" class="headerlink" title="å…¶ä»–è¯´æ˜"></a>å…¶ä»–è¯´æ˜</h3><ol>
<li>åˆ›å»ºå¤šå¼ è¡¨ï¼Œæ˜¯å¦éœ€è¦åˆ›å»ºå¤šå¼ local_tableçš„è¡¨ï¼Ÿéœ€è¦çš„</li>
<li>éœ€è¦å…³é—­ä¸€å°èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥ã€‚ä¼šåŒæ­¥çš„</li>
</ol>
]]></content>
      <categories>
        <category>ä¸­é—´ä»¶</category>
      </categories>
      <tags>
        <tag>clickhouse</tag>
      </tags>
  </entry>
  <entry>
    <title>shellä¹‹è·å–dockerå®¹å™¨ä¸­çš„cpuä¸å†…å­˜ä½¿ç”¨ç‡</title>
    <url>/2025/09/06/shell%E4%B9%8B%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84cpu%E4%B8%8E%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87/</url>
    <content><![CDATA[<p>èƒŒæ™¯ï¼šè¯¥é¡¹ç›®è¿ç§»è‡³æ–°ç¯å¢ƒéœ€æ±‚ï¼Œå°†åŸå…ˆTSFé›†ç¾¤ï¼ˆèŠ‚ç‚¹æ•°ï¼šxxxï¼‰è¿ç§»åˆ°æ–°ç¯å¢ƒä¸­ï¼Œjmeter å‹æµ‹ä¸€ä¸ªæŸ¥è¯¢æ¥å£çš„æ•°æ®ã€‚åˆ†åˆ«åœ¨æ—§ç¯å¢ƒä¸æ–°ç¯å¢ƒçš„æ¥å£æ•°æ®è¿›è¡Œå‹æµ‹ï¼Œå¯¹æ¯”ç›‘æ§CPUã€å†…å­˜åˆ©ç”¨ç‡æƒ…å†µã€‚ç›®å‰æ—§ç¯å¢ƒå®¹å™¨æ— ç›‘æ§ï¼Œæ•…æ€è·¯ä¸Šä½¿ç”¨è„šæœ¬æ¥è·å–ç›‘æ§æ•°æ®ï¼Œè·å–çš„æ•°æ®ç”¨å›¾æ ‡å±•ç¤ºå‡ºæ¥ã€‚åº•å±‚çš„k8sæ¯”è¾ƒè€ï¼Œæš‚æœªæ”¯æŒkubectl  top  å®¹å™¨ã€‚</p>
<p>é—®é¢˜:ä¸ºä»€ä¹ˆä¸è¿›å…¥å®¹å™¨ä¸­æŸ¥çœ‹ï¼ŒtopæŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨é‡ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å®¹å™¨ä¸­è¿è¡Œ top å‘½ä»¤ï¼Œè™½ç„¶å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æ¯ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ï¼Œä½†æ˜¯ top ä¸­â€%Cpu(s)â€é‚£ä¸€è¡Œä¸­æ˜¾ç¤ºçš„æ•°å€¼ï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªå®¹å™¨çš„ CPU æ•´ä½“ä½¿ç”¨ç‡ï¼Œè€Œæ˜¯å®¹å™¨å®¿ä¸»æœºçš„ CPU ä½¿ç”¨ç‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">HOST_NAME=$(hostname -I | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/docker_stats_20250719_<span class="variable">$HOST_NAME</span>.log&quot;</span></span><br><span class="line">DOCKER_NAME=$(docker ps |grep  <span class="string">&quot;tsf_1/element-server&quot;</span> |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">INTERVAL=5 <span class="comment"># æ”¶é›†é—´éš”ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¹¶æ·»åŠ è¡¨å¤´</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ—¶é—´æˆ³,å®¹å™¨ID,CPUä½¿ç”¨ç‡%,å†…å­˜ä½¿ç”¨ç‡%&quot;</span> &gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">    TIMESTAMP=$(<span class="built_in">date</span> <span class="string">&#x27;+%H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ top æ”¶é›† CPU ä½¿ç”¨ç‡ï¼ˆæå– %Cpu(s): åçš„æ•°å€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line">    CPU_MEM_USAGE=$(docker stats <span class="variable">$DOCKER_NAME</span> --no-stream --format <span class="string">&quot;&#123;&#123;.Container&#125;&#125;,\t&#123;&#123;.CPUPerc&#125;&#125;,\t\t&#123;&#123;.MemPerc&#125;&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$CPU_MEM_USAGE</span></span><br><span class="line">    <span class="comment">#top -bn1 | grep &#x27;%Cpu&#x27; | awk &#x27;&#123;print &quot;CPUä½¿ç”¨ç‡: &quot; 100 - $8 &quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$TIMESTAMP</span>ï¼Œ <span class="variable">$CPU_MEM_USAGE</span> &quot;</span>  &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="comment"># ç­‰å¾…ä¸‹ä¸€æ¬¡æ”¶é›†</span></span><br><span class="line">    <span class="built_in">sleep</span> <span class="variable">$INTERVAL</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€ååˆ¶ä½œå‡ºæ¥çš„å›¾æ ‡å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/09/06/shell%E4%B9%8B%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84cpu%E4%B8%8E%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87/image-20250906170446394.png" alt="image-20250906170446394"></p>
<p>å…³äºå¾—åˆ°çš„æ•°æ®çš„ç–‘é—®çš„è®°å½•</p>
<p>ä»å›¾æ ‡ä¸Šå¯ä»¥å¾—å‡ºæœ‰çš„CPUè¶…100%äº†ï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ­£å¸¸æ¥çœ‹è¿™ä¸ªCPUåº”è¯¥æ˜¯å¤šå°‘çš„</p>
<ol>
<li>ç»å¯¹èµ„æºæ¶ˆè€—é‡</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">307% = 3.07 ä¸ªé€»è¾‘ CPU æ ¸å¿ƒæ»¡è½½</span><br><span class="line"><span class="comment">#è¡¨ç¤ºå®¹å™¨å½“å‰æ¯ç§’æ¶ˆè€— 3.07 æ ¸å¿ƒç§’çš„è®¡ç®—èµ„</span></span><br><span class="line"><span class="comment">#ç›¸å½“äºï¼š 3 ä¸ªæ ¸å¿ƒ 100% æ»¡è½½ + ç¬¬ 4 ä¸ªæ ¸å¿ƒ 7% è´Ÿè½½ æˆ– 4 ä¸ªæ ¸å¿ƒå¹³å‡ 76.75% è´Ÿè½½</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>docker stats ä¸­æŸ¥çœ‹ ä»¥ä¸‹å‚æ•° docker æœ‰å…³cpué…ç½®çš„åŒºåˆ«ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@x.x.x.x ~]# docker inspect 1f77b1a2b98e |grep -i cpu</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 4096, <span class="comment">#cpu requestçš„å€¼</span></span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 100000,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 400000, <span class="comment">#cpu limitçš„å€¼</span></span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;9-12&quot;</span>, <span class="comment">#è¿è¡Œåœ¨å“ªä¸ªcpuä¸Š</span></span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Linuxã€‘åŸºç¡€ç¯å¢ƒå»ºè®¾ä¹‹æœ¬åœ°yumæº</title>
    <url>/2025/10/25/%E3%80%90Linux%E3%80%91%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%BB%BA%E8%AE%BE%E4%B9%8B%E6%9C%AC%E5%9C%B0yum%E6%BA%90/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">####æœ¬åœ°ç”¨æ³•###</span></span><br><span class="line">1ã€ä¸‹è½½ iso åˆ°æ¯å°æœºå™¨ï¼Œåœ¨æ¯å°æœºå™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</span><br><span class="line">2ã€iso æŒ‚è½½</span><br><span class="line"><span class="built_in">mkdir</span> -p /data1/tencentos2.4</span><br><span class="line">mount -o loop /data1/TencentOS-Server-2.4-TK4-x86 64-everything-2209.8.iso</span><br><span class="line">/data1/tencentos2.4</span><br><span class="line">3ã€ç”Ÿæˆ yum repo æ–‡ä»¶:</span><br><span class="line">åœ¨/etc/yum.repos.dä¸­åˆ›å»ºæ–‡ä»¶ tencentos.repo:</span><br><span class="line">[tencentos-2.4-dvd-server]</span><br><span class="line">name=Tencent OS packages</span><br><span class="line">baseurl=file:///mnt/yum/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="comment">###TCPç«¯å£####</span></span><br><span class="line"><span class="built_in">nohup</span> python -m SimpleHTTPServer 80 &amp; </span><br><span class="line">4ã€éœ€è¦é…ç½®httpçš„æƒ…å†µ</span><br><span class="line">[base]</span><br><span class="line">name =<span class="string">&quot;CentOS7 HTTP Yum&quot;</span></span><br><span class="line">baseurl= http://192.168.1.115/centos/            <span class="comment">#æ‰§å‘æˆ‘ä»¬åˆ›å»ºçš„yunæº</span></span><br><span class="line">gpgcheck = 0                                    <span class="comment">#0è¡¨ç¤ºä¸æ£€æŸ¥ï¼Œé‚£å°±ä¸ç”¨å†™gpgkey</span></span><br><span class="line">enabled = 1</span><br><span class="line">[updates]</span><br><span class="line">name =<span class="string">&quot;Centos7 HTTP Yum&quot;</span></span><br><span class="line">baseurl= http://192.168.1.115/centos/</span><br><span class="line">gpgcheck = 0                                    <span class="comment">#0è¡¨ç¤ºä¸æ£€æŸ¥ï¼Œé‚£å°±ä¸ç”¨å†™gpgkey</span></span><br><span class="line">enabled = 1</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>LinuxåŸºç¡€ç¯å¢ƒ</category>
      </categories>
      <tags>
        <tag>yumæº</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ç£ç›˜ã€‘çš„åŸºæœ¬ä½¿ç”¨01</title>
    <url>/2025/10/09/%E3%80%90%E7%A3%81%E7%9B%98%E3%80%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A801/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1. æŸ¥çœ‹LVMä¿¡æ¯</span></span><br><span class="line">lvs</span><br><span class="line">vgs</span><br><span class="line">pvs </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¸è½½ç›¸å…³æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">umount /dev/mapper/vg_data-lv_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ é™¤é€»è¾‘å· ( é€»è¾‘åˆ†åŒº)</span></span><br><span class="line">lvremove /dev/vg_data/lv_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ é™¤å·ç»„( ç¡¬ç›˜ç»„åˆ)</span></span><br><span class="line">vgremove vg_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. åˆ é™¤ç‰©ç†å·( ç‰©ç†ç¡¬ç›˜)</span></span><br><span class="line">pvremove /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. éªŒè¯æ¸…ç†ç»“æœ</span></span><br><span class="line">pvs  <span class="comment"># åº”è¯¥çœ‹ä¸åˆ°è¯¥ç£ç›˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. æ¸…é™¤ç£ç›˜ç­¾å</span></span><br><span class="line"></span><br><span class="line">wipefs -a /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ddæ¸…é™¤å‰å‡ ä¸ªæ‰‡åŒº</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sdb bs=1M count=100</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#ç›®å½•ç»“æ„</span></span><br><span class="line">vdc</span><br><span class="line"> |_vdc1</span><br><span class="line"> 	 |_cspvg-lv_csp          lvm</span><br><span class="line">lvremove /dev/cspvg/lv_csp <span class="comment">#lvé€»è¾‘å·</span></span><br><span class="line">vgremove cspvg <span class="comment">#vg å·ç»„</span></span><br><span class="line">pvremove /dev/vdc <span class="comment">#pv ç‰©ç†å·</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ lvm</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pvcreate /dev/sdb /dev/sdc</span><br><span class="line">vgcreate vg_data /dev/sdb /dev/sdc</span><br><span class="line">lvcreate -n lv_data -L 100G vg_data</span><br><span class="line">lvcreate -n lv_data1 -l +100%FREE vg_data</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /data /data1</span><br><span class="line">disk=/dev/mapper/vg_data-lv_data</span><br><span class="line">mkfs.xfs -n ftype=1 <span class="variable">$disk</span> -f</span><br><span class="line">blkid <span class="variable">$disk</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | sed <span class="string">&#x27;s/&quot;//g&#x27;</span> | xargs -I &#123;&#125; <span class="built_in">echo</span> <span class="string">&quot;&#123;&#125; /data xfs defaults,noatime,nodiratime,prjquota 0 2&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"></span><br><span class="line">disk=/dev/mapper/vg_data-lv_data1</span><br><span class="line">mkfs.xfs -n ftype=1 <span class="variable">$disk</span> -f</span><br><span class="line">blkid <span class="variable">$disk</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | sed <span class="string">&#x27;s/&quot;//g&#x27;</span> | xargs -I &#123;&#125; <span class="built_in">echo</span> <span class="string">&quot;&#123;&#125; /data1 xfs defaults,noatime,nodiratime,prjquota 0 2&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line">mount -a</span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>lvmçš„ä½¿ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€fioã€‘çš„åŸºæœ¬ä½¿ç”¨ä¹‹ç£ç›˜æ€§èƒ½æµ‹è¯•</title>
    <url>/2025/09/14/%E3%80%90fio%E3%80%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B9%8B%E7%A3%81%E7%9B%98%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>ã€æ³¨æ„ã€‘ï¼šfio å¯¹å‚æ•°æ ¼å¼å¾ˆä¸¥æ ¼ï¼Œå¤šä½™çš„ç©ºæ ¼ä¼šå¯¼è‡´è§£æå¤±è´¥</p>
<p>fio æŸ¥çœ‹çš„æ–¹é¢æœ‰ï¼Œå»¶æ—¶ã€ååé‡ã€IOPSã€‚</p>
<p>ç›®å‰é’ˆå¯¹ç£ç›˜çš„æ€§èƒ½ä½¿ç”¨fioçš„å‹æµ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†4Kã€ä¸256Kçš„æµ‹è¯•æ–¹å¼å°†ç£ç›˜çš„åˆ©ç”¨ç‡æ‰“æ»¡ï¼Œå¯ä»¥åé¦ˆç£ç›˜çš„æœ€å¤§æ€§èƒ½ã€‚åŒæ­¥æˆ‘ä»¬æŸ¥çœ‹å¸¦å®½æ€§èƒ½ã€IOPSã€å»¶è¿Ÿç­‰æ–¹é¢ã€‚1.æˆ‘ä»¬å¯ç”¨256Kå»æµ‹è¯•å¸¦å®½çš„æé™é€Ÿåº¦ã€‚</p>
<h3 id="4Ké˜Ÿåˆ—æ·±åº¦32-éšæœºè¯»å†™æµ‹è¯•â€“512KB-519-â‰ˆ-260-MiB-s"><a href="#4Ké˜Ÿåˆ—æ·±åº¦32-éšæœºè¯»å†™æµ‹è¯•â€“512KB-519-â‰ˆ-260-MiB-s" class="headerlink" title="4Ké˜Ÿåˆ—æ·±åº¦32-éšæœºè¯»å†™æµ‹è¯•â€“512KB * 519 â‰ˆ 260 MiB&#x2F;s"></a>4Ké˜Ÿåˆ—æ·±åº¦32-éšæœºè¯»å†™æµ‹è¯•â€“512KB * 519 â‰ˆ 260 MiB&#x2F;s</h3><table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å¹³å‡å†™å…¥é€Ÿåº¦</strong></td>
<td align="left">260 MiB&#x2F;s (273 MB&#x2F;s) #ç£ç›˜çš„é¡ºåºå†™å…¥æé™é€Ÿåº¦</td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡IOPS</strong></td>
<td align="left">520</td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡å»¶è¿Ÿ</strong></td>
<td align="left">61.4æ¯«ç§’</td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡</strong></td>
<td align="left">100%</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio  --direct=1 --rw=write --time_based --refill_buffers --norandommap  --randrepeat=0 --group_reporting --name=fio-randwrite --size=1000G  --filename=/dev/vdb --iodepth=32 --bs=512k</span><br><span class="line">fio: time_based requires a runtime/timeout setting</span><br><span class="line">fio-randwrite: (g=0): rw=write, bs=(R) 512KiB-512KiB, (W) 512KiB-512KiB, (T) 512KiB-512KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line"><span class="comment">#è¡¨ç¤ºæœ‰1ä¸ªI/Oä½œä¸šæ­£åœ¨è¿è¡Œã€‚å†™å…¥æ“ä½œå®Œæˆäº†100%å†™å…¥é€Ÿåº¦ä¸º260Mib/s ,è®¡ç®—ï¼š512KB * 520 â‰ˆ 260 MiB/sï¼‰</span></span><br><span class="line">Jobs: 1 (f=1): [W(1)][100.0%][r=0KiB/s,w=260MiB/s][r=0,w=520 IOPS][eta 00m:00s]  </span><br><span class="line"><span class="comment">#- æµ‹è¯•åç§°ï¼Œç»„IDï¼Œä»»åŠ¡æ•°ï¼Œé”™è¯¯æ•°ï¼Œè¿›ç¨‹IDå’Œæ—¶é—´ã€‚</span></span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=8750: Sun Sep 14 14:56:44 2025</span><br><span class="line"><span class="comment">#- å†™å…¥æµ‹è¯•ç»“æœï¼šIOPSä¸º520ï¼Œå¸¦å®½ä¸º260MiB/sï¼ˆ273MB/sï¼‰ï¼Œæ€»å…±å†™å…¥1000GiBï¼Œç”¨æ—¶3937369æ¯«ç§’ï¼ˆçº¦3937.369ç§’ï¼Œå³65.6åˆ†é’Ÿï¼‰</span></span><br><span class="line">  write: IOPS=520, BW=260MiB/s (273MB/s)(1000GiB/3937369msec)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">    slat (usec): min=12, max=143, avg=46.17, stdev=11.34 <span class="comment">#æäº¤å»¶è¿Ÿï¼ˆä»æäº¤I/Oåˆ°å†…æ ¸åˆ°å†…æ ¸å¼€å§‹å¤„ç†çš„æ—¶é—´ï¼‰å¾®ç§’çº§ï¼Œæœ€å°12ï¼Œæœ€å¤§143ï¼Œå¹³å‡46.17ï¼Œæ ‡å‡†å·®11.34ã€‚</span></span><br><span class="line">    clat (msec): min=6, max=745, avg=61.37, stdev= 2.86 <span class="comment">#å®Œæˆå»¶è¿Ÿï¼ˆä»å†…æ ¸å¼€å§‹å¤„ç†åˆ°å®Œæˆçš„æ—¶é—´ï¼‰æ¯«ç§’çº§ï¼Œæœ€å°6ï¼Œæœ€å¤§745ï¼Œå¹³å‡61.37ï¼Œæ ‡å‡†å·®2.86ã€‚</span></span><br><span class="line">     lat (msec): min=6, max=745, avg=61.42, stdev= 2.86 <span class="comment"># æ€»å»¶è¿Ÿï¼ˆslat + clatï¼‰ï¼Œå¹³å‡61.42æ¯«ç§’ã€‚</span></span><br><span class="line">    clat percentiles (msec): <span class="comment">#å®Œæˆå»¶è¿Ÿçš„ç™¾åˆ†ä½æ•°ï¼ˆå•ä½æ¯«ç§’ï¼‰ï¼Œå¯ä»¥çœ‹å‡ºç»å¤§å¤šæ•°è¯·æ±‚çš„å»¶è¿Ÿåœ¨59åˆ°66æ¯«ç§’ä¹‹é—´ï¼Œåªæœ‰ä¸€ä¸ªå¼‚å¸¸å€¼åˆ°äº†176æ¯«ç§’ï¼ˆ99.99%å¤„ï¼‰ã€‚</span></span><br><span class="line">     |  1.00th=[   59],  5.00th=[   61], 10.00th=[   61], 20.00th=[   62],</span><br><span class="line">     | 30.00th=[   62], 40.00th=[   62], 50.00th=[   62], 60.00th=[   62],</span><br><span class="line">     | 70.00th=[   62], 80.00th=[   63], 90.00th=[   63], 95.00th=[   63],</span><br><span class="line">     | 99.00th=[   63], 99.50th=[   64], 99.90th=[   65], 99.95th=[   66],</span><br><span class="line">     | 99.99th=[  176]</span><br><span class="line">   <span class="comment">#  å¸¦å®½ï¼ˆbwï¼‰å’ŒIOPSï¼ˆiopsï¼‰çš„ç»Ÿè®¡ï¼šæä¾›äº†æœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼å’Œæ ‡å‡†å·®ï¼Œä»¥åŠé‡‡æ ·æ•°ã€‚</span></span><br><span class="line">   bw (  KiB/s): min=263168, max=797696, per=100.00%, avg=266307.92, stdev=6013.18, samples=7874</span><br><span class="line">   iops        : min=  514, max= 1558, avg=520.12, stdev=11.75, samples=7874</span><br><span class="line">  <span class="comment">#å»¶è¿Ÿåˆ†å¸ƒï¼š</span></span><br><span class="line">  lat (msec)   : 10=0.01%, 20=0.03%, 50=0.01%, 100=99.94%, 250=0.02% <span class="comment">#è¡¨ç¤º99.94%çš„è¯·æ±‚å»¶è¿Ÿåœ¨100æ¯«ç§’ä»¥å†…ã€‚</span></span><br><span class="line">  lat (msec)   : 500=0.01%, 750=0.01%</span><br><span class="line">  <span class="comment">#CPUä½¿ç”¨æƒ…å†µï¼šusr=5.69%, sys=2.50%, ctx=2042604 (ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°), majf=0 (ä¸»è¦ç¼ºé¡µä¸­æ–­), minf=31 (æ¬¡è¦ç¼ºé¡µä¸­æ–­)</span></span><br><span class="line">  cpu          : usr=5.69%, sys=2.50%, ctx=2042604, majf=0, minf=31</span><br><span class="line">  <span class="comment">#IOæ·±åº¦åˆ†å¸ƒï¼šå‡ ä¹100%çš„æ—¶é—´é˜Ÿåˆ—æ·±åº¦éƒ½åœ¨32ï¼ˆå³æˆ‘ä»¬è®¾ç½®çš„iodepthï¼‰ã€‚</span></span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     <span class="comment">#æäº¤å’Œå®Œæˆæƒ…å†µï¼šå¤§éƒ¨åˆ†æäº¤æ˜¯4ä¸ªä¸€æ‰¹ï¼ˆ4=100.0%ï¼‰ï¼Œå®Œæˆä¹Ÿæ˜¯4ä¸ªä¸€æ‰¹ï¼ˆ4=100.0%ï¼‰ï¼Œä½†å®Œæˆæ—¶32ä¸ªä¸€æ‰¹çš„å 0.1%ã€‚</span></span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     <span class="comment">#å‘å‡ºçš„è¯»å†™å‘½ä»¤æ€»æ•°ï¼štotal=0ï¼ˆè¯»ï¼‰,2048000ï¼ˆå†™ï¼‰,0ï¼ˆå…¶ä»–ï¼‰,0ï¼ˆå…¶ä»–ï¼‰</span></span><br><span class="line">     issued rwts: total=0,2048000,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"><span class="comment">#æ€»ç»“ï¼šé¡ºåºå†™å…¥1000GiBæ•°æ®ï¼Œç”¨æ—¶çº¦65.6åˆ†é’Ÿï¼Œå¹³å‡å†™å…¥é€Ÿåº¦260MiB/sï¼ˆçº¦273MB/sï¼‰ï¼Œå¹³å‡IOPSä¸º520ã€‚ç£ç›˜åˆ©ç”¨ç‡ï¼ˆutilï¼‰è¾¾åˆ°100%ï¼Œè¯´æ˜ç£ç›˜ä¸€ç›´è¢«å ç”¨ã€‚</span></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">  WRITE: bw=260MiB/s (273MB/s), 260MiB/s-260MiB/s (273MB/s-273MB/s), io=1000GiB (1074GB), run=3937369-3937369msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=41/4095920, merge=0/0, ticks=14/251312457, in_queue=251311675, util=100.00%</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4Kéšæœºå†™ï¼š"><a href="#4Kéšæœºå†™ï¼š" class="headerlink" title="4Kéšæœºå†™ï¼š"></a><strong>4Kéšæœºå†™ï¼š</strong></h3><table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å¹³å‡IOPS</strong></td>
<td align="left">26,000</td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡ååé‡</strong></td>
<td align="left">102 MiB&#x2F;s</td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡å»¶è¿Ÿ</strong></td>
<td align="left">1.22æ¯«ç§’</td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡</strong></td>
<td align="left">100%</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio --direct=1 --rw=randwrite  --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb --iodepth=32 --runtime=600  --bs=4k</span><br><span class="line">fio-randwrite: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [w(1)][100.0%][r=0KiB/s,w=102MiB/s][r=0,w=26.0k IOPS][eta 00m:00s]</span><br><span class="line"></span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=11639: Sun Sep 14 15:24:29 2025</span><br><span class="line">  write: IOPS=26.0k, BW=102MiB/s (107MB/s)(59.6GiB/600208msec) <span class="comment">#26,000 IOPS é«˜æ€§èƒ½SSDæˆ–NVMeç¡¬ç›˜ï¼ŒIOPSèŒƒå›´: 25,896 - 55,142 (æœ€ä½-æœ€é«˜)</span></span><br><span class="line">    slat (nsec): min=1824, max=137699, avg=3761.17, stdev=1377.41</span><br><span class="line">    clat (usec): min=285, max=208738, avg=1224.16, stdev=457.16 <span class="comment">#å¹³å‡å»¶è¿Ÿ: 1.22æ¯«ç§’ (1224å¾®ç§’)</span></span><br><span class="line">     lat (usec): min=290, max=208741, avg=1228.19, stdev=457.15</span><br><span class="line">    clat percentiles (usec): <span class="comment">#å»¶è¿Ÿè¡¨ç° (Latency),</span></span><br><span class="line">     |  1.00th=[  611],  5.00th=[  947], 10.00th=[  979], 20.00th=[ 1004],</span><br><span class="line">     | 30.00th=[ 1029], 40.00th=[ 1057], 50.00th=[ 1074], 60.00th=[ 1106], <span class="comment">#50%çš„è¯·æ±‚åœ¨1.07æ¯«ç§’å†…å®Œæˆ</span></span><br><span class="line">     | 70.00th=[ 1172], 80.00th=[ 1713], 90.00th=[ 1778], 95.00th=[ 1827], <span class="comment">#95%çš„è¯·æ±‚åœ¨1.83æ¯«ç§’å†…å®Œæˆ</span></span><br><span class="line">     | 99.00th=[ 1975], 99.50th=[ 2024], 99.90th=[ 4424], 99.95th=[ 4621], <span class="comment">#99%çš„è¯·æ±‚åœ¨1.98æ¯«ç§’å†…å®Œæˆ</span></span><br><span class="line">     | 99.99th=[ 5407]#æå°‘æ•°è¯·æ±‚(0.01%)å»¶è¿Ÿè¾ƒé«˜(5.4æ¯«ç§’)ï¼Œè¿™å±äºæ­£å¸¸æ³¢åŠ¨</span><br><span class="line">   bw (  KiB/s): min=103584, max=220568, per=100.00%, avg=104105.78, stdev=3424.83, samples=1200</span><br><span class="line">   iops        : min=25896, max=55142, avg=26026.45, stdev=856.21, samples=1200</span><br><span class="line">  lat (usec)   : 500=0.41%, 750=0.82%, 1000=15.98%</span><br><span class="line">  lat (msec)   : 2=82.14%, 4=0.49%, 10=0.16%, 250=0.01% <span class="comment">#æ€»å»¶è¿Ÿï¼ˆslat + clatï¼‰</span></span><br><span class="line">  cpu          : usr=5.52%, sys=15.09%, ctx=3406080, majf=0, minf=32 <span class="comment"># ç”¨æˆ·ç©ºé—´5.52%ï¼Œå†…æ ¸ç©ºé—´15.09%ï¼Œè¯´æ˜æ¶ˆè€—çš„æ˜¯I/Oèµ„æºï¼ŒCPUä¸æ˜¯ç“¶é¢ˆ</span></span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=0,15616422,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">  WRITE: bw=102MiB/s (107MB/s), 102MiB/s-102MiB/s (107MB/s-107MB/s), io=59.6GiB (63.0GB), run=600208-600208msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=41/15616420, merge=0/0, ticks=21/18778520, in_queue=18777870, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="4Kéšæœºè¯»"><a href="#4Kéšæœºè¯»" class="headerlink" title="4Kéšæœºè¯»"></a><strong>4Kéšæœºè¯»</strong></h3><table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">ç»“æœä¸å•ä½</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>IOPS</strong></td>
<td align="left"><strong>26,000</strong></td>
</tr>
<tr>
<td align="left"><strong>å¸¦å®½ (BW)</strong></td>
<td align="left"><strong>102 MiB&#x2F;s</strong></td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡å»¶è¿Ÿ (clat)</strong></td>
<td align="left"><strong>1224.46 Î¼s</strong> (çº¦ 1.22 ms)</td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡ (util)</strong></td>
<td align="left"><strong>100.00%</strong></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio --direct=1 --rw=randread  --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb --iodepth=32  --runtime=600 --bs=4k</span><br><span class="line">fio-randwrite: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [r(1)][100.0%][r=101MiB/s,w=0KiB/s][r=25.0k,w=0 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=12202: Sun Sep 14 15:40:35 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=26.0k, BW=102MiB/s (107MB/s)(59.6GiB/600002msec) <span class="comment"># IOPSä¸å¸¦å®½</span></span><br><span class="line">    slat (nsec): min=1795, max=147725, avg=3537.09, stdev=1508.45</span><br><span class="line">    clat (usec): min=151, max=7033, avg=1224.46, stdev=376.93 <span class="comment">#å¹³å‡å»¶è¿Ÿ</span></span><br><span class="line">     lat (usec): min=155, max=7036, avg=1228.29, stdev=376.97</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  627],  5.00th=[  873], 10.00th=[  938], 20.00th=[  988],</span><br><span class="line">     | 30.00th=[ 1012], 40.00th=[ 1045], 50.00th=[ 1074], 60.00th=[ 1106],</span><br><span class="line">     | 70.00th=[ 1188], 80.00th=[ 1680], 90.00th=[ 1860], 95.00th=[ 1926],</span><br><span class="line">     | 99.00th=[ 2008], 99.50th=[ 2040], 99.90th=[ 4047], 99.95th=[ 4359],</span><br><span class="line">     | 99.99th=[ 5145]</span><br><span class="line">   bw (  KiB/s): min=103584, max=200688, per=100.00%, avg=104131.86, stdev=3493.97, samples=1200</span><br><span class="line">   iops        : min=25896, max=50174, avg=26032.97, stdev=873.54, samples=1200</span><br><span class="line">  lat (usec)   : 250=0.01%, 500=0.48%, 750=2.11%, 1000=21.93%</span><br><span class="line">  lat (msec)   : 2=74.42%, 4=0.95%, 10=0.11%</span><br><span class="line">  cpu          : usr=3.01%, sys=14.54%, ctx=3004183, majf=0, minf=67</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=15620286,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=102MiB/s (107MB/s), 102MiB/s-102MiB/s (107MB/s-107MB/s), io=59.6GiB (63.0GB), run=600002-600002msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=15617264/0, merge=0/0, ticks=18811938/0, in_queue=18810717, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="4kéšæœº7-3æ··åˆè¯»å†™"><a href="#4kéšæœº7-3æ··åˆè¯»å†™" class="headerlink" title="4kéšæœº7:3æ··åˆè¯»å†™"></a><strong>4kéšæœº7:3æ··åˆè¯»å†™</strong></h3><table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">è¯»å–æ€§èƒ½</th>
<th align="left">å†™å…¥æ€§èƒ½</th>
<th align="left">è¯„ä»·</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>IOPS</strong></td>
<td align="left">26,000</td>
<td align="left">11,100</td>
<td align="left"><strong>æå…¶å‡ºè‰²</strong></td>
</tr>
<tr>
<td align="left"><strong>ååé‡</strong>(BW)</td>
<td align="left">102 MiB&#x2F;s</td>
<td align="left">43.6 MiB&#x2F;s</td>
<td align="left">ä¸4Kå—å¤§å°åŒ¹é…</td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡å»¶è¿Ÿ</strong>(Clat)</td>
<td align="left">0.99ms</td>
<td align="left">0.54ms</td>
<td align="left"><strong>è¶…ä½å»¶è¿Ÿ</strong></td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡</strong></td>
<td align="left">100%</td>
<td align="left">100%</td>
<td align="left">ç£ç›˜å®Œå…¨é¥±å’Œ</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯¹ç£ç›˜/dev/vdb è¿›è¡Œäº† 10åˆ†é’Ÿ(600ç§’)çš„4Kéšæœºæ··åˆè¯»å†™æµ‹è¯•ï¼Œè¯»å†™æ¯”ä¾‹ä¸º70%è¯»/30%å†™ï¼Œä½¿ç”¨æ·±åº¦é˜Ÿåˆ—(32)ã€‚</span></span><br><span class="line">fio --ioengine=libaio --direct=1 --rw=randrw  --rwmixread=70 --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb --iodepth=32  --runtime=600 --bs=4k </span><br><span class="line">fio-randwrite: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [m(1)][100.0%][r=102MiB/s,w=43.8MiB/s][r=26.0k,w=11.2k IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=12672: Sun Sep 14 15:54:10 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=26.0k, BW=102MiB/s (107MB/s)(59.6GiB/600003msec)</span><br><span class="line">    slat (nsec): min=1788, max=122280, avg=3695.80, stdev=1473.14</span><br><span class="line">    clat (usec): min=158, max=9285, avg=991.89, stdev=252.50</span><br><span class="line">     lat (usec): min=164, max=9289, avg=995.86, stdev=252.49</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  433],  5.00th=[  553], 10.00th=[  693], 20.00th=[  848],</span><br><span class="line">     | 30.00th=[  914], 40.00th=[  963], 50.00th=[  996], 60.00th=[ 1029],</span><br><span class="line">     | 70.00th=[ 1057], 80.00th=[ 1123], 90.00th=[ 1254], 95.00th=[ 1369],</span><br><span class="line">     | 99.00th=[ 1647], 99.50th=[ 1778], 99.90th=[ 3720], 99.95th=[ 4113],</span><br><span class="line">     | 99.99th=[ 4555]</span><br><span class="line">   bw (  KiB/s): min=103632, max=148232, per=100.00%, avg=104091.25, stdev=1882.41, samples=1200</span><br><span class="line">   iops        : min=25908, max=37058, avg=26022.83, stdev=470.60, samples=1200</span><br><span class="line">  write: IOPS=11.1k, BW=43.6MiB/s (45.7MB/s)(25.5GiB/600003msec)</span><br><span class="line">    slat (nsec): min=1844, max=74649, avg=3878.58, stdev=1460.63</span><br><span class="line">    clat (usec): min=271, max=9216, avg=537.67, stdev=156.54</span><br><span class="line">     lat (usec): min=276, max=9220, avg=541.82, stdev=156.57</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  355],  5.00th=[  392], 10.00th=[  412], 20.00th=[  441],</span><br><span class="line">     | 30.00th=[  465], 40.00th=[  494], 50.00th=[  529], 60.00th=[  553],</span><br><span class="line">     | 70.00th=[  586], 80.00th=[  619], 90.00th=[  668], 95.00th=[  717],</span><br><span class="line">     | 99.00th=[  832], 99.50th=[  922], 99.90th=[ 3458], 99.95th=[ 4015],</span><br><span class="line">     | 99.99th=[ 4228]</span><br><span class="line">   bw (  KiB/s): min=42416, max=63880, per=100.00%, avg=44596.01, stdev=1121.21, samples=1200</span><br><span class="line">   iops        : min=10604, max=15970, avg=11148.99, stdev=280.30, samples=1200</span><br><span class="line">  lat (usec)   : 250=0.01%, 500=14.86%, 750=23.18%, 1000=28.56%</span><br><span class="line">  lat (msec)   : 2=33.25%, 4=0.09%, 10=0.06%</span><br><span class="line">  cpu          : usr=5.69%, sys=22.40%, ctx=4720003, majf=0, minf=34</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=15614245,6689629,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line"></span><br><span class="line">   READ: bw=102MiB/s (107MB/s), 102MiB/s-102MiB/s (107MB/s-107MB/s), io=59.6GiB (63.0GB), run=600003-600003msec</span><br><span class="line">  WRITE: bw=43.6MiB/s (45.7MB/s), 43.6MiB/s-43.6MiB/s (45.7MB/s-45.7MB/s), io=25.5GiB (27.4GB), run=600003-600003msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=15611269/6688288, merge=0/0, ticks=15107080/3522581, in_queue=18628447, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="å‘½ä»¤è¡Œè§£é‡Šï¼š"><a href="#å‘½ä»¤è¡Œè§£é‡Šï¼š" class="headerlink" title="å‘½ä»¤è¡Œè§£é‡Šï¼š"></a>å‘½ä»¤è¡Œè§£é‡Šï¼š</h3><table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">å«ä¹‰</th>
<th align="left">ç›¸å½“äº</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>--rw=read/write/randread/randwrite</code></td>
<td align="left"><strong>æµ‹ä»€ä¹ˆ</strong>ï¼Ÿ (è¯»&#x2F;å†™&#x2F;éšæœºè¯»&#x2F;éšæœºå†™)</td>
<td align="left"><strong>æµ‹è¯•ç±»å‹</strong></td>
</tr>
<tr>
<td align="left"><code>--bs=4k/1M</code></td>
<td align="left"><strong>æ¯æ¬¡è¿å¤šå°‘</strong>ï¼Ÿ (å°åŒ…&#x3D;æµ‹IOPSï¼Œå¤§åŒ…&#x3D;æµ‹å¸¦å®½)</td>
<td align="left"><strong>å—å¤§å°</strong></td>
</tr>
<tr>
<td align="left"><code>--iodepth=1/32</code></td>
<td align="left"><strong>æ´¾å¤šå°‘è¾†è½¦åŒæ—¶è¿</strong>ï¼Ÿ (1&#x3D;æµ‹å»¶è¿Ÿï¼Œ32&#x3D;æµ‹å³°å€¼)</td>
<td align="left"><strong>é˜Ÿåˆ—æ·±åº¦</strong></td>
</tr>
</tbody></table>
<p><strong>å¸¸ç”¨ç»„åˆï¼š</strong></p>
<ul>
<li><strong>æµ‹å»¶è¿Ÿå’ŒIOPS</strong>ï¼š<code>bs=4k, iodepth=1</code> (å¿«é€’å‘˜ä¸€æ¬¡é€ä¸€ä¸ªå°ä»¶)</li>
<li><strong>æµ‹æœ€å¤§ååå¸¦å®½</strong>ï¼š<code>bs=1M, iodepth=32</code> (ç”¨å¤§å¡è½¦è½¦é˜Ÿæ‹‰è´§)</li>
<li><strong>æµ‹æœ€å¤§IOPS</strong>ï¼š<code>bs=4k, iodepth=32</code> (ç”¨æ‘©æ‰˜è½¦è½¦é˜Ÿé€å°ä»¶)</li>
</ul>
<h3 id="256Ké¡ºåºå†™"><a href="#256Ké¡ºåºå†™" class="headerlink" title="256Ké¡ºåºå†™"></a>256Ké¡ºåºå†™</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio --direct=1 --rw=write  --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb --iodepth=32 --runtime=600  --bs=256k</span><br><span class="line">fio-randwrite: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [W(1)][100.0%][r=0KiB/s,w=260MiB/s][r=0,w=1040 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=14539: Sun Sep 14 16:43:06 2025</span><br><span class="line">  write: IOPS=1041, BW=260MiB/s (273MB/s)(153GiB/600031msec)</span><br><span class="line">    slat (nsec): min=6675, max=83106, avg=23107.73, stdev=7365.32</span><br><span class="line">    clat (msec): min=2, max=666, avg=30.64, stdev= 1.54</span><br><span class="line">     lat (msec): min=2, max=666, avg=30.66, stdev= 1.54</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[29230],  5.00th=[29754], 10.00th=[30016], 20.00th=[30278],</span><br><span class="line">     | 30.00th=[30540], 40.00th=[30802], 50.00th=[30802], 60.00th=[30802],</span><br><span class="line">     | 70.00th=[31065], 80.00th=[31065], 90.00th=[31065], 95.00th=[31327],</span><br><span class="line">     | 99.00th=[31851], 99.50th=[33424], 99.90th=[34866], 99.95th=[34866],</span><br><span class="line">     | 99.99th=[35390]</span><br><span class="line">   bw (  KiB/s): min=264704, max=797696, per=100.00%, avg=266675.22, stdev=15345.76, samples=1200</span><br><span class="line">   iops        : min= 1034, max= 3116, avg=1041.68, stdev=59.95, samples=1200</span><br><span class="line">  lat (msec)   : 4=0.05%, 10=0.14%, 20=0.01%, 50=99.80%, 100=0.01%</span><br><span class="line">  lat (msec)   : 750=0.01%</span><br><span class="line">  cpu          : usr=6.04%, sys=2.70%, ctx=606905, majf=0, minf=31</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=0,625077,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">  WRITE: bw=260MiB/s (273MB/s), 260MiB/s-260MiB/s (273MB/s-273MB/s), io=153GiB (164GB), run=600031-600031msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=40/624916, merge=0/0, ticks=21/19139965, in_queue=19140388, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="256Ké¡ºåºè¯»"><a href="#256Ké¡ºåºè¯»" class="headerlink" title="256Ké¡ºåºè¯»"></a>256Ké¡ºåºè¯»</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">fio --ioengine=libaio --direct=1 --rw=<span class="built_in">read</span>  --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting --name=fio-test --size=300G --filename=/dev/vdb --iodepth=32 --runtime=600 --bs=256k</span><br><span class="line">fio-test: (g=0): rw=<span class="built_in">read</span>, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [R(1)][100.0%][r=260MiB/s,w=0KiB/s][r=1040,w=0 IOPS][eta 00m:00s]</span><br><span class="line">fio-test: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=14943: Sun Sep 14 16:55:03 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=1041, BW=260MiB/s (273MB/s)(153GiB/600031msec)</span><br><span class="line">    slat (usec): min=9, max=1467, avg=23.27, stdev= 6.28</span><br><span class="line">    clat (usec): min=2138, max=59974, avg=30693.36, stdev=1249.32</span><br><span class="line">     lat (usec): min=2150, max=60002, avg=30716.91, stdev=1249.24</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[29492],  5.00th=[29754], 10.00th=[30016], 20.00th=[30278],</span><br><span class="line">     | 30.00th=[30802], 40.00th=[30802], 50.00th=[30802], 60.00th=[31065],</span><br><span class="line">     | 70.00th=[31065], 80.00th=[31065], 90.00th=[31065], 95.00th=[31327],</span><br><span class="line">     | 99.00th=[31589], 99.50th=[33162], 99.90th=[34866], 99.95th=[35390],</span><br><span class="line">     | 99.99th=[35914]</span><br><span class="line">   bw (  KiB/s): min=264704, max=797696, per=100.00%, avg=266673.60, stdev=15345.36, samples=1200</span><br><span class="line">   iops        : min= 1034, max= 3116, avg=1041.68, stdev=59.94, samples=1200</span><br><span class="line">  lat (msec)   : 4=0.02%, 10=0.18%, 20=0.03%, 50=99.78%, 100=0.01%</span><br><span class="line">  cpu          : usr=0.19%, sys=2.98%, ctx=624157, majf=0, minf=548</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=625069,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=260MiB/s (273MB/s), 260MiB/s-260MiB/s (273MB/s-273MB/s), io=153GiB (164GB), run=600031-600031msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=624912/0, merge=0/0, ticks=19178741/0, in_queue=19179226, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="256Ké¡ºåº7-3æ··åˆè¯»å†™"><a href="#256Ké¡ºåº7-3æ··åˆè¯»å†™" class="headerlink" title="256Ké¡ºåº7:3æ··åˆè¯»å†™"></a>256Ké¡ºåº7:3æ··åˆè¯»å†™</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> fio --ioengine=libaio --direct=1 --rw=rw  --rwmixread=70 --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb --iodepth=32  --runtime=600 --bs=256k</span><br><span class="line">fio-randwrite: (g=0): rw=rw, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=1): [M(1)][100.0%][r=260MiB/s,w=116MiB/s][r=1041,w=462 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=15542: Sun Sep 14 17:12:24 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=1041, BW=260MiB/s (273MB/s)(153GiB/600031msec)</span><br><span class="line">    slat (usec): min=9, max=224, avg=23.66, stdev= 6.05</span><br><span class="line">    clat (usec): min=1389, max=74402, avg=30065.00, stdev=1577.33</span><br><span class="line">     lat (usec): min=1416, max=74416, avg=30088.95, stdev=1577.27</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[27395],  5.00th=[28705], 10.00th=[28967], 20.00th=[29492],</span><br><span class="line">     | 30.00th=[29754], 40.00th=[30016], 50.00th=[30016], 60.00th=[30540],</span><br><span class="line">     | 70.00th=[30802], 80.00th=[31065], 90.00th=[31065], 95.00th=[31327],</span><br><span class="line">     | 99.00th=[31589], 99.50th=[32375], 99.90th=[34341], 99.95th=[34866],</span><br><span class="line">     | 99.99th=[57410]</span><br><span class="line">   bw (  KiB/s): min=264704, max=660992, per=100.00%, avg=266711.21, stdev=12484.86, samples=1200</span><br><span class="line">   iops        : min= 1034, max= 2582, avg=1041.83, stdev=48.77, samples=1200</span><br><span class="line">  write: IOPS=447, BW=112MiB/s (117MB/s)(65.5GiB/600031msec)</span><br><span class="line">    slat (usec): min=6, max=198, avg=23.32, stdev= 7.29</span><br><span class="line">    clat (usec): min=792, max=167378, avg=1376.91, stdev=636.48</span><br><span class="line">     lat (usec): min=803, max=167388, avg=1400.52, stdev=636.57</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  996],  5.00th=[ 1057], 10.00th=[ 1106], 20.00th=[ 1139],</span><br><span class="line">     | 30.00th=[ 1172], 40.00th=[ 1205], 50.00th=[ 1254], 60.00th=[ 1303],</span><br><span class="line">     | 70.00th=[ 1418], 80.00th=[ 1582], 90.00th=[ 1762], 95.00th=[ 1893],</span><br><span class="line">     | 99.00th=[ 2343], 99.50th=[ 4359], 99.90th=[ 8586], 99.95th=[10028],</span><br><span class="line">     | 99.99th=[13698]</span><br><span class="line">   bw (  KiB/s): min=87040, max=307200, per=100.00%, avg=114523.47, stdev=10872.32, samples=1200</span><br><span class="line">   iops        : min=  340, max= 1200, avg=447.35, stdev=42.47, samples=1200</span><br><span class="line">  lat (usec)   : 1000=0.34%</span><br><span class="line">  lat (msec)   : 2=28.80%, 4=0.75%, 10=0.31%, 20=0.07%, 50=69.73%</span><br><span class="line">  lat (msec)   : 100=0.01%, 250=0.01%</span><br><span class="line">  cpu          : usr=2.79%, sys=4.21%, ctx=797662, majf=0, minf=33</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=625152,268421,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=260MiB/s (273MB/s), 260MiB/s-260MiB/s (273MB/s-273MB/s), io=153GiB (164GB), run=600031-600031msec</span><br><span class="line">  WRITE: bw=112MiB/s (117MB/s), 112MiB/s-112MiB/s (117MB/s-117MB/s), io=65.5GiB (70.4GB), run=600031-600031msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=625031/268369, merge=0/0, ticks=18779993/364832, in_queue=19145288, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="å¤šå—ç›˜4Kéšæœºå†™ï¼š"><a href="#å¤šå—ç›˜4Kéšæœºå†™ï¼š" class="headerlink" title="å¤šå—ç›˜4Kéšæœºå†™ï¼š"></a>å¤šå—ç›˜4Kéšæœºå†™ï¼š</h3><table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">ç»“æœ</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>èšåˆIOPS</strong></td>
<td align="left">52,500</td>
<td>æ˜¯5å—ç£ç›˜çš„èšåˆæ€§èƒ½ï¼Œå¹³å‡æ¯å—ç£ç›˜çº¦10,500 IOPS,ä¸ä¹‹å‰å•ç›˜æµ‹è¯•çš„26,000 IOPSç›¸æ¯”ï¼Œ5ç›˜å¹¶è¡Œè¾¾åˆ°äº†52,500 IOPSï¼Œæ€§èƒ½æå‡çº¦2å€(ä¸æ˜¯5å€)ï¼Œè¿™è¡¨æ˜å¯èƒ½å­˜åœ¨ä¸€äº›å…±äº«èµ„æºç“¶é¢ˆ(å¦‚PCIeé€šé“æˆ–å­˜å‚¨æ§åˆ¶å™¨)ï¼Œä½†æ•´ä½“æ‰©å±•æ€§ä»ç„¶è‰¯å¥½ã€‚</td>
</tr>
<tr>
<td align="left"><strong>èšåˆå¸¦å®½</strong></td>
<td align="left">205 MiB&#x2F;s (215 MB&#x2F;s)</td>
<td></td>
</tr>
<tr>
<td align="left"><strong>å¹³å‡å»¶è¿Ÿ</strong></td>
<td align="left">0.60ms</td>
<td>å¹³å‡ä»…0.60msï¼Œ99%çš„è¯·æ±‚åœ¨0.89mså†…å®Œæˆ</td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜æ•°é‡</strong></td>
<td align="left">5å—</td>
<td></td>
</tr>
<tr>
<td align="left"><strong>æµ‹è¯•æ—¶é•¿</strong></td>
<td align="left">600ç§’(10åˆ†é’Ÿ)</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM_172_180_centos ~]# <span class="built_in">cat</span> 4k </span><br><span class="line">fio --ioengine=libaio --direct=1 --rw=randwrite --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32 --runtime=600  --bs=4k</span><br><span class="line">fio --ioengine=libaio --direct=1 --rw=randread --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32 --runtime=600  --bs=4k</span><br><span class="line">fio --ioengine=libaio --direct=1 --rw=randrw  --rwmixread=70 --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32  --runtime=600 --bs=4k </span><br><span class="line">[root@VM_172_180_centos ~]# sh 4k </span><br><span class="line">fio-randwrite: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [w(1)][100.0%][r=0KiB/s,w=201MiB/s][r=0,w=51.3k IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=16421: Sun Sep 14 17:33:42 2025</span><br><span class="line">  write: IOPS=52.5k, BW=205MiB/s (215MB/s)(120GiB/600001msec)</span><br><span class="line">    slat (usec): min=2, max=189, avg= 5.40, stdev= 1.58</span><br><span class="line">    clat (usec): min=283, max=6328, avg=601.34, stdev=145.28</span><br><span class="line">     lat (usec): min=287, max=6334, avg=607.05, stdev=145.25</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  437],  5.00th=[  474], 10.00th=[  494], 20.00th=[  523],</span><br><span class="line">     | 30.00th=[  545], 40.00th=[  562], 50.00th=[  586], 60.00th=[  611],</span><br><span class="line">     | 70.00th=[  635], 80.00th=[  668], 90.00th=[  717], 95.00th=[  766],</span><br><span class="line">     | 99.00th=[  889], 99.50th=[  971], 99.90th=[ 1500], 99.95th=[ 4113],</span><br><span class="line">     | 99.99th=[ 4817]</span><br><span class="line">   bw (  KiB/s): min=183928, max=234600, per=99.99%, avg=210177.37, stdev=6712.20, samples=1199</span><br><span class="line">   iops        : min=45982, max=58650, avg=52544.35, stdev=1678.06, samples=1199</span><br><span class="line">  lat (usec)   : 500=12.15%, 750=81.70%, 1000=5.74%</span><br><span class="line">  lat (msec)   : 2=0.33%, 4=0.03%, 10=0.07%</span><br><span class="line">  <span class="comment">#ç”¨æˆ·ç©ºé—´10.90%ï¼Œå†…æ ¸ç©ºé—´38.92%,å†…æ ¸CPUä½¿ç”¨ç‡è¾ƒé«˜æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºéœ€è¦å¤„ç†å¤§é‡I/Oè¯·æ±‚ï¼Œä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¾ƒå¤š(641ä¸‡æ¬¡)ï¼Œè¿™æ˜¯å¤šç£ç›˜å¹¶è¡Œæ“ä½œçš„ç‰¹ç‚¹</span></span><br><span class="line">  cpu          : usr=10.90%, sys=38.92%, ctx=6416674, majf=0, minf=42 </span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=0,31528375,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">  WRITE: bw=205MiB/s (215MB/s), 205MiB/s-205MiB/s (215MB/s-215MB/s), io=120GiB (129GB), run=600001-600001msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=41/6304332, merge=0/0, ticks=28/3689920, in_queue=3689073, util=100.00%</span><br><span class="line">  vdc: ios=41/6304332, merge=0/0, ticks=24/3703542, in_queue=3702711, util=100.00%</span><br><span class="line">  vdd: ios=40/6304332, merge=0/0, ticks=23/3706136, in_queue=3705460, util=100.00%</span><br><span class="line">  vde: ios=40/6304334, merge=0/0, ticks=25/3705165, in_queue=3704394, util=100.00%</span><br><span class="line">  vdf: ios=32/6304332, merge=0/0, ticks=21/3705596, in_queue=3704844, util=100.00%</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="å¤šå—ç›˜4Kéšæœºè¯»ï¼š"><a href="#å¤šå—ç›˜4Kéšæœºè¯»ï¼š" class="headerlink" title="å¤šå—ç›˜4Kéšæœºè¯»ï¼š"></a>å¤šå—ç›˜4Kéšæœºè¯»ï¼š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio-randwrite: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [r(1)][100.0%][r=196MiB/s,w=0KiB/s][r=50.1k,w=0 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=16818: Sun Sep 14 17:43:43 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=49.4k, BW=193MiB/s (202MB/s)(113GiB/600001msec)</span><br><span class="line">    slat (usec): min=2, max=100, avg= 5.49, stdev= 1.39</span><br><span class="line">    clat (usec): min=144, max=7269, avg=641.45, stdev=184.12</span><br><span class="line">     lat (usec): min=149, max=7274, avg=647.23, stdev=184.12</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  379],  5.00th=[  453], 10.00th=[  490], 20.00th=[  537],</span><br><span class="line">     | 30.00th=[  570], 40.00th=[  594], 50.00th=[  619], 60.00th=[  644],</span><br><span class="line">     | 70.00th=[  676], 80.00th=[  725], 90.00th=[  799], 95.00th=[  865],</span><br><span class="line">     | 99.00th=[ 1106], 99.50th=[ 1614], 99.90th=[ 3097], 99.95th=[ 3884],</span><br><span class="line">     | 99.99th=[ 4424]</span><br><span class="line">   bw (  KiB/s): min=131240, max=218152, per=99.99%, avg=197466.52, stdev=9655.55, samples=1200</span><br><span class="line">   iops        : min=32810, max=54538, avg=49366.64, stdev=2413.89, samples=1200</span><br><span class="line">  lat (usec)   : 250=0.03%, 500=11.92%, 750=72.06%, 1000=14.56%</span><br><span class="line">  lat (msec)   : 2=1.27%, 4=0.13%, 10=0.04%</span><br><span class="line">  cpu          : usr=5.70%, sys=37.43%, ctx=5033016, majf=0, minf=77</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=29622379,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=193MiB/s (202MB/s), 193MiB/s-193MiB/s (202MB/s-202MB/s), io=113GiB (121GB), run=600001-600001msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=5923231/0, merge=0/0, ticks=3671641/0, in_queue=3671080, util=100.00%</span><br><span class="line">  vdc: ios=5923233/0, merge=0/0, ticks=3751928/0, in_queue=3751240, util=100.00%</span><br><span class="line">  vdd: ios=5923231/0, merge=0/0, ticks=3752874/0, in_queue=3752289, util=100.00%</span><br><span class="line">  vde: ios=5923233/0, merge=0/0, ticks=3754781/0, in_queue=3754222, util=100.00%</span><br><span class="line">  vdf: ios=5923233/0, merge=0/0, ticks=3754502/0, in_queue=3754122, util=100.00%</span><br></pre></td></tr></table></figure>



<h3 id="å¤šå—ç›˜4Kéšæœº7-3æ··å’Œè¯»å†™ï¼š"><a href="#å¤šå—ç›˜4Kéšæœº7-3æ··å’Œè¯»å†™ï¼š" class="headerlink" title="å¤šå—ç›˜4Kéšæœº7:3æ··å’Œè¯»å†™ï¼š"></a>å¤šå—ç›˜4Kéšæœº7:3æ··å’Œè¯»å†™ï¼š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio-randwrite: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [m(1)][100.0%][r=141MiB/s,w=60.4MiB/s][r=36.2k,w=15.5k IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=17159: Sun Sep 14 17:53:43 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=35.7k, BW=139MiB/s (146MB/s)(81.7GiB/600001msec)</span><br><span class="line">    slat (nsec): min=1987, max=132833, avg=5552.38, stdev=1567.02</span><br><span class="line">    clat (usec): min=146, max=5624, avg=594.68, stdev=151.94</span><br><span class="line">     lat (usec): min=151, max=5629, avg=600.54, stdev=151.92</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  379],  5.00th=[  429], 10.00th=[  457], 20.00th=[  498],</span><br><span class="line">     | 30.00th=[  529], 40.00th=[  553], 50.00th=[  578], 60.00th=[  611],</span><br><span class="line">     | 70.00th=[  635], 80.00th=[  676], 90.00th=[  742], 95.00th=[  799],</span><br><span class="line">     | 99.00th=[  922], 99.50th=[  979], 99.90th=[ 1565], 99.95th=[ 3851],</span><br><span class="line">     | 99.99th=[ 4359]</span><br><span class="line">   bw (  KiB/s): min=122144, max=159920, per=99.99%, avg=142736.96, stdev=6141.07, samples=1199</span><br><span class="line">   iops        : min=30536, max=39980, avg=35684.24, stdev=1535.27, samples=1199</span><br><span class="line">  write: IOPS=15.3k, BW=59.8MiB/s (62.7MB/s)(35.0GiB/600001msec)</span><br><span class="line">    slat (nsec): min=2087, max=96123, avg=5655.39, stdev=1576.16</span><br><span class="line">    clat (usec): min=286, max=6765, avg=680.60, stdev=165.39</span><br><span class="line">     lat (usec): min=294, max=6770, avg=686.57, stdev=165.38</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[  457],  5.00th=[  506], 10.00th=[  537], 20.00th=[  578],</span><br><span class="line">     | 30.00th=[  603], 40.00th=[  635], 50.00th=[  668], 60.00th=[  693],</span><br><span class="line">     | 70.00th=[  734], 80.00th=[  775], 90.00th=[  832], 95.00th=[  889],</span><br><span class="line">     | 99.00th=[ 1020], 99.50th=[ 1090], 99.90th=[ 3556], 99.95th=[ 4113],</span><br><span class="line">     | 99.99th=[ 4621]</span><br><span class="line">   bw (  KiB/s): min=52072, max=68832, per=99.99%, avg=61183.93, stdev=2677.88, samples=1199</span><br><span class="line">   iops        : min=13018, max=17208, avg=15295.97, stdev=669.45, samples=1199</span><br><span class="line">  lat (usec)   : 250=0.01%, 500=15.94%, 750=70.14%, 1000=13.27%</span><br><span class="line">  lat (msec)   : 2=0.55%, 4=0.06%, 10=0.04%</span><br><span class="line">  cpu          : usr=7.52%, sys=38.29%, ctx=4810743, majf=0, minf=44</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=21412293,9178326,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=139MiB/s (146MB/s), 139MiB/s-139MiB/s (146MB/s-146MB/s), io=81.7GiB (87.7GB), run=600001-600001msec</span><br><span class="line">  WRITE: bw=59.8MiB/s (62.7MB/s), 59.8MiB/s-59.8MiB/s (62.7MB/s-62.7MB/s), io=35.0GiB (37.6GB), run=600001-600001msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=4280455/1836455, merge=0/0, ticks=2488506/1221541, in_queue=3709393, util=100.00%</span><br><span class="line">  vdc: ios=4282591/1834319, merge=0/0, ticks=2490361/1223424, in_queue=3713056, util=100.00%</span><br><span class="line">  vdd: ios=4281157/1835753, merge=0/0, ticks=2488556/1226174, in_queue=3714052, util=100.00%</span><br><span class="line">  vde: ios=4282710/1834197, merge=0/0, ticks=2491021/1223394, in_queue=3713691, util=100.00%</span><br><span class="line">  vdf: ios=4281131/1835766, merge=0/0, ticks=2490609/1224589, in_queue=3714491, util=100.00%</span><br></pre></td></tr></table></figure>

<h3 id="å¤šå—ç›˜256Ké¡ºåºå†™"><a href="#å¤šå—ç›˜256Ké¡ºåºå†™" class="headerlink" title="å¤šå—ç›˜256Ké¡ºåºå†™"></a>å¤šå—ç›˜256Ké¡ºåºå†™</h3><h4 id="æ€§èƒ½æ¦‚è§ˆ"><a href="#æ€§èƒ½æ¦‚è§ˆ" class="headerlink" title="æ€§èƒ½æ¦‚è§ˆ"></a>æ€§èƒ½æ¦‚è§ˆ</h4><ul>
<li><strong>èšåˆå¸¦å®½</strong>: 1302 MiB&#x2F;s (1365 MB&#x2F;s)</li>
<li><strong>èšåˆIOPS</strong>: 5208</li>
<li><strong>å¹³å‡å»¶è¿Ÿ</strong>: 6066.98å¾®ç§’ï¼ˆçº¦6æ¯«ç§’ï¼‰</li>
<li><strong>æµ‹è¯•æ•°æ®é‡</strong>: 763 GiB</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio --direct=1 --rw=write --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32 --runtime=600  --bs=256k</span><br><span class="line">fio-randwrite: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [W(1)][81.5%][r=0KiB/s,w=1301MiB/s][r=0,w=5204 IOPS][eta 01m:51s]</span><br><span class="line">Jobs: 1 (f=5): [W(1)][100.0%][r=0KiB/s,w=1300MiB/s][r=0,w=5200 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=20208: Sun Sep 14 19:20:40 2025</span><br><span class="line">  write: IOPS=5208, BW=1302MiB/s (1365MB/s)(763GiB/600009msec)</span><br><span class="line">    slat (usec): min=8, max=211, avg=23.32, stdev= 7.45</span><br><span class="line">    clat (usec): min=1385, max=64973, avg=6066.98, stdev=1060.84</span><br><span class="line">     lat (usec): min=1412, max=64984, avg=6090.60, stdev=1060.63</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[ 3785],  5.00th=[ 4490], 10.00th=[ 4817], 20.00th=[ 5211],</span><br><span class="line">     | 30.00th=[ 5473], 40.00th=[ 5800], 50.00th=[ 5932], 60.00th=[ 6128],</span><br><span class="line">     | 70.00th=[ 6587], 80.00th=[ 6980], 90.00th=[ 7570], 95.00th=[ 7898],</span><br><span class="line">     | 99.00th=[ 8586], 99.50th=[ 9110], 99.90th=[10552], 99.95th=[11076],</span><br><span class="line">     | 99.99th=[12125]</span><br><span class="line">   <span class="comment">#å¸¦å®½æ³¢åŠ¨èŒƒå›´: 1,295-2,713 MiB/sï¼Œè¡¨ç°ç›¸å¯¹ç¨³å®š</span></span><br><span class="line">   bw (  MiB/s): min= 1295, max= 2713, per=99.99%, avg=1301.99, stdev=51.52, samples=1200</span><br><span class="line">   iops        : min= 5180, max=10852, avg=5207.92, stdev=206.07, samples=1200</span><br><span class="line">  lat (msec)   : 2=0.02%, 4=1.60%, 10=98.22%, 20=0.17%, 50=0.01%</span><br><span class="line">  lat (msec)   : 100=0.01%</span><br><span class="line">  cpu          : usr=28.61%, sys=13.14%, ctx=1262492, majf=0, minf=41</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=0,3125122,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">  WRITE: bw=1302MiB/s (1365MB/s), 1302MiB/s-1302MiB/s (1365MB/s-1365MB/s), io=763GiB (819GB), run=600009-600009msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=41/624879, merge=0/0, ticks=25/3972394, in_queue=3972447, util=100.00%</span><br><span class="line">  vdc: ios=41/624880, merge=0/0, ticks=27/3583845, in_queue=3583902, util=100.00%</span><br><span class="line">  vdd: ios=40/624880, merge=0/0, ticks=26/3522861, in_queue=3522906, util=100.00%</span><br><span class="line">  vde: ios=40/624876, merge=0/0, ticks=22/4553654, in_queue=4553645, util=100.00%</span><br><span class="line">  vdf: ios=39/624880, merge=0/0, ticks=33/3169253, in_queue=3169239, util=100.00%</span><br></pre></td></tr></table></figure>



<h3 id="å¤šå—ç›˜256Ké¡ºåºè¯»"><a href="#å¤šå—ç›˜256Ké¡ºåºè¯»" class="headerlink" title="å¤šå—ç›˜256Ké¡ºåºè¯»"></a>å¤šå—ç›˜256Ké¡ºåºè¯»</h3><h4 id="æ€§èƒ½æ¦‚è§ˆ-1"><a href="#æ€§èƒ½æ¦‚è§ˆ-1" class="headerlink" title="æ€§èƒ½æ¦‚è§ˆ"></a>æ€§èƒ½æ¦‚è§ˆ</h4><ul>
<li><strong>èšåˆå¸¦å®½</strong>: 1084 MiB&#x2F;s </li>
<li><strong>èšåˆIOPS</strong>: 4334</li>
<li><strong>å¹³å‡å»¶è¿Ÿ</strong>: 7381.77å¾®ç§’ï¼ˆçº¦7æ¯«ç§’ï¼‰</li>
<li><strong>æµ‹è¯•æ•°æ®é‡</strong>: 635GiB</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fio --ioengine=libaio --direct=1 --rw=<span class="built_in">read</span> --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32 --runtime=600  --bs=256k</span><br><span class="line">fio-randwrite: (g=0): rw=<span class="built_in">read</span>, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [R(1)][100.0%][r=1112MiB/s,w=0KiB/s][r=4449,w=0 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=20560: Sun Sep 14 19:30:40 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=4334, BW=1084MiB/s (1136MB/s)(635GiB/600004msec)</span><br><span class="line">    slat (usec): min=9, max=1256, avg=24.92, stdev= 8.28</span><br><span class="line">    clat (usec): min=657, max=118445, avg=7356.55, stdev=2667.91</span><br><span class="line">     lat (usec): min=685, max=118473, avg=7381.77, stdev=2667.87</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[ 1762],  5.00th=[ 3130], 10.00th=[ 4080], 20.00th=[ 5211],</span><br><span class="line">     | 30.00th=[ 5997], 40.00th=[ 6652], 50.00th=[ 7242], 60.00th=[ 7832],</span><br><span class="line">     | 70.00th=[ 8455], 80.00th=[ 9372], 90.00th=[10814], 95.00th=[12125],</span><br><span class="line">     | 99.00th=[14615], 99.50th=[15664], 99.90th=[17957], 99.95th=[19006],</span><br><span class="line">     | 99.99th=[21365]</span><br><span class="line">   bw (  MiB/s): min=  931, max= 1205, per=99.99%, avg=1083.46, stdev=27.93, samples=1200</span><br><span class="line">   iops        : min= 3726, max= 4820, avg=4333.83, stdev=111.73, samples=1200</span><br><span class="line">  lat (usec)   : 750=0.01%, 1000=0.02%</span><br><span class="line">  lat (msec)   : 2=1.50%, 4=7.94%, 10=75.93%, 20=14.59%, 50=0.02%</span><br><span class="line">  lat (msec)   : 100=0.01%, 250=0.01%</span><br><span class="line">  cpu          : usr=0.79%, sys=14.57%, ctx=2554943, majf=0, minf=559</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=2600625,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=1084MiB/s (1136MB/s), 1084MiB/s-1084MiB/s (1136MB/s-1136MB/s), io=635GiB (682GB), run=600004-600004msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=520011/0, merge=0/0, ticks=3799217/0, in_queue=3799160, util=100.00%</span><br><span class="line">  vdc: ios=520013/0, merge=0/0, ticks=3815168/0, in_queue=3815099, util=100.00%</span><br><span class="line">  vdd: ios=520012/0, merge=0/0, ticks=3820941/0, in_queue=3820893, util=100.00%</span><br><span class="line">  vde: ios=520012/0, merge=0/0, ticks=3838577/0, in_queue=3838502, util=100.00%</span><br><span class="line">  vdf: ios=520010/0, merge=0/0, ticks=3823661/0, in_queue=3823597, util=100.00%</span><br></pre></td></tr></table></figure>



<h3 id="å¤šå—ç›˜256Kéšæœº7-3æ··å’Œè¯»å†™"><a href="#å¤šå—ç›˜256Kéšæœº7-3æ··å’Œè¯»å†™" class="headerlink" title="å¤šå—ç›˜256Kéšæœº7:3æ··å’Œè¯»å†™"></a>å¤šå—ç›˜256Kéšæœº7:3æ··å’Œè¯»å†™</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM_172_180_centos ~]# fio --ioengine=libaio --direct=1 --rw=rw  --rwmixread=70 --time_based --refill_buffers --norandommap --randrepeat=0 --group_reporting  --name=fio-randwrite --size=300G --filename=/dev/vdb:/dev/vdc:/dev/vdd:/dev/vde:/dev/vdf --iodepth=32  --runtime=600 --bs=256k</span><br><span class="line">fio-randwrite: (g=0): rw=rw, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=32</span><br><span class="line">fio-3.7</span><br><span class="line">Starting 1 process</span><br><span class="line">Jobs: 1 (f=5): [M(1)][100.0%][r=822MiB/s,w=338MiB/s][r=3287,w=1351 IOPS][eta 00m:00s]</span><br><span class="line">fio-randwrite: (groupid=0, <span class="built_in">jobs</span>=1): err= 0: pid=21771: Sun Sep 14 20:03:22 2025</span><br><span class="line">   <span class="built_in">read</span>: IOPS=3274, BW=819MiB/s (858MB/s)(480GiB/600006msec)</span><br><span class="line">    slat (usec): min=9, max=693, avg=25.26, stdev= 8.80</span><br><span class="line">    clat (usec): min=897, max=154693, avg=6634.02, stdev=1806.17</span><br><span class="line">     lat (usec): min=910, max=154719, avg=6659.59, stdev=1806.11</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[ 2606],  5.00th=[ 3752], 10.00th=[ 4424], 20.00th=[ 5211],</span><br><span class="line">     | 30.00th=[ 5735], 40.00th=[ 6194], 50.00th=[ 6587], 60.00th=[ 7046],</span><br><span class="line">     | 70.00th=[ 7504], 80.00th=[ 8094], 90.00th=[ 8848], 95.00th=[ 9503],</span><br><span class="line">     | 99.00th=[10945], 99.50th=[11469], 99.90th=[12780], 99.95th=[13304],</span><br><span class="line">     | 99.99th=[15533]</span><br><span class="line">   bw (  KiB/s): min=680960, max=946176, per=99.99%, avg=838058.46, stdev=28357.45, samples=1200</span><br><span class="line">   iops        : min= 2660, max= 3696, avg=3273.63, stdev=110.79, samples=1200</span><br><span class="line">  write: IOPS=1403, BW=351MiB/s (368MB/s)(206GiB/600006msec)</span><br><span class="line">    slat (usec): min=6, max=540, avg=25.84, stdev=10.75</span><br><span class="line">    clat (usec): min=1066, max=219266, avg=7181.33, stdev=1876.67</span><br><span class="line">     lat (usec): min=1095, max=219295, avg=7207.48, stdev=1876.68</span><br><span class="line">    clat percentiles (usec):</span><br><span class="line">     |  1.00th=[ 2671],  5.00th=[ 4146], 10.00th=[ 4817], 20.00th=[ 5669],</span><br><span class="line">     | 30.00th=[ 6259], 40.00th=[ 6718], 50.00th=[ 7177], 60.00th=[ 7635],</span><br><span class="line">     | 70.00th=[ 8094], 80.00th=[ 8717], 90.00th=[ 9503], 95.00th=[10159],</span><br><span class="line">     | 99.00th=[11600], 99.50th=[12256], 99.90th=[13435], 99.95th=[13960],</span><br><span class="line">     | 99.99th=[15008]</span><br><span class="line">   bw (  KiB/s): min=278528, max=410624, per=99.99%, avg=359210.00, stdev=16717.13, samples=1200</span><br><span class="line">   iops        : min= 1088, max= 1604, avg=1403.15, stdev=65.31, samples=1200</span><br><span class="line">  lat (usec)   : 1000=0.01%</span><br><span class="line">  lat (msec)   : 2=0.38%, 4=5.53%, 10=90.21%, 20=3.89%, 50=0.01%</span><br><span class="line">  lat (msec)   : 100=0.01%, 250=0.01%</span><br><span class="line">  cpu          : usr=8.56%, sys=13.71%, ctx=1460581, majf=0, minf=43</span><br><span class="line">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br><span class="line">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br><span class="line">     issued rwts: total=1964492,842024,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class="line">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br><span class="line"></span><br><span class="line">Run status group 0 (all <span class="built_in">jobs</span>):</span><br><span class="line">   READ: bw=819MiB/s (858MB/s), 819MiB/s-819MiB/s (858MB/s-858MB/s), io=480GiB (515GB), run=600006-600006msec</span><br><span class="line">  WRITE: bw=351MiB/s (368MB/s), 351MiB/s-351MiB/s (368MB/s-368MB/s), io=206GiB (221GB), run=600006-600006msec</span><br><span class="line"></span><br><span class="line">Disk stats (<span class="built_in">read</span>/write):</span><br><span class="line">  vdb: ios=392642/168565, merge=0/0, ticks=2592861/1196753, in_queue=3789580, util=100.00%</span><br><span class="line">  vdc: ios=393062/168145, merge=0/0, ticks=2598222/1194090, in_queue=3792256, util=100.00%</span><br><span class="line">  vdd: ios=393023/168184, merge=0/0, ticks=2596337/1194294, in_queue=3790680, util=100.00%</span><br><span class="line">  vde: ios=392274/168932, merge=0/0, ticks=2591293/1199083, in_queue=3790327, util=100.00%</span><br><span class="line">  vdf: ios=393198/167999, merge=0/0, ticks=2597884/1193103, in_queue=3791030, util=100.00%</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>fio</tag>
        <tag>ç£ç›˜æ€§èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹K8Sæ ‡ç­¾æ±¡ç‚¹ä½¿ç”¨é—®é¢˜è®°å½•</title>
    <url>/2025/09/24/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8BK8S%E6%A0%87%E7%AD%BE%E6%B1%A1%E7%82%B9%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="ä¸€ã€é—®é¢˜æ ‡ç­¾ä¸åŒ¹é…"><a href="#ä¸€ã€é—®é¢˜æ ‡ç­¾ä¸åŒ¹é…" class="headerlink" title="ä¸€ã€é—®é¢˜æ ‡ç­¾ä¸åŒ¹é…"></a>ä¸€ã€é—®é¢˜æ ‡ç­¾ä¸åŒ¹é…</h2><p>å› ä¸€æœåŠ¡å¯åŠ¨pendingï¼Œdescribe æŸ¥çœ‹å…¶åŸå› ã€‚ä¸»è¦æ˜¯å› ä¸ºï¼šèŠ‚ç‚¹äº²å’Œæ€§ä¸åŒ¹é…ä¸master èŠ‚ç‚¹æ±¡ç‚¹ä¸åŒ¹é…ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Warning  FailedScheduling  94s   default-scheduler  0/6 nodes are available: 1 node(s) had taint &#123;node-role.kubernetes.io/infrastore: &#125;, that the pod didn<span class="string">&#x27;t tolerate, 2 Insufficient memory, 3 node(s) had taint &#123;node-role.kubernetes.io/master: &#125;, that the pod didn&#x27;</span>t tolerate.</span><br></pre></td></tr></table></figure>

<p>1.æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">affinity:</span><br><span class="line">        nodeAffinity:</span><br><span class="line">          requiredDuringSchedulingIgnoredDuringExecution: <span class="comment">#äº²å’Œæ€§é…ç½®</span></span><br><span class="line">            nodeSelectorTerms:</span><br><span class="line">            - matchExpressions:</span><br><span class="line">              - key: node-role.kubernetes.io/infrastore <span class="comment">#æ‰“ä¸Šæ ‡ç­¾</span></span><br><span class="line">                operator: Exists  <span class="comment"># åªéœ€è¦æ ‡ç­¾å­˜åœ¨ï¼Œä¸å…³å¿ƒå€¼</span></span><br></pre></td></tr></table></figure>

<p>2.æ ¹æ®äº²å’Œé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»™ç›®æ ‡èŠ‚ç‚¹æ‰“ä¸Šæ ‡ç­¾</span></span><br><span class="line">kubectl label nodes &lt;node-name&gt; node-role.kubernetes.io/infrastore=</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åº”è¯¥æœ‰å¦‚ä¸‹é…ç½®</span></span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    node-role.kubernetes.io/infrastore: <span class="string">&quot;&quot;</span>  <span class="comment"># å€¼ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>

<p>3.å‘½ä»¤ä¸Šä¸yamlä¸­æ ‡ç­¾çš„åŒºåˆ«</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ£€æŸ¥æ ‡ç­¾</span></span><br><span class="line">kubectl get nodes --show-labels | grep -E <span class="string">&quot;(app=wetwin-middleware|NAME)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªæŸ¥çœ‹å¸¦æœ‰ app=wetwin-middleware æ ‡ç­¾çš„èŠ‚ç‚¹</span></span><br><span class="line">kubectl get nodes -l app=wetwin-middleware --show-labels</span><br><span class="line"><span class="comment"># æˆ–è€…åªä¸ºç‰¹å®šç±»å‹çš„èŠ‚ç‚¹æ·»åŠ </span></span><br><span class="line">kubectl get nodes -l node-role.kubernetes.io/worker= --no-headers | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I &#123;&#125; kubectl label nodes &#123;&#125; app=wetwin-middleware</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ‡ç­¾ä¸Šçš„æ˜¯ä½¿ç”¨ï¼Œdidn&#x27;t match node selectorï¼Œé‚£ä¹ˆå°±æ˜¯æŸ¥çœ‹çš„æ˜¯nodeä¸Šçš„æ ‡ç­¾ã€‚å¯ä»¥å…ˆç”¨å‘½ä»¤æ£€æŸ¥</span></span><br><span class="line">kubectl label nodes xxxx app=wetwin-middleware</span><br><span class="line"><span class="comment">#yamlæ–‡ä»¶ä¸­=å˜ä¸º: çš„å½¢å¼</span></span><br><span class="line">  labels:</span><br><span class="line">    app: wetwin-middleware</span><br><span class="line"><span class="comment"># åˆ é™¤èŠ‚ç‚¹æ ‡ç­¾</span></span><br><span class="line">kubectl label nodes &lt;èŠ‚ç‚¹åç§°&gt; app-</span><br><span class="line"><span class="comment"># ä¿®æ”¹ç°æœ‰æ ‡ç­¾</span></span><br><span class="line">kubectl label nodes &lt;èŠ‚ç‚¹åç§°&gt; app=wetwin-middleware-new --overwrite</span><br></pre></td></tr></table></figure>



<p>æ€»ç»“ï¼šèŠ‚ç‚¹äº²å’Œæ€§nodeAffinityï¼Œoperatorå­—æ®µç”¨æ³•</p>
<table>
<thead>
<tr>
<th align="left">æ“ä½œç¬¦</th>
<th align="left">ä½¿ç”¨åœºæ™¯</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Exists</strong></td>
<td align="left">åªéœ€è¦æ ‡è¯†èŠ‚ç‚¹ç±»å‹ï¼Œä¸å…³å¿ƒå…·ä½“å€¼</td>
<td align="left">æ ‡è¯†è®¡ç®—èŠ‚ç‚¹ã€å­˜å‚¨èŠ‚ç‚¹ç­‰</td>
</tr>
<tr>
<td align="left"><strong>DoesNotExist</strong></td>
<td align="left">æ’é™¤ç‰¹å®šç±»å‹çš„èŠ‚ç‚¹</td>
<td align="left">æ’é™¤æµ‹è¯•èŠ‚ç‚¹ã€ç»´æŠ¤èŠ‚ç‚¹</td>
</tr>
<tr>
<td align="left"><strong>In</strong></td>
<td align="left">é€‰æ‹©ç‰¹å®šå€¼çš„èŠ‚ç‚¹</td>
<td align="left">ç¯å¢ƒé€‰æ‹©ï¼ˆprod&#x2F;stagingï¼‰ã€åŒºåŸŸé€‰æ‹©</td>
</tr>
<tr>
<td align="left"><strong>NotIn</strong></td>
<td align="left">æ’é™¤ç‰¹å®šå€¼çš„èŠ‚ç‚¹</td>
<td align="left">æ’é™¤ç‰¹å®šæ•…éšœåŸŸã€æ’é™¤æ—§ç‰ˆæœ¬</td>
</tr>
<tr>
<td align="left"><strong>Gt&#x2F;Lt</strong></td>
<td align="left">åŸºäºæ•°å€¼çš„é€‰æ‹©</td>
<td align="left">å†…å­˜å¤§å°ã€ç£ç›˜å®¹é‡ã€CPUæ ¸å¿ƒæ•°</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: example-pod</span><br><span class="line">spec:</span><br><span class="line">  affinity:</span><br><span class="line">    nodeAffinity:</span><br><span class="line">      requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">        nodeSelectorTerms:</span><br><span class="line">        - matchExpressions:</span><br><span class="line">          - key: <span class="string">&quot;node-role.kubernetes.io/infrastore&quot;</span></span><br><span class="line">            operator: Exists  <span class="comment"># æ ‡ç­¾é”®å­˜åœ¨å³å¯</span></span><br><span class="line">          - key: <span class="string">&quot;environment&quot;</span></span><br><span class="line">            operator: In</span><br><span class="line">            values: [<span class="string">&quot;production&quot;</span>, <span class="string">&quot;staging&quot;</span>]  <span class="comment"># ç¯å¢ƒå¿…é¡»æ˜¯ç”Ÿäº§æˆ–é¢„å‘å¸ƒ</span></span><br><span class="line">          - key: <span class="string">&quot;gpu-type&quot;</span></span><br><span class="line">            operator: NotIn</span><br><span class="line">            values: [<span class="string">&quot;old-model&quot;</span>]  <span class="comment"># ä¸èƒ½æ˜¯æ—§å‹å·GPU</span></span><br><span class="line">          - key: <span class="string">&quot;disk-size&quot;</span></span><br><span class="line">            operator: Gt</span><br><span class="line">            values: [<span class="string">&quot;500&quot;</span>]  <span class="comment"># ç£ç›˜å¤§å°å¤§äº500GB</span></span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å®¹å™¨ä¸­å¦‚ä½•å®ç°IP-hashçš„èƒ½åŠ›"><a href="#äºŒã€å®¹å™¨ä¸­å¦‚ä½•å®ç°IP-hashçš„èƒ½åŠ›" class="headerlink" title="äºŒã€å®¹å™¨ä¸­å¦‚ä½•å®ç°IP hashçš„èƒ½åŠ›"></a>äºŒã€å®¹å™¨ä¸­å¦‚ä½•å®ç°IP hashçš„èƒ½åŠ›</h2><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>è´Ÿè½½å‡è¡¡ç­–ç•¥éƒ½ä¸èƒ½ç”¨è½®è¯¢æˆ–è€…æƒé‡ï¼Œè¦ä¿è¯åŒä¸€ä¸ªç”µè„‘æ¯æ¬¡è®¿é—®çš„èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªï¼Œä¸ç„¶ç®¡ç†ç«¯ç”¨ä¸äº†ï¼Œå®é™…è¯¥æœåŠ¡çš„pod 172.16.26.2 172.16.27.7 ï¼Œä½¿ç”¨çš„æ˜¯nodeport xxx.xxx.xxx.xxx:31359 è®¿é—®ã€‚å¯ç”¨<strong>ä¼šè¯ä¿æŒï¼ˆSession Affinityï¼‰</strong>åŠŸèƒ½</p>
<h3 id="æ­£ç¡®é…ç½®æ–¹æ¡ˆ"><a href="#æ­£ç¡®é…ç½®æ–¹æ¡ˆ" class="headerlink" title="æ­£ç¡®é…ç½®æ–¹æ¡ˆ"></a>æ­£ç¡®é…ç½®æ–¹æ¡ˆ</h3><h3 id="1-SessionAffinity-é…ç½®"><a href="#1-SessionAffinity-é…ç½®" class="headerlink" title="1. SessionAffinity é…ç½®"></a>1. SessionAffinity é…ç½®</h3><p><strong>ä¸éœ€è¦å¡«å†™Podçš„IP</strong>ï¼Œ<code>sessionAffinity: ClientIP</code> æ˜¯Serviceçº§åˆ«çš„é…ç½®ï¼ŒKubernetesä¼šè‡ªåŠ¨å¤„ç†IPåˆ°Podçš„æ˜ å°„ã€‚</p>
<p>æ­£ç¡®çš„Serviceé…ç½®ç¤ºä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">your-management-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">externalTrafficPolicy:</span> <span class="string">Local</span>  <span class="comment"># å…³é”®é…ç½®</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">ClientIP</span> </span><br><span class="line">  <span class="attr">sessionAffinityConfig:</span></span><br><span class="line">    <span class="attr">clientIP:</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">10800</span>  <span class="comment"># 3å°æ—¶</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31359</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">management-app</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Kubernetesä¸­ï¼ŒServiceçš„<code>externalTrafficPolicy</code>å­—æ®µæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š<code>Cluster</code>ï¼ˆé»˜è®¤ï¼‰å’Œ<code>Local</code>ã€‚</p>
<ul>
<li><strong>Cluster</strong>ï¼šå°†å¤–éƒ¨æµé‡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ²¡æœ‰è¿è¡ŒPodçš„èŠ‚ç‚¹ï¼‰ï¼Œç„¶åé€šè¿‡kube-proxyè½¬å‘åˆ°Podã€‚è¿™ä¼šéšè—å®¢æˆ·ç«¯çš„æºIPï¼ˆå› ä¸ºç»è¿‡äº†ä¸€æ¬¡è½¬å‘ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½å¢åŠ ç½‘ç»œè·³æ•°ã€‚</li>
<li><strong>Local</strong>ï¼šåªå°†æµé‡åˆ†é…åˆ°è¿è¡Œæœ‰Service Podçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç›´æ¥ç”±è¯¥èŠ‚ç‚¹ä¸Šçš„kube-proxyè½¬å‘åˆ°æœ¬åœ°çš„Podã€‚è¿™æ ·å¯ä»¥ä¿ç•™å®¢æˆ·ç«¯çš„æºIPï¼Œå¹¶ä¸”é¿å…é¢å¤–çš„ç½‘ç»œè·³è½¬ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨<code>externalTrafficPolicy: Local</code>å¯¹äºIPå“ˆå¸Œä¼šè¯ä¿æŒæ›´æœ‰åˆ©ï¼Ÿ</strong></p>
<p>å½“ä½¿ç”¨<code>sessionAffinity: ClientIP</code>æ—¶ï¼ŒServiceä¼šæ ¹æ®å®¢æˆ·ç«¯çš„IPåœ°å€è¿›è¡Œå“ˆå¸Œï¼Œå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°åŒä¸€ä¸ªPodã€‚ä½†æ˜¯ï¼Œå¦‚æœ<code>externalTrafficPolicy</code>æ˜¯<code>Cluster</code>ï¼Œé‚£ä¹ˆåˆ°è¾¾Serviceçš„æµé‡å¯èƒ½ä¼šå…ˆåˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè¯¥èŠ‚ç‚¹å†è½¬å‘åˆ°ç›®æ ‡Podã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯çš„æºIPå¯èƒ½ä¼šè¢«ä¸¢å¤±ï¼ˆå› ä¸ºç»è¿‡SNATï¼‰ï¼Œå°¤å…¶æ˜¯å½“æµé‡è¢«è½¬å‘åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šçš„Podæ—¶ã€‚</p>
<p>è€Œè®¾ç½®<code>externalTrafficPolicy: Local</code>å¯ä»¥ç¡®ä¿ï¼š</p>
<ol>
<li>ä¿ç•™å®¢æˆ·ç«¯çš„çœŸå®IPåœ°å€ã€‚</li>
<li>æµé‡åªåˆ°è¾¾è¿è¡Œæœ‰Podçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç›´æ¥ç”±è¯¥èŠ‚ç‚¹å¤„ç†ï¼Œä¸ä¼šè·¨èŠ‚ç‚¹è½¬å‘ã€‚</li>
</ol>
<p>è¿™æ ·ï¼ŒåŸºäºå®¢æˆ·ç«¯IPçš„ä¼šè¯ä¿æŒä¼šæ›´åŠ å‡†ç¡®ï¼Œå› ä¸ºServiceçœ‹åˆ°çš„å®¢æˆ·ç«¯IPæ˜¯çœŸå®çš„ï¼Œè€Œä¸æ˜¯æŸä¸ªä¸­é—´èŠ‚ç‚¹çš„IPã€‚</p>
<h3 id="å…¶ä»–å®ç°æ–¹æ¡ˆ"><a href="#å…¶ä»–å®ç°æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–å®ç°æ–¹æ¡ˆ"></a>å…¶ä»–å®ç°æ–¹æ¡ˆ</h3><h4 id="æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Ingressçš„ä¼šè¯ä¿æŒ"><a href="#æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Ingressçš„ä¼šè¯ä¿æŒ" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Ingressçš„ä¼šè¯ä¿æŒ"></a>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Ingressçš„ä¼šè¯ä¿æŒ</h4><p>å¦‚æœä½¿ç”¨Ingressï¼Œå¯ä»¥é…ç½®ï¼š</p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: your-ingress</span><br><span class="line">  annotations:</span><br><span class="line">    nginx.ingress.kubernetes.io/affinity: &quot;cookie&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/session-cookie-name: &quot;route&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/session-cookie-expires: &quot;172800&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/session-cookie-max-age: &quot;172800&quot;</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: your-domain.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        pathType: Prefix</span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: your-service</span><br><span class="line">            port:</span><br><span class="line">              number: 80</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol>
<li><strong>ClientIPè·å–é—®é¢˜</strong>ï¼šåœ¨äº‘ç¯å¢ƒæˆ–ç»è¿‡NATæ—¶ï¼Œå¯èƒ½éœ€è¦é…ç½®<code>externalTrafficPolicy: Local</code>æ¥ç¡®ä¿è·å–çœŸå®å®¢æˆ·ç«¯IP</li>
<li><strong>Podé‡å¯é—®é¢˜</strong>ï¼šå¦‚æœPodé‡å¯ï¼Œä¼šè¯ä¼šä¸­æ–­ï¼Œéœ€è¦è€ƒè™‘åº”ç”¨å±‚çš„ä¼šè¯å¤åˆ¶æˆ–æŒä¹…åŒ–</li>
<li><strong>æµ‹è¯•æ–¹æ³•</strong>ï¼šä»åŒä¸€å®¢æˆ·ç«¯å¤šæ¬¡è®¿é—®ï¼Œæ£€æŸ¥æ—¥å¿—ç¡®è®¤è¯·æ±‚æ€»æ˜¯åˆ°è¾¾åŒä¸€ä¸ªPod</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‚¨åªéœ€è¦åœ¨Serviceä¸­è®¾ç½®<code>sessionAffinity: ClientIP</code>å³å¯ï¼Œ<strong>ä¸éœ€è¦å¡«å†™Podçš„IPåœ°å€</strong>ã€‚Kubernetesä¼šè‡ªåŠ¨åŸºäºå®¢æˆ·ç«¯IPè¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œå°†åŒä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚è·¯ç”±åˆ°åŒä¸€ä¸ªPodã€‚</p>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡01</title>
    <url>/2025/09/06/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8701/</url>
    <content><![CDATA[<p>é—®é¢˜ç°è±¡ï¼š<br>å®¹å™¨1ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PID 1ï¼š Javaè¿›ç¨‹</span><br></pre></td></tr></table></figure>

<p>å®¹å™¨2ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PID 1: /sbin/tini -- ./entrypoint.sh</span><br><span class="line">PID 6: Javaè¿›ç¨‹</span><br></pre></td></tr></table></figure>

<p>å…³é”®åŒºåˆ«åœ¨äºï¼šç¬¬äºŒä¸ªå®¹å™¨çš„entrypoint.shè„šæœ¬å¯èƒ½æ˜¯é€šè¿‡tiniå¯åŠ¨çš„ã€‚è€Œç¬¬ä¸€ä¸ªå®¹å™¨å¯èƒ½æ˜¯ç›´æ¥ä»¥entrypoint.shä½œä¸ºå…¥å£ç‚¹ï¼Œæ²¡æœ‰ä½¿ç”¨tiniï¼Œæ‰€ä»¥åœ¨execæ‰§è¡ŒåJavaè¿›ç¨‹æ›¿æ¢äº†shellè¿›ç¨‹æˆä¸ºPID 1ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps -a --no-trunc |grep xxx <span class="comment">#æŸ¥çœ‹docker å¯åŠ¨å‘½ä»¤è¿›è¡Œç¡®è®¤,ä½¿ç”¨docker runæ—¶æŒ‡å®šäº†initç¨‹åºä¸ºtiniã€‚</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºåœ¨Dockerfileä¸­å¯èƒ½ä½¿ç”¨äº†ç±»ä¼¼ä»¥ä¸‹çš„æŒ‡ä»¤ï¼š<br>ENTRYPOINT [â€œ&#x2F;sbin&#x2F;tiniâ€, â€œâ€“â€, â€œ.&#x2F;entrypoint.shâ€]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> entrypoint.sh </span><br><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The application will start in <span class="variable">$&#123;APP_SLEEP&#125;</span>s...&quot;</span> &amp;&amp; <span class="built_in">sleep</span> <span class="variable">$&#123;APP_SLEEP&#125;</span></span><br><span class="line"><span class="built_in">exec</span> /usr/bin/java -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap <span class="variable">$&#123;JAVA_OPTS&#125;</span> \</span><br><span class="line">     	-Djava.security.egd=file:/dev/./urandom \</span><br><span class="line">      -Dtsf.swagger.enabled=<span class="literal">false</span> \</span><br><span class="line">     	-jar /root/app/element-server2*.jar <span class="variable">$&#123;RUN_ARGS&#125;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>


<p><strong>tini çš„ä½œç”¨</strong></p>
<ul>
<li><p>1.tini æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œä¸“é—¨ä¸ºå®¹å™¨è®¾è®¡</p>
</li>
<li><p>1.å¯ä»¥ç¡®ä¿å®ƒèƒ½æ­£ç¡®æ¥æ”¶ Docker åœæ­¢å‘½ä»¤å‘é€çš„ä¿¡å·</p>
</li>
<li><p>2.å®ƒä½œä¸º PID 1 è¿è¡Œï¼Œè´Ÿè´£ç®¡ç†å­è¿›ç¨‹ï¼ˆè¿™é‡Œæ˜¯ entrypoint.shï¼‰</p>
</li>
<li><p>3.entrypoint.sh è„šæœ¬ä»ç„¶ä½¿ç”¨ exec å¯åŠ¨ Javaï¼Œä½†æ­¤æ—¶ï¼š</p>
<p>  exec æ›¿æ¢çš„æ˜¯ entrypoint.sh è¿›ç¨‹ï¼ˆPID 6ï¼‰ï¼Œè€Œä¸æ˜¯ PID 1</p>
<p>  tini ä¿æŒä¸º PID 1ï¼ŒJava è¿›ç¨‹ä½œä¸ºå…¶å­è¿›ç¨‹è¿è¡Œ</p>
</li>
</ul>
<h2 id="ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ"><a href="#ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ"></a>ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ</h2><table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left">ç›´æ¥ exec (æ—  tini)</th>
<th align="left">ä½¿ç”¨ tini</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PID 1 è¿›ç¨‹</td>
<td align="left">Java åº”ç”¨</td>
<td align="left">tini</td>
</tr>
<tr>
<td align="left">ä¿¡å·å¤„ç†</td>
<td align="left">åº”ç”¨éœ€è‡ªè¡Œå¤„ç†</td>
<td align="left">tini ååŠ©å¤„ç†</td>
</tr>
<tr>
<td align="left">åƒµå°¸è¿›ç¨‹å›æ”¶</td>
<td align="left">å¯èƒ½å­˜åœ¨é—®é¢˜</td>
<td align="left">è‡ªåŠ¨å›æ”¶</td>
</tr>
<tr>
<td align="left">è¿›ç¨‹æ ‘ç»“æ„</td>
<td align="left">æ›´ç®€å•</td>
<td align="left">ç¨å¤æ‚ä½†æ›´å¥å£®</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡02</title>
    <url>/2025/09/07/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8702/</url>
    <content><![CDATA[<p>èƒŒæ™¯ï¼šé¡¹ç›®ä¸Šéœ€è¦å°†æœåŠ¡çš„æ—¥å¿—éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯¹äºæœ‰ä¸¤ç±»æ—¥å¿—æ–‡ä»¶ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—å‡ºæ¥çš„ã€‚<br>æƒ…å†µ1ï¼šä¸šåŠ¡æœåŠ¡ä¸­æœªå°†æœåŠ¡æ—¥å¿—æ‰“å°åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒæŸ¥çœ‹å®¹å™¨æ‰€åœ¨èŠ‚ç‚¹æœ‰æŸ¥çœ‹åˆ°0.log ç±»ä¼¼çš„æ—¥å¿—ï¼Œéœ€è¦ç¡®è®¤è¯¥æ—¥å¿—æ˜¯å¦å°±æ˜¯æœåŠ¡çš„è¿è¡Œæ—¥å¿—ï¼Œç›®å‰é’ˆå¯¹è¯¥ç§æ—¥å¿—äº§ç”Ÿçš„è¿‡ç¨‹æµç¨‹æ¢³ç†</p>
<p>å®¹å™¨çš„æ ‡å‡†è¾“å‡º<br>&#x2F;var&#x2F;log&#x2F;pods&#x2F;â€¦&#x2F;0.log æ–‡ä»¶çš„äº§ç”Ÿè¿‡ç¨‹æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">App è¾“å‡º -&gt; stdout/stderr</span><br><span class="line"></span><br><span class="line">è¿è¡Œæ—¶æ•è· -&gt; å®¹å™¨è¿è¡Œæ—¶ï¼ˆDocker/containerdï¼‰å°†å…¶å†™å…¥è‡ªå·±çš„ JSON æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">kubelet ç»„ç»‡ -&gt; kubelet åˆ›å»ºæ¸…æ™°çš„ç›®å½•ç»“æ„ï¼Œå¹¶é€šè¿‡ç¬¦å·é“¾æ¥æŒ‡å‘å®¹å™¨è¿è¡Œæ—¶çš„åŸå§‹æ—¥å¿—æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹å¤–æ¥å£ -&gt; è¿™ä¸ªè·¯å¾„æˆä¸ºäº†è¯¥å®¹å™¨æ—¥å¿—åœ¨èŠ‚ç‚¹ä¸Šçš„æ ‡å‡†åŒ–ã€ç¨³å®šçš„è®¿é—®ç‚¹ã€‚æ— è®ºæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ã€æ—¥å¿—é‡‡é›†ä»£ç†ï¼ˆå¦‚ Filebeatã€Fluentdï¼‰ï¼Œè¿˜æ˜¯ kubectl logs å‘½ä»¤ï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡è¯»å–è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶æ¥è·å–æ—¥å¿—å†…å®¹çš„ã€‚</span><br><span class="line"></span><br><span class="line">kubectl logs å‘½ä»¤çš„å·¥ä½œåŸç†å°±æ˜¯ï¼šapiserver -&gt; å¯¹åº”èŠ‚ç‚¹çš„ kubelet -&gt; kubelet è¯»å– /var/log/pods/.../0.<span class="built_in">log</span> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè§£æ JSON æ ¼å¼ï¼Œåªæå– <span class="built_in">log</span> å­—æ®µçš„çº¯æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åæµå¼ä¼ è¾“å›ç»™è¯·æ±‚è€…ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="å…³ç³»ä¸åŒºåˆ«"><a href="#å…³ç³»ä¸åŒºåˆ«" class="headerlink" title="å…³ç³»ä¸åŒºåˆ«"></a>å…³ç³»ä¸åŒºåˆ«</h3><table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left"><code>/var/log/pods/.../0.log</code> (æºæ–‡ä»¶:ç±»æ¯”æ•°æ®åº“åŸå§‹è¡¨)</th>
<th align="left"><code>kubectl logs</code> (è§£æåçš„è§†å›¾:ç±»æ¯”æ‰§è¡ŒSQLåçš„è§†å›¾)</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å†…å®¹</strong></td>
<td align="left"><strong>åŸå§‹ã€å®Œæ•´</strong>çš„æ•°æ®</td>
<td align="left"><strong>è§£æåã€ç­›é€‰è¿‡</strong>çš„å†…å®¹</td>
</tr>
<tr>
<td align="left"><strong>æ ¼å¼</strong></td>
<td align="left"><strong>JSONæ ¼å¼</strong>ï¼Œæ¯è¡Œä¸€æ¡å®Œæ•´çš„JSONè®°å½•</td>
<td align="left"><strong>çº¯æ–‡æœ¬</strong>ï¼Œåªæå–äº†JSONä¸­çš„æ—¥å¿—æ¶ˆæ¯æœ¬èº«</td>
</tr>
<tr>
<td align="left"><strong>å…ƒæ•°æ®</strong></td>
<td align="left"><strong>åŒ…å«ä¸°å¯Œå…ƒæ•°æ®</strong>ï¼Œå¦‚å®Œæ•´çš„æ—¶é—´æˆ³ã€æµç±»å‹ï¼ˆstdout&#x2F;stderrï¼‰</td>
<td align="left"><strong>ä¸åŒ…å«</strong>JSONä¸­çš„å…ƒæ•°æ®ï¼Œä½†å¯èƒ½ä¼šæ ¼å¼åŒ–è¾“å‡ºæ—¶é—´æˆ³ï¼ˆéœ€åŠ  <code>--timestamps</code>ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>è®¿é—®æ–¹å¼</strong></td>
<td align="left">ç›´æ¥ç™»å½•åˆ°èŠ‚ç‚¹æœåŠ¡å™¨æŸ¥çœ‹æ–‡ä»¶</td>
<td align="left">é€šè¿‡Kubernetes API Serverè¿œç¨‹æŸ¥è¯¢</td>
</tr>
<tr>
<td align="left"><strong>ä¸»è¦ä½¿ç”¨è€…</strong></td>
<td align="left">ç³»ç»Ÿã€æ—¥å¿—é‡‡é›†ä»£ç†ï¼ˆå¦‚Fluentd, Filebeatï¼‰</td>
<td align="left"><strong>å¼€å‘è€…ã€è¿ç»´äººå‘˜</strong></td>
</tr>
</tbody></table>
<p>æƒ…å†µ2ï¼šä¸šåŠ¡æœåŠ¡ä¸­æ—¥å¿—æ‰“å°æ˜¾ç¤ºæ˜¯éœ€è¦æ—¥å¿—æ–‡ä»¶çš„æŒ‚è½½ï¼Œç›®å‰æŒ‚è½½æ–‡ä»¶æ—¥å¿—æ˜¾ç¤ºå¦‚ä¸‹ã€‚mountPath: &#x2F;root&#x2F;app (æœåŠ¡å¯åŠ¨jaråœ¨æ”¹ç›®å½•) åˆ™ä¼šæŒ‚è½½å¤±è´¥ã€‚åŸå› :å…±äº«å·ä¼šæŠŠå…¶ä»–é•œåƒå†…ç½®çš„æ–‡ä»¶æ¸…ç©ºçš„ã€‚æ‰€ä»¥ä½¿ç”¨è¯¥ç§æ–¹å¼æœ€å¥½ç»Ÿä¸€æ”¾åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ˜¯è¯¥ç§æƒ…å†µçš„æœ€ä½³å®è·µ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/app/log</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">test-log-l9ynkeyd-1</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">name:</span> <span class="string">test-log-l9ynkeyd-1</span></span><br></pre></td></tr></table></figure>

<h3 id="å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼"><a href="#å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼" class="headerlink" title="å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼:"></a>å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼:</h3><table>
<thead>
<tr>
<th align="left">å­˜å‚¨ç±»å‹</th>
<th align="left">æ¦‚å¿µç†è§£</th>
<th align="left">ç”Ÿå‘½å‘¨æœŸ</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>emptyDir</strong></td>
<td align="left">ä¸´æ—¶å­˜å‚¨ï¼Œä¼šåœ¨èŠ‚ç‚¹åˆ›å»ºç©ºç›®å½•</td>
<td align="left">ç”Ÿå‘½å‘¨æœŸ&#x3D;pod</td>
</tr>
<tr>
<td align="left"><strong>hostPath</strong></td>
<td align="left">å…è®¸æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶åˆ°pod</td>
<td align="left">ç”Ÿå‘½å‘¨æœŸ&#x3D;å®¿ä¸»æœº</td>
</tr>
<tr>
<td align="left"><strong>PVC&#x2F;PV</strong></td>
<td align="left">Kubernetesä¸­æŒä¹…å­˜å‚¨çš„æŠ½è±¡ï¼Œç”¨æˆ·é€šè¿‡å£°æ˜PVCè¯·æ±‚å­˜å‚¨èµ„æºï¼Œè€ŒPVCä¼šç»‘å®šåˆ°æ»¡è¶³å…¶éœ€æ±‚çš„PV</td>
<td align="left">æŒä¹…å­˜å‚¨</td>
</tr>
<tr>
<td align="left"><strong>StorageClass</strong></td>
<td align="left">å¤šä¸ªStorageClassï¼Œç”¨æˆ·åœ¨åˆ›å»ºPVCæ—¶æŒ‡å®šStorageClassåç§°ï¼Œä»¥åŠ¨æ€ç”³è¯·å­˜å‚¨èµ„æºã€‚</td>
<td align="left">æŒä¹…å­˜å‚¨</td>
</tr>
</tbody></table>
<p><a href="https://developer.aliyun.com/article/1650296">è¯¦ç»†åœºæ™¯è¯´æ˜</a></p>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>å­˜å‚¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡03</title>
    <url>/2025/09/11/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8703/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Warning  SystemLoadIsFull  56s (x1313 over 2d2h)  custom-plugin-monitor  (combined from similar events): system load/cores percent exceeded threshold 80%, load/cores percent: 118.09%, load15m: 37.79</span><br></pre></td></tr></table></figure>

<h3 id="å‘Šè­¦ä¿¡æ¯è§£è¯»"><a href="#å‘Šè­¦ä¿¡æ¯è§£è¯»" class="headerlink" title="å‘Šè­¦ä¿¡æ¯è§£è¯»"></a>å‘Šè­¦ä¿¡æ¯è§£è¯»</h3><p><strong>è§¦å‘æ—¶é•¿ï¼š</strong> <code>56s (x1313 over 2d2h)</code></p>
<ul>
<li><code>56s</code> ï¼š æœ¬æ¬¡å‘Šè­¦æŒç»­äº†56ç§’ï¼ˆå¯èƒ½åˆšåˆšæ¢å¤æˆ–æ­£åœ¨è§¦å‘ï¼‰ã€‚</li>
<li><code>x1313 over 2d2h</code> **ï¼š å®ƒåœ¨è¿‡å» <strong>2å¤©2å°æ—¶</strong> å†…å·²ç»è§¦å‘äº† <strong>1313æ¬¡</strong>ã€‚</li>
</ul>
<p><strong>ç›‘æ§æºï¼š</strong> <code>custom-plugin-monitor</code></p>
<p><strong>å‘Šè­¦åŸå› ï¼š</strong> <code>system load/cores percent exceeded threshold 80%</code></p>
<ul>
<li>å‘Šè­¦è§„åˆ™æ˜¯ï¼š<strong>ï¼ˆè´Ÿè½½å¹³å‡å€¼ &#x2F; CPUæ ¸å¿ƒæ•°ï¼‰çš„ç™¾åˆ†æ¯” &gt; 80%</strong> å³è§¦å‘å‘Šè­¦ã€‚</li>
</ul>
<p><strong>å…·ä½“æ•°å€¼ï¼š</strong> <code>load/cores percent: 118.09%, load15m: 37.79</code></p>
<ul>
<li><code>load15m: 37.79</code> **ï¼š è¿‡å»15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½æ˜¯ <strong>37.79</strong>ã€‚</li>
<li><code>load/cores percent: 118.09%</code> ï¼š ** (37.79 &#x2F; æ ¸å¿ƒæ•°) * 100% &#x3D; 118.09% **ã€‚</li>
</ul>
<h3 id="æ ¸å¿ƒé—®é¢˜è®¡ç®—ä¸ç¡®è®¤"><a href="#æ ¸å¿ƒé—®é¢˜è®¡ç®—ä¸ç¡®è®¤" class="headerlink" title="æ ¸å¿ƒé—®é¢˜è®¡ç®—ä¸ç¡®è®¤"></a>æ ¸å¿ƒé—®é¢˜è®¡ç®—ä¸ç¡®è®¤</h3><p>æ ¹æ®å‘Šè­¦æä¾›çš„ç™¾åˆ†æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥åæ¨å‡ºç›‘æ§ç³»ç»Ÿè®¤ä¸ºçš„CPUæ ¸å¿ƒæ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ ¸å¿ƒæ•° = load15m / (load/cores percent) = 37.79 / 1.1809 â‰ˆ 32 ä¸ªæ ¸å¿ƒ</span><br></pre></td></tr></table></figure>

<p><strong>ç»“è®ºï¼š</strong></p>
<ul>
<li>å‘Šè­¦é˜ˆå€¼æ˜¯ <code>80%</code>ï¼Œå³å½“è´Ÿè½½è¶…è¿‡ <code>0.8 * 32 = 25.6</code> æ—¶å°±ä¼šå‘Šè­¦ã€‚</li>
<li>è€Œå½“å‰è´Ÿè½½è¾¾åˆ°äº† <code>37.79</code>ï¼Œæ˜¯é˜ˆå€¼çš„ <strong>~1.5å€</strong>ï¼Œè¶…å‡ºç¨‹åº¦å¾ˆé«˜ã€‚</li>
<li>è´Ÿè½½&#x2F;æ ¸å¿ƒæ¯”è¾¾åˆ°äº† **118%**ï¼Œæ„å‘³ç€å¹³å‡æœ‰ <strong>37.79ä¸ªè¿›ç¨‹</strong> åœ¨ç«äº‰ <strong>32ä¸ªCPUæ ¸å¿ƒ</strong>ï¼Œå¹³å‡è‡³å°‘æœ‰ <strong>5-6ä¸ªè¿›ç¨‹</strong> åœ¨æ°¸è¿œåœ°æ’é˜Ÿç­‰å¾…ï¼Œç³»ç»Ÿé•¿æœŸå¤„äºä¸¥é‡è¿‡è½½çŠ¶æ€ã€‚</li>
</ul>
<h3 id="TOPçš„ä¿¡æ¯è§£è¯»"><a href="#TOPçš„ä¿¡æ¯è§£è¯»" class="headerlink" title="TOPçš„ä¿¡æ¯è§£è¯»"></a>TOPçš„ä¿¡æ¯è§£è¯»</h3><ul>
<li><p><strong>è´Ÿè½½æ˜¯ï¼š</strong> 26.05, 37.57, <strong>43.67</strong> (1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿå¹³å‡è´Ÿè½½)</p>
<p>åƒåªæœ‰32ä¸ªæ”¶é“¶å°ï¼Œå´å¹³å‡æœ‰43.67ä¸ªé¡¾å®¢è¦ç»“è´¦ã€‚<strong>è¿™æ„å‘³ç€å¹³å‡æœ‰è¶…è¿‡11ä¸ªè¿›ç¨‹ä¸€ç›´åœ¨æ’é˜Ÿç­‰å¾…è·å¾—CPUèµ„æºï¼ˆæˆ–è€…æ˜¯åœ¨ç­‰å¾…ç£ç›˜I&#x2F;Oå®Œæˆï¼‰</strong>ã€‚</p>
</li>
<li><p><strong>ç©ºé—²ç‡</strong></p>
<p>Cpu0: us 13.9%, sy 9.9%, id 73.5% -&gt; ç©ºé—²ç‡73.5%ï¼Œè¿˜ç®—ç©ºé—²ã€‚<br>Cpu16: us 17.2%, sy 10.5%, id 69.9% -&gt; ç©ºé—²ç‡69.9%<br>Cpu19: us 19.3%, sy 9.8%, id 67.6% -&gt; ç©ºé—²ç‡67.6%<br>Cpu20: us 22.8%, sy 10.4%, id 64.1% -&gt; ç©ºé—²ç‡64.1%</p>
<p>æœ‰ä¸€äº›æ ¸å¿ƒçš„idleï¼ˆç©ºé—²ï¼‰ç™¾åˆ†æ¯”ä½äº70%ï¼Œè€Œæœ‰äº›æ ¸å¿ƒï¼ˆå¦‚Cpu11, Cpu12, Cpu13, Cpu14, Cpu15ï¼‰çš„ç©ºé—²ç‡åœ¨97%ä»¥ä¸Šã€‚<br>è¿™è¡¨æ˜è´Ÿè½½å¹¶ä¸å‡è¡¡ï¼Œå¯èƒ½æœ‰ä¸€äº›è¿›ç¨‹ç»‘å®šåˆ°äº†ç‰¹å®šçš„CPUæ ¸å¿ƒä¸Šï¼Œæˆ–è€…æŸäº›è¿›ç¨‹åœ¨å¤šä¸ªæ ¸å¿ƒä¸Šè¿è¡Œä½†åˆ†å¸ƒä¸å‡ã€‚</p>
</li>
<li><p><strong>é«˜CPUè¿›ç¨‹:</strong> </p>
<p>PID 3995612 (java): å ç”¨396.1% CPU (çº¦4ä¸ªæ ¸å¿ƒçš„æ»¡è½½)</p>
<p>PID 1677 (dockerd): å ç”¨41.1% CPU</p>
<p>PID 3995595 (containerd-shim): å ç”¨21.1% CPU</p>
</li>
<li><p><strong>ä¸ºä»€ä¹ˆæ‚¨çš„ç³»ç»Ÿè´Ÿè½½é«˜ï¼Œä½†CPUä½¿ç”¨ç‡çœ‹èµ·æ¥ä¸ç®—æé«˜ï¼Ÿ</strong></p>
<p>1.<strong><code>%wa</code> (I&#x2F;O Wait)</strong>,å‡ ä¹æ‰€æœ‰æ ¸å¿ƒçš„ <code>%wa</code> éƒ½æ˜¯ <strong>0.0</strong>ã€‚æ‰€æœ‰é«˜çº¯ç²¹çš„CPUè®¡ç®—èµ„æºç«äº‰ã€‚</p>
<p>2.è¿™äº›è¿›ç¨‹å¯¹CPUçš„æ€»éœ€æ±‚ï¼ˆ43.67ï¼‰è¶…è¿‡äº†ç³»ç»Ÿèƒ½åŒæ—¶æä¾›çš„æ•°é‡ï¼ˆ32ï¼‰ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»<strong>æ’é˜Ÿ</strong>ã€‚è¿™ä¸ªæ’é˜Ÿé˜Ÿä¼çš„<strong>å¹³å‡é•¿åº¦</strong>å°±æ˜¯è´Ÿè½½å¹³å‡å€¼(43.67)ã€‚ã€ç†è§£ç­‰äºPIDçš„æ‰€å†å çš„CPUå€¼å¤§äº32ã€‘</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>cpu</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡04</title>
    <url>/2025/09/15/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8704/</url>
    <content><![CDATA[<p>é—®é¢˜èƒŒæ™¯ï¼šåœ¨k8sç§ï¼ŒæŸ¥çœ‹ä¸€ä¸ªmysql å®¹å™¨åŒ–çš„å†…å­˜ï¼ˆ16Gï¼‰å‘Šè­¦äº†ï¼Œè¡¨ç¤ºèµ„æºä¸å¤Ÿäº†ã€‚è¯¥mysql pod æœ‰ä¸‰å‰¯æœ¬ï¼Œä¸€ä¸»ä¸¤ä»ã€‚æœ‰1ä»å¾—èµ„æºå†…å­˜è€—è´¹å¾ˆä½ã€‚ä¸”è¯¥å†…å­˜å·²ç»ç”±8Gå·²ç»æ‰©å®¹è‡³16Gäº†ã€‚ä½¿ç”¨kubectl top æŸ¥çœ‹è¯¥mysqlçš„ çš„ç¡®æ˜¯åˆ°è¾¾äº†15334Mi ï¼Œä½†æ˜¯docker statsçœ‹åˆ°çš„å†…å­˜ä½¿ç”¨é‡4.477GiBã€‚ä¸ºä»€ä¹ˆåŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¾ç¤ºçš„å†…å­˜å·®å¼‚å¦‚æ­¤ä¹‹å¤§ã€‚</p>
<p>æ ¸å¿ƒåŸå› ï¼šç»Ÿè®¡ç»´åº¦ä¸åŒ</p>
<p><strong><code>docker stats</code> (æ˜¾ç¤º 4.477 GiB)</strong></p>
<ul>
<li><strong>ç»Ÿè®¡å¯¹è±¡</strong>ï¼š Docker å®¹å™¨æœ¬èº«ï¼ˆå³ <code>cgroup</code> çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼‰ã€‚</li>
<li><strong>ç»Ÿè®¡å†…å®¹</strong>ï¼šRSSï¼Œå³è¿›ç¨‹å ç”¨çš„å†…å­˜ã€‚è¿™ä¸ªå€¼æ›´æ¥è¿‘åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚ä½ çš„ MySQL è¿›ç¨‹ï¼‰çœŸæ­£å ç”¨çš„ã€æœªè¢«ç£ç›˜ç¼“å­˜ç¼“å†²åŒºçš„å†…å­˜</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼š è¿™ä¸ªå€¼é€šå¸¸ä¼šæ›´å°ï¼Œå› ä¸ºå®ƒä¸åŒ…å«è¢«å†…æ ¸åˆ©ç”¨ä¸ºç¼“å­˜ï¼ˆPage Cacheï¼‰çš„å†…å­˜ã€‚</li>
</ul>
<p><strong><code>kubectl top</code> (æ˜¾ç¤º 15334 MiB â‰ˆ 15 GiB)</strong></p>
<ul>
<li><p><strong>ç»Ÿè®¡æ¥æº</strong>ï¼š è¿™ä¸ªæ•°æ®æ¥è‡ªäº Kubernetes çš„ç›‘æ§ç»„ä»¶ <code>metrics-server</code>ï¼Œè€Œ <code>metrics-server</code> çš„æ•°æ®åˆæ¥è‡ªèŠ‚ç‚¹çš„ <code>cAdvisor</code>ã€‚</p>
</li>
<li><p><strong>ç»Ÿè®¡å†…å®¹</strong>ï¼š å®ƒæ˜¾ç¤ºçš„æ˜¯<strong>å®¹å™¨å†…å­˜å·¥ä½œé›†ï¼ˆWorking Setï¼‰</strong> çš„å¤§å°ã€‚</p>
</li>
<li><p><strong>å·¥ä½œé›†ï¼ˆWorking Setï¼‰</strong> åŒ…æ‹¬ï¼š</p>
<p>å†…å­˜ä½¿ç”¨é‡ï¼ˆmemory.usage_in_bytesï¼‰ï¼š&#x3D; RSS + ç¼“å­˜ï¼ˆåŒ…æ‹¬æ–‡ä»¶ç¼“å­˜ã€å—è®¾å¤‡ç¼“å­˜ç­‰ï¼‰ + å†…æ ¸å†…å­˜ç­‰</p>
</li>
</ul>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>cpu</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„ä¸€æ¬¡è€ƒè¯•å‡†å¤‡å·¥ä½œ</title>
    <url>/2025/11/13/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E8%80%83%E8%AF%95%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/</url>
    <content><![CDATA[<p>éƒ¨ç½²çš„èµ„æºä¿¡æ¯ï¼š<img src="/images/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E8%80%83%E8%AF%95%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.asserts/image-20251113015807537.png" alt="image-20251113015807537"></p>
<p><img src="/images/%E6%88%91%E7%9A%84%E4%B8%80%E6%AC%A1%E8%80%83%E8%AF%95%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C.asserts/image-20251113015848691.png" alt="image-20251113015848691"> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è‡ªç ”ï¼šè€ƒè¯•è®°å¾—æå‰ä¸‹è½½ç‰©æ–™ 260å¤šG å·®ä¸å¤šè¦2ä¸ªå¤šå°æ—¶</span><br><span class="line">è™šæ‹ŸIPï¼ˆvipï¼‰ï¼šhttps://console.cloud.tencent.com/vpc/havip2?rid=33</span><br><span class="line">163åœ°å€ï¼šhttps://mail.163.com/ 13387324256@163.com shuaihui123456,</span><br><span class="line">è…¾è®¯äº‘è´¦å·ç™»é™†ï¼š100010739579 13387324256@163.com shuaihui123456,</span><br><span class="line">å®ä¾‹ä¿¡æ¯ï¼šhttps://console.cloud.tencent.com/cvm/instance/index?rid=33</span><br><span class="line">ä¿å­˜çš„ç‰©æ–™ç›˜ï¼š ç”³è¯·äº†æŒ‚ä¸Šå» /material</span><br><span class="line">æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼š7.9 </span><br><span class="line"></span><br><span class="line">éƒ¨ç½²æ‰‹å†Œï¼š</span><br><span class="line">https://cloud.tencent.com/edu/learning/learn-4306-80047 <span class="comment"># ppt</span></span><br><span class="line">https://docs.qq.com/doc/DSXBnVkxFa3NvdFVP <span class="comment">#åº•åº§éƒ¨ç½²</span></span><br><span class="line">https://docs.qq.com/doc/DSXZzR3dPbG5qRVVQ <span class="comment">#è‡ªç ”è½¯ä»¶è®¤è¯å®éªŒè€ƒè¯•æ³¨æ„äº‹é¡¹</span></span><br><span class="line">https://docs.qq.com/doc/DSWdrb2xZaVpaWkxj <span class="comment">#è…¾è®¯äº‘åŸç”ŸTCS TBDSéƒ¨ç½²æ‰‹å†Œ</span></span><br><span class="line">https://docs.qq.com/doc/DSW52c2ZveFpwRFN6?nlc=1 <span class="comment">#è…¾è®¯äº‘åŸç”ŸTCS WeDataéƒ¨ç½²æ‰‹å†Œ</span></span><br><span class="line"></span><br><span class="line">1.havip 4ä¸ªï¼š10.15.15.11,10.15.15.13,10.15.15.14,10.15.15.15 </span><br><span class="line">2. master 3å° : 64C128G 100G 1000G 1500G 1000G 600G</span><br><span class="line">  - ip: 10.15.15.19</span><br><span class="line">  - ip: 10.15.15.39 </span><br><span class="line">  - ip: 10.15.15.45</span><br><span class="line">   worker:1. WeDataï¼ˆmanagerç®¡æ§æœåŠ¡,é¡µé¢åŠŸèƒ½ï¼‰&amp;Wedata-Worker: 4å° 32C64G 100G 1000G 1000G 2. TBDS:3å° 32C64G 100G 500G 500G</span><br><span class="line"></span><br><span class="line">äº‘é¼ï¼ˆå¯é€‰ï¼‰ï¼š3å° 32C64G 200G 500G 1000G</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 1ã€     TCSåº•åº§+TBDS+Wedataçš„å…¨é‡åŒ…( <strong>æå‰ä¸‹è½½</strong>ï¼Œä¸‹è½½æ—¶ï¼Œç›´æ¥é€šè¿‡sh download.sh -p trueä¸‹è½½å³å¯ï¼›éœ€è¦ä¸€å—å•ç‹¬çš„è‡³å°‘ <strong>600G</strong> çš„æ•°æ®ç›˜)</p>
<p>2ã€     wedataçš„å®¢åˆ¶åŒ–åŒ…(å¾ˆå°å¯ä»¥ä¸æå‰ä¸‹è½½ï¼Œå¯ä»¥éƒ¨ç½²è¿‡ç¨‹ä¸­å†å»ä¸‹è½½ï¼Œæ”¾åˆ°&#x2F;data&#x2F;toc&#x2F;materials&#x2F;è¿›è¡Œä¸‹è½½)</p>
<p>3ã€     oceanus( <strong>æå‰ä¸‹è½½å¹¶è§£å‹</strong>ï¼Œå¯ä»¥æ”¾åˆ°å•ç‹¬ç‰©æ–™ç›˜æå‰ä¸‹è½½å’Œè§£å‹)</p>
<p>4ã€    å…ˆè®¾ç½®å†…æ ¸å‚æ•°åœ¨predo ä¸­ æ‰§è¡Œsh  set_kernel.sh ,ç„¶åé‡å¯ç›®å‰çš„nodeèŠ‚ç‚¹ï¼Œå†æ‰§è¡Œæ£€æŸ¥ md5 è€ƒè¯•çš„æ—¶å€™åŠ ä¸Š SKIP_MD5&#x3D;true sh tcs&#x2F;start.sh</p>
<p>5ã€   TBDSéƒ¨ç½²æ—¶å€™ï¼Œä¼šå…ˆè·å–cspçš„åœ°å€ï¼Œç„¶åä»cspä¸­ä¸‹è½½æ–‡ä»¶ä¸‹è½½ï¼Œåˆ›å»ºmysqlå®ä¾‹ä¿¡æ¯ã€‚</p>
<p>4000m 8G 200Gi ç‰ˆæœ¬æ˜¯8.0 ï¼Œå¹¶ä¸”è¦é€‰æ‹©æ ‡ç­¾ï¼šcustom.tbds.tm&#x2F;type&#x3D;app</p>
<p>å…¶ä»–éƒ¨ç½²ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1.ç­‰å¾…licenseçš„æ—¶å€™ï¼Œå¯ä»¥å…ˆéƒ¨ç½²TMï¼Œéƒ¨ç½²å®ŒTMå†å¯¼å…¥licenseä¹Ÿå¯ä»¥</span><br><span class="line">2.éƒ¨ç½²å®ŒTCSåº•åº§ï¼Œç›´æ¥å»è·å–TCSèµ„æºä¿¡æ¯çš„<span class="built_in">id</span>ä¿¡æ¯å‘é‚®ä»¶å»ç”³è¯·licenseï¼Œä¹‹åå¯ä»¥ç›´æ¥å…ˆéƒ¨ç½²TMï¼Œç­‰TMéƒ¨ç½²å®Œå¯¼å…¥licenseï¼› ä¹‹ååœ¨äº§å“å¸‚åœºéƒ¨ç½²wedataï¼Œéƒ¨ç½²wedataçš„åŒæ—¶å¯ä»¥å»éƒ¨ç½²TEï¼ŒTEçš„éƒ¨ç½²æ—¶é—´æ¯”wedataè¦é•¿ï¼Œwedataéƒ¨ç½²å®Œåï¼Œå¯ä»¥å»éƒ¨ç½²oceanusï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¹¶è¡Œéƒ¨ç½²TEï¼Œè¿™æ ·ç›¸å½“äºWedata+oceanusçš„éƒ¨ç½²æ—¶é—´ç›´æ¥å¿½ç•¥äº†</span><br><span class="line">3. éƒ¨ç½²wedataå®¢åˆ¶åŒ–åŒ…å’ŒTCSåº•åº§+TBDS+Wedataçš„å…¨é‡åŒ…ä¸åœ¨åŒä¸€ä¸ªå±€ç‚¹ï¼Œå¯¼å…¥wedataå®¢åˆ¶åŒ–åŒ…å‰ï¼Œéœ€è¦å¼€å¯å¤šå±€ç‚¹åŠŸèƒ½ï¼škubectl edit comp -n tcs dawn-web-console ENABLE_MULTI_SITE ä¸ºture</span><br><span class="line"></span><br><span class="line">å¤§æ•°æ®ä¸æ”¯æŒcontainerdï¼Œéƒ¨ç½²çš„æ—¶å€™åˆ‡è®°ä¸è¦é€‰containerd</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ç‰©æ–™ç›˜å¤„ç†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå­˜åœ¨ç‹¬ç«‹ç‰©æ–™ç£ç›˜ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹å¼æŒ‚è½½</span></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„å‘½ä»¤æ ¹æ®å®é™…ç›˜ç¬¦ç¡®å®šï¼Œä¸èƒ½ç›´æ¥å¤åˆ¶ä½¿ç”¨,åœ¨ç‰©æ–™æœºèŠ‚ç‚¹æ ¼å¼åŒ–æŒ‚è½½ /materialçš„æ•°æ®ç›˜ï¼Œä»¥ /dev/vdc ä¸ºä¾‹</span></span><br><span class="line"><span class="built_in">mkdir</span> /material</span><br><span class="line">disk=/dev/vde</span><br><span class="line">mkfs.xfs -n ftype=1 <span class="variable">$disk</span> -f</span><br><span class="line"><span class="comment"># è¿™é‡Œçš„å‘½ä»¤æ ¹æ®å®é™…ç›˜ç¬¦ç¡®å®šï¼Œä¸èƒ½ç›´æ¥å¤åˆ¶ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;`blkid | grep <span class="variable">$disk</span> | awk &#x27;&#123;print <span class="variable">$2</span>&#125;&#x27;` /material xfs defaults,noatime,nodiratime,prjquota 0 2&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment"># æŒ‚è½½</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">mount -a</span><br><span class="line"><span class="comment"># å¦‚æœä¸å­˜åœ¨ç‰©æ–™ç›˜çš„æƒ…å†µä¸‹ï¼Œå¢é‡å‡ºåŒ…å‡ºcore+dawnçš„ç‰©æ–™ï¼Œå»ºè®®å…ˆä¸‹è½½å¥½å†ä¸Šä¼ /ç›®å½•ï¼Œå¦åˆ™/ç›®å½•æœ€å°‘éœ€è¦50Gï¼‰ï¼Œè‹¥å‡ºåŒ…é™¤core+dawnå¤–è¿˜å­˜åœ¨å…¶ä»–ç‰©æ–™ï¼Œ/çš„è§„æ ¼éœ€è¦æ ¹æ®å…¶ä»–ç‰©æ–™è§„æ ¼è°ƒæ•´</span></span><br><span class="line"><span class="built_in">cd</span> /material</span><br><span class="line"><span class="comment"># å¢é‡å‡ºåŒ…åœºæ™¯ éœ€è¦ cd /data/toc/materials/</span></span><br><span class="line">tar -zxvf material.xx.&lt;æ—¶é—´æˆ³&gt;.tgz</span><br><span class="line"><span class="comment"># å¢é‡å‡ºåŒ…åœºæ™¯ï¼Œå¦‚æœåŒ…å«TCS-Core+TCS-dawnäº§å“ï¼Œéœ€è¦æ‰§è¡Œ</span></span><br><span class="line">sh download.sh -p <span class="literal">true</span></span><br><span class="line"><span class="comment"># æ–¹å¼ä¸‹è½½ï¼Œè®©ä¸‹è½½ç‰©æ–™è‡ªåŠ¨å‹ç¼©æ‰“åŒ…ï¼Œå…¶ä»–äº§å“ç‰©æ–™æ­£å¸¸ä¸‹è½½å³å¯</span></span><br><span class="line"><span class="built_in">cd</span> material.xx.&lt;æ—¶é—´æˆ³&gt; &amp;&amp; sh download.sh </span><br><span class="line"><span class="comment">#å¦‚æœå…¨é‡åŒ…ä¸‹è½½çš„ç‰©æ–™ï¼Œé™¤å»tcs-coreç‰©æ–™ï¼Œå…¶ä»–ç‰©æ–™è·¯å¾„ä½ç½®ï¼ˆå¦‚tcenterã€supportã€ospç­‰ï¼‰</span></span><br><span class="line"><span class="built_in">cd</span> /data/toc/materials/material.xxxxxxxxxxxxx/tcs/toc/materials/material.xxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨éƒ¨ç½²å¼•æ“tcs-installer</span></span><br><span class="line"><span class="built_in">cd</span> /material/material.xxx </span><br><span class="line"><span class="comment"># éç‹¬ç«‹ç‰©æ–™ç›˜ cd  /root/material/material.xxx</span></span><br><span class="line"></span><br><span class="line">tar xf TCS-<span class="keyword">time</span>*-size*-md5*.tar.gz tcs/start.sh</span><br><span class="line">./tcs/start.sh <span class="comment"># md5çš„æ—¶é—´å¤ªé•¿äº†ï¼Œcheckäº†ä¸€æ¬¡è¿˜è¦é‡å¯ï¼Œéœ€è¦æå‰æŠŠé‡å¯çš„å‚æ•°æå‰æ‰‹åŠ¨åšäº†</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éƒ¨ç½²TCS-coreï¼š</p>
<p><strong>è®¿é—®æ–¹å¼ï¼šhttp:&#x2F;&#x2F;{master1 IP}:8080&#x2F;</strong></p>
<p>ç”¨æˆ·åå¯†ç ä¿¡æ¯è¾“å‡ºåœ¨æ§åˆ¶å°ï¼Œé¦–æ¬¡ç™»é™†å¯†ç å»ºè®®æ›´æ”¹ä¸ºTCS#Core@2007</p>
<p><a href="https://doc.weixin.qq.com/doc/w3_AQYAkAYWAP0Kbg5qNdYSGquxC9hsk?scode=AJEAIQdfAAo00OoUHbAQYAkAYWAP0">precheckæ–‡æ¡£</a></p>
<p>vim tcs-pre-check&#x2F;conf&#x2F;host.yml </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-15-19-tencentos conf]# <span class="built_in">cat</span> host.yml </span><br><span class="line">global[var]:</span><br><span class="line">  password: Tcdn@2007</span><br><span class="line">  port: <span class="string">&#x27;22&#x27;</span></span><br><span class="line">  user: root</span><br><span class="line"></span><br><span class="line">tcs_master:</span><br><span class="line">  - ip: 10.15.15.19</span><br><span class="line">  - ip: 10.15.15.39 </span><br><span class="line">  - ip: 10.15.15.45</span><br></pre></td></tr></table></figure>

<p>vim tcs-pre-check&#x2F;conf&#x2F;params.yml </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@VM-15-19-tencentos conf]# <span class="built_in">cat</span> params.yml </span><br><span class="line"><span class="comment">#TCS LB VIP,tcs2.3.5éœ€è¦4ä¸ªvip,LB ä¸ºNoneçš„æ¨¡å¼ä¸ä¿®æ”¹ä¸‹é¢å†…å®¹å³å¯</span></span><br><span class="line"><span class="comment">#TCS LB VIP, tcs2.3.5 requires 4 VIPs, LB is None mode, do not modify the following content</span></span><br><span class="line">tcs_svc_lb_vip: 10.15.15.11,10.15.15.13,10.15.15.14,10.15.15.15 </span><br><span class="line"></span><br><span class="line"><span class="comment">#éœ€è¦å¡«å†™éƒ¨ç½²CSPæ‰€ç”¨çš„ç›˜ç¬¦ æ¯”å¦‚ csp_disk_name: &quot;/dev/vdd&quot;</span></span><br><span class="line"><span class="comment">#You need to fill in the drive letter used to deploy the CSP, for example, csp_disk_name: &quot;/dev/vdd&quot;</span></span><br><span class="line">csp_disk_name: <span class="string">&quot;/dev/vdd&quot;</span></span><br><span class="line">./pre-init-check.sh -mod tcs-base [-init]  åªæ£€æŸ¥ç³»ç»ŸåŸºç¡€ä¾èµ–(è¿½åŠ <span class="string">&#x27;-init&#x27;</span>å³å¯æ”¯æŒä¿®å¤ï¼Œå¦åˆ™åªè¿›è¡Œæ£€æŸ¥)</span><br></pre></td></tr></table></figure>



<p><img src="/../../../../BaiduSyncdisk/%E3%80%90001%E3%80%91-md%E7%AC%94%E8%AE%B0/Linux%E5%9F%BA%E7%A1%80/images/%E8%87%AA%E7%A0%94.asserts/image-20251112154005777.png" alt="image-20251112154005777"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y mariadb</span><br><span class="line"><span class="comment">#ä¸‹è½½åˆ›å»ºç”¨æˆ·çš„è„šæœ¬</span></span><br><span class="line"><span class="comment">##cspä¸‹è½½åœ°å€</span></span><br><span class="line">wget http://[cspåœ°å€]:[cspç«¯å£]/tbds-images/tools/tbds_initdb.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œåˆ›å»ºç”¨æˆ·çš„è„šæœ¬ï¼ˆå…¶ä¸­&lt;tbds_user_password&gt;ä¸ºç»™åˆ›å»ºç”¨æˆ·è®¾ç½®çš„å¯†ç (tcsä¸­é—´ä»¶rootå¯†ç ä¸ºï¼ˆtcs@mysql!rootï¼‰)</span></span><br><span class="line"></span><br><span class="line">sh /data/tbds_initdb.sh &lt;mysql_host&gt; &lt;mysql_user&gt; &lt;mysql_password&gt; &lt;mysql_port&gt; &lt;tbds_user_password&gt;</span><br><span class="line">eg: sh /data/tbds_initdb.sh &lt;mysql_host&gt; root <span class="string">&#x27;tcs@mysql!root&#x27;</span>  &lt;mysql_port&gt; <span class="string">&#x27;tcs@mysql!root&#x27;</span></span><br><span class="line">jdbc:mysql://xx.xxx.xxx.xx:xxx/hivemetastore</span><br><span class="line">ç„¶åç§Ÿæˆ·åˆ›å»º</span><br><span class="line">ç§Ÿæˆ·å…±äº«globalé›†ç¾¤</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>æ‚ç¯‡</category>
      </categories>
  </entry>
  <entry>
    <title>å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡05</title>
    <url>/2025/09/25/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8705/</url>
    <content><![CDATA[<p>nerdctl æ„å»ºé•œåƒ</p>
<p>éœ€æ±‚åœºæ™¯ï¼Œéœ€è¦åšä¸€ä¸ªæäº¤ä»£ç ï¼Œç„¶åæ„å»ºé•œåƒçš„è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">docker run -td --network host --entrypoint bash registry.tce.com/director-daemon/director-xdp:1.0.0-20250714-163850-01d4694.rhel.amd64</span><br><span class="line">nerdctl -n k8s.io <span class="built_in">cp</span> ./tcs_lb.c b3476a7b1d77:/tcs_lb/tcs_lb.c</span><br><span class="line">nerdctl -nk8s.io commit -c <span class="string">&#x27;ENTRYPOINT [&quot;/director-loader&quot;]&#x27;</span> b3476a7b1d77  registry.tce.com/director-daemon/director-xdp:<span class="built_in">test</span></span><br><span class="line">nerdctl -nk8s.io push registry.tce.com/director-daemon/director-xdp:<span class="built_in">test</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å®¹å™¨åŒ–</category>
      </categories>
      <tags>
        <tag>containerd</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</title>
    <url>/2025/09/06/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼</p>
<p>ä¸€ä¸‹æ˜¯å¼€å¯æˆ‘åšå®¢çš„å¼€å§‹ä¹‹è·¯</p>
<h2 id="ä¸€ã€åˆ›å»º"><a href="#ä¸€ã€åˆ›å»º" class="headerlink" title="ä¸€ã€åˆ›å»º"></a>ä¸€ã€åˆ›å»º</h2><p><a href="https://blog.csdn.net/CHUXUEZHE8210/article/details/146291775">äº Hexo + GitHub Pages çš„æ­å»ºä¸ªäººåšå®¢ç½‘ç«™çš„è¯¦ç»†æ•™ç¨‹</a></p>
<h2 id="äºŒã€æ›´æ–°"><a href="#äºŒã€æ›´æ–°" class="headerlink" title="äºŒã€æ›´æ–°"></a>äºŒã€æ›´æ–°</h2><p>åšå®¢çš„<strong>æºç </strong>ï¼ˆMarkdownæ–‡ç« ã€ä¸»é¢˜ã€é…ç½®ç­‰ï¼‰é€šå¸¸å­˜æ”¾åœ¨ä¸€ä¸ªGitHubä»“åº“ä¸­ï¼Œè€Œé€šè¿‡Hexoç”Ÿæˆçš„<strong>é™æ€ç½‘ç«™æ–‡ä»¶</strong>åˆ™éƒ¨ç½²åˆ°GitHub Pagesï¼ˆé€šå¸¸æ˜¯ <code>username.github.io</code> ä»“åº“çš„ç‰¹å®šåˆ†æ”¯ï¼Œå¦‚ <code>gh-pages</code> æˆ– <code>main</code>ï¼‰ã€‚</p>
<hr>
<h3 id="ğŸ“-æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰"><a href="#ğŸ“-æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰" class="headerlink" title="ğŸ“ æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰"></a>ğŸ“ æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰</h3><p>è¿™ç§æ–¹å¼éœ€è¦åœ¨è®¡ç®—æœºä¸Šé…ç½®å¥½Hexoç¯å¢ƒï¼ˆNode.js, Git, Hexoç­‰ï¼‰ã€‚</p>
<ol>
<li><p><strong>æ–°å»ºåšæ–‡</strong>ï¼šä½¿ç”¨å‘½ä»¤åˆ›å»ºæ–°çš„Markdownæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo new &quot;æ–‡ç« é¢˜ç›®&quot;  # æˆ– hexo n &quot;æ–‡ç« é¢˜ç›®&quot;</span><br></pre></td></tr></table></figure>



<p>è¿™ä¼šåœ¨ <code>source/_posts</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>æ–‡ç« é¢˜ç›®.md</code> æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>ç¼–å†™&#x2F;æ›´æ–°å†…å®¹</strong>ï¼šç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚VS Codeï¼‰ç¼–è¾‘ç”Ÿæˆçš„Markdownæ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>ç”Ÿæˆé™æ€æ–‡ä»¶</strong>ï¼šåœ¨Hexoç«™ç‚¹æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œå°†Markdownè½¬æ¢ä¸ºHTMLç­‰é™æ€èµ„æºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo generate  # æˆ– hexo g</span><br></pre></td></tr></table></figure>



<p>å¦‚æœéœ€è¦å…ˆ<strong>æ¸…é™¤ç¼“å­˜</strong>å’Œæ—§æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate</span><br><span class="line">```:cite[1]</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>æœ¬åœ°é¢„è§ˆï¼ˆå¯é€‰ä½†æ¨èï¼‰</strong>ï¼šåœ¨éƒ¨ç½²å‰ï¼Œæœ€å¥½å…ˆåœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨æ£€æŸ¥æ•ˆæœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo server  # æˆ– hexo s </span><br></pre></td></tr></table></figure>



<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:4000</code> æŸ¥çœ‹ã€‚</p>
</li>
<li><p><strong>éƒ¨ç½²åˆ°GitHub Pages</strong>ï¼šå°†ç”Ÿæˆå¥½çš„é™æ€æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ <code>public</code> ç›®å½•ï¼‰æ¨é€è‡³GitHubä»“åº“çš„ç‰¹å®šåˆ†æ”¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo deploy  # æˆ– hexo d</span><br></pre></td></tr></table></figure>



<p>å¸¸ç”¨çš„ä¾¿æ·ç»„åˆå‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line"></span><br><span class="line">ä¸ºäº†èƒ½ä½¿ç”¨ `hexo deploy` å‘½ä»¤ï¼Œæ‚¨éœ€è¦ï¼š</span><br><span class="line">åœ¨Hexoçš„**ç«™ç‚¹é…ç½®æ–‡ä»¶** (`_config.yml`) ä¸­æ­£ç¡®è®¾ç½®éƒ¨ç½²ä¿¡æ¯:</span><br><span class="line">    deploy:</span><br><span class="line">      type: git</span><br><span class="line">      repo: &lt;æ‚¨çš„GitHubä»“åº“SSHæˆ–HTTPSåœ°å€&gt;  # ä¾‹å¦‚ git@github.com:username/username.github.io.git</span><br><span class="line">      branch: &lt;éƒ¨ç½²åˆ†æ”¯ï¼Œå¦‚gh-pagesæˆ–main&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ul>
<li>ç¡®ä¿å·²å®‰è£… <strong>hexo-deployer-git</strong> æ’ä»¶:cite[4]:cite[6]ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>æ¨é€æºç ï¼ˆé‡è¦ï¼‰</strong>ï¼š<code>hexo deploy</code> é€šå¸¸åªéƒ¨ç½²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ã€‚åˆ«å¿˜äº†å°†æ‚¨çš„<strong>åšå®¢æºç </strong>ï¼ˆMarkdownæ–‡ç« ã€ä¸»é¢˜ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰ä¹Ÿæ¨é€åˆ°GitHubä»“åº“çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¾‹å¦‚ <code>source</code> æˆ– <code>hexo-source</code>ï¼‰ï¼Œä»¥ä¾¿å¤‡ä»½å’Œåœ¨å¤šè®¾å¤‡é—´åŒæ­¥ã€‚</p>
</li>
</ol>
<h2 id="ä¸‰ã€next-å®¢åˆ¶åŒ–é¡µé¢"><a href="#ä¸‰ã€next-å®¢åˆ¶åŒ–é¡µé¢" class="headerlink" title="ä¸‰ã€next å®¢åˆ¶åŒ–é¡µé¢"></a>ä¸‰ã€next å®¢åˆ¶åŒ–é¡µé¢</h2><p>3.1 å­—ä½“è®¾ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="comment">#enable: false</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Uri of fonts host, e.g. https://fonts.googleapis.com (Default).</span></span><br><span class="line">  <span class="attr">host:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font options:</span></span><br><span class="line">  <span class="comment"># `external: true` will load this font family from `host` above.</span></span><br><span class="line">  <span class="comment"># `family: Times New Roman`. Without any quotes.</span></span><br><span class="line">  <span class="comment"># `size: x.x`. Use `em` as unit. Default: 1 (16px)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global font settings used for all elements inside &lt;body&gt;.</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">sans-serif</span></span><br><span class="line">    <span class="attr">size:</span> <span class="number">0.</span><span class="string">725em</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for site title (.site-title).</span></span><br><span class="line">  <span class="attr">title:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;).</span></span><br><span class="line">  <span class="attr">headings:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for posts (.post-body).</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line">  <span class="comment">#Roboto</span></span><br><span class="line">  <span class="attr">codes:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Fira</span> <span class="string">Code</span>  </span><br><span class="line">    <span class="attr">size:</span> <span class="string">.6em</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3.2 é¡µé¢å­—ä½“è®¾ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat  themes/next/source/css/_variables/base.styl</span><br><span class="line">$font-size-base           = (hexo-config(&#x27;font.enable&#x27;) and hexo-config(&#x27;font.global.size&#x27;) is a &#x27;unit&#x27;) ? unit(hexo-config(&#x27;font.global.size&#x27;), em) : .8125em;</span><br><span class="line">//$font-size-base           = .8125em; #ç»Ÿä¸€æ›´æ”¹è¿™ä¸ªå¤§å°</span><br></pre></td></tr></table></figure>

<p>3.3 ç”Ÿæ•ˆå¹¶éƒ¨ç½²</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d <span class="comment">#æ¸…é™¤ç¼“å­˜ä¸”æµè§ˆå™¨ä¹Ÿéœ€æ— ç—•</span></span><br></pre></td></tr></table></figure>

<p>3.4 å›¾ç‰‡é—®é¢˜ä¸è®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‚æ•°å¼€å¯+æ’ä»¶å®‰è£…+ç”¨hexo n æ–‡æ¡£ å»ç”Ÿæˆæ–‡æ¡£æ–‡ä»¶</span></span><br><span class="line">1.å°†_config.yml æ–‡ä»¶ä¸­çš„post_asset_folder é€‰é¡¹è®¾ä¸º <span class="literal">true</span> æ¥æ‰“å¼€</span><br><span class="line">2.npm install https://github.com/CodeFalling/hexo-asset-image --save</span><br></pre></td></tr></table></figure>

<p>3.5 æœç´¢æ¡†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…hexo-generator-searchdbæ’ä»¶</span></span><br><span class="line">npm install hexo-generator-searchdb --save </span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶é…ç½®_config.yaml</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  <span class="built_in">limit</span>: 10000</span><br><span class="line"><span class="comment">#_config.next.yaml</span></span><br><span class="line">local_search:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/m0_43401436/article/details/107191688">å›¾ç‰‡è®¾ç½®ä¸ç”Ÿæ•ˆ</a>  <a href="https://juejin.cn/post/6921750181297782798">æ ‡ç­¾ä¸åˆ†ç±»é…ç½®</a>  <a href="https://ifonlybean.github.io/note/hexo-site/">ç«™ç‚¹å¯¼èˆª</a></p>
]]></content>
      <categories>
        <category>æ‚ç¯‡</category>
      </categories>
  </entry>
  <entry>
    <title>ç½‘ç»œæ’éšœå·¥å…·çš„ä½¿ç”¨01</title>
    <url>/2025/09/11/%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A801/</url>
    <content><![CDATA[<p>è¦å¯¹å®¹å™¨è¿›è¡ŒæŠ“åŒ…ï¼Œä¸”å®¹å™¨é‡Œé¢æ²¡æœ‰æŠ“åŒ…çš„å·¥å…·ã€‚ç”¨nsenter -t pid -n å¯è·å–å®¹å™¨å†…çš„å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data/tcpdump</span><br><span class="line"><span class="built_in">chmod</span> 777  /data/tcpdump</span><br><span class="line"><span class="comment">#ç°åœºéœ€è¦æŠŠè¿™ä¸ªpodnameåšæˆæ›¿æ¢ï¼Œæ›¿æ¢ä¸ºç°åœºçš„å®é™…podåç§°</span></span><br><span class="line">podname=4d1af57e04da</span><br><span class="line"><span class="built_in">id</span>=$(docker ps | grep -v pause | grep <span class="variable">$podname</span> | <span class="built_in">head</span> -1 |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">pid=$(docker inspect <span class="variable">$id</span>| grep -w Pid |grep -oE <span class="string">&#x27;[0-9]+&#x27;</span>)</span><br><span class="line">nsenter -t <span class="variable">$pid</span> -n  tcpdump -i eth0    -nvve -C 100 -W 20 -w /tmp/<span class="variable">$podname</span>.pcap</span><br><span class="line"></span><br><span class="line"><span class="comment"># -C 100 æ˜¯100Mï¼Œ-W 10 ä¿å­˜10ä¸ªæ–‡ä»¶</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸€ä¸ªæœåŠ¡å¼‚å¸¸ï¼Œéœ€è¦æŸ¥çœ‹è¯¦ç»†çš„æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">journalctl -xe -u network</span><br><span class="line">dmesg | grep bond</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‰ç…§æŸä¸ªç»„ä»¶æ˜¯ç”±ä»€ä¹ˆæä¾›çš„</span></span><br><span class="line">yum provides iostat </span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>tcpdump</tag>
        <tag>nsenter</tag>
        <tag>journalctl</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡ç½‘å¡ä¿®æ”¹åŠnmcli ä½¿ç”¨</title>
    <url>/2025/09/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BD%91%E5%8D%A1%E4%BF%AE%E6%94%B9%E5%8F%8Anmcli-%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>å› éœ€è¦ä¿®æ”¹ç³»ç»Ÿå‚æ•°ç½‘å¡é˜Ÿåˆ—ï¼Œéœ€è¦å°†å…¶æœºå™¨éœ€è¦é‡å¯ã€‚ç›®å‰å‘ç°é›†ç¾¤ä¸€å…±100å¤šå°æœºå™¨ï¼Œé‡å¯å…¶ä¸­ä¸€å°masteræœºå™¨åï¼Œä¸€ç›´å¤„äºnotReadyçŠ¶æ€ã€‚<br>åŸå› æ˜¯å› ä¸ºæ”¹æœºå™¨ä¸ºåŒç½‘å¡ï¼Œä½†æ˜¯å› ä¸ºç½‘å¡åæœªå›ºå®šã€‚é€ æˆä½¿ç”¨ä¸ºå›ºå®šçš„ç½‘å¡æœªå¯åŠ¨æˆåŠŸã€‚</p>
<p>è§£å†³æ€è·¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. æŸ¥è¯¢100å¤šå°æœºå™¨ï¼Œ/etc/udev/rules.d/70-persistent-net.rules  æ–‡ä»¶æ˜¯å¦éƒ½å«2æ¡è®°å½•</span><br><span class="line"></span><br><span class="line">2.é’ˆå¯¹æœªå«çš„èŠ‚ç‚¹æ“ä½œï¼Œæ·»åŠ è¯¥æ¡ä¿¡æ¯ï¼Œç½‘å¡åä¸å¯ä¿®æ”¹ï¼Œè¦ä¸åŸå…ˆé‡å¯å‰ä¸€è‡´ã€‚æ·»åŠ åå¦‚ä¸‹ï¼š</span><br><span class="line">SUBSYSTEM==<span class="string">&quot;net&quot;</span>, ACTION==<span class="string">&quot;add&quot;</span>, DRIVERS==<span class="string">&quot;?*&quot;</span>, ATTR&#123;address&#125;==<span class="string">&quot;fa:16:3e:98:70:9c&quot;</span>, NAME=<span class="string">&quot;ens3&quot;</span></span><br><span class="line">SUBSYSTEM==<span class="string">&quot;net&quot;</span>, ACTION==<span class="string">&quot;add&quot;</span>, DRIVERS==<span class="string">&quot;?*&quot;</span>, ATTR&#123;address&#125;==<span class="string">&quot;fa:16:3e:f5:e0:f1&quot;</span>, NAME=<span class="string">&quot;ens10&quot;</span> <span class="comment">#æ›´æ–°çš„ç›®æ ‡ç½‘å¡å</span></span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼š<br>å› åŠ çš„ç½‘å¡åå˜æ›´ä¸ºens4ï¼Œé€ æˆç½‘å¡ä¸€ç›´upä¸èµ·æ¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@tcs-10-25-83-48 network-scripts]# nmcli  device conn ens4</span><br><span class="line">é”™è¯¯ï¼šæ·»åŠ /æ¿€æ´»æ–°è¿æ¥å¤±è´¥ï¼šConnection <span class="string">&#x27;ens4&#x27;</span> is not available on device ens4 because device is strictly unmanaged</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="nmcliå¤„ç†è¿‡ç¨‹ï¼š"><a href="#nmcliå¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="nmcliå¤„ç†è¿‡ç¨‹ï¼š"></a>nmcliå¤„ç†è¿‡ç¨‹ï¼š</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">show</span>  <span class="comment">#æŸ¥çœ‹è®¾å¤‡è¿æ¥æƒ…å†µ</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">show</span> <span class="string">&quot;System ens4&quot;</span> <span class="comment">#æŸ¥çœ‹ç½‘å¡è®¾ç½®çš„è¯¦æƒ…</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">reload</span> <span class="comment">#é‡å¯è®¾å¤‡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">up</span> <span class="string">ens4</span> <span class="comment">#è¿æ¥ens4è®¾ç½®</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">set</span> <span class="string">&lt;ç½‘å¡åç§°&gt;</span> <span class="string">managed</span> <span class="literal">yes</span> <span class="comment">#æ¿€æ´»ç½‘å¡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="comment">#æŸ¥çœ‹æ‰€æœ‰çš„è®¾å¤‡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">conn</span> <span class="comment">#å°†æ‰€æœ‰è®¾å¤‡conn</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">conn</span> <span class="string">ens4</span> <span class="comment">#ç½‘å¡è¿æ¥</span></span><br><span class="line"><span class="string">nmcli</span>  <span class="string">networking</span> <span class="comment">#æŸ¥çœ‹ç½‘ç»œæ˜¯ç”±è®¾ç½®</span></span><br></pre></td></tr></table></figure>

<p>åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@X-x.1-x.1-x.1-x.1 network-scripts]# <span class="built_in">cd</span> /etc/NetworkManager/conf.d/</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">ls</span></span><br><span class="line">99-cloud-init.conf  99-container.conf</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">cat</span> 99-cloud-init.conf </span><br><span class="line"><span class="comment"># Created by cloud-init on instance boot automatically, do not edit.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[main]</span><br><span class="line">dns = none</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">cat</span> 99-container.conf</span><br><span class="line"><span class="comment"># avoid making container interface down</span></span><br><span class="line">[keyfile]</span><br><span class="line">unmanaged-devices=*,except:interface-name:ens10,except:interface-name:ens3 </span><br><span class="line"><span class="comment">#99-container.confï¼Œå› å®¹å™¨å¹³å°éƒ¨ç½²å®Œåï¼Œç½‘å¡åè¢«è·å–åˆ°äº†å¹¶å†™å…¥åˆ°ç±»ä¼¼æ–‡ä»¶ä¸­ï¼Œæ•…ä¸å»ºè®®ä¿®æ”¹ç½‘å¡åç§°(å³NAME=&quot;ens10&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼šè®°å½•ä¸€æ¬¡å› bondæ–‡ä»¶é…ç½®é—®é¢˜é€ æˆçš„äº¤æ¢æœºç½‘å£å…·æœ‰downçš„æƒ…å†µï¼Œæ²¡æœ‰nmcliå·¥å…·éœ€è¦é…ç½®ç½‘å¡é…ç½®bond4ï¼Œé…ç½®ä¿¡æ¯åŠå…¶å«ä¹‰ï¼Œè®°å½•æ­£å¸¸çš„é…ç½®ä¿¡æ¯åŠå¦‚ä½•å†æœºå™¨èŠ‚ç‚¹ä¸Šè¿›è¡Œæ’æŸ¥ç¡®è®¤ç½‘å£bondæ­£å¸¸</p>
<h4 id="ifcfg-eth0"><a href="#ifcfg-eth0" class="headerlink" title="ifcfg-eth0"></a>ifcfg-eth0</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#IP Config for eth0:</span></span><br><span class="line">DEVICE=<span class="string">&#x27;eth0&#x27;</span></span><br><span class="line">HWADDR=xx</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">SLAVE=<span class="built_in">yes</span>  <span class="comment"># ä¿®æ­£æ‹¼å†™é”™è¯¯</span></span><br><span class="line">MASTER=bond1</span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>

<h4 id="ifcfg-eth1"><a href="#ifcfg-eth1" class="headerlink" title="ifcfg-eth1"></a>ifcfg-eth1</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#IP Config for eth1:</span></span><br><span class="line">DEVICE=<span class="string">&#x27;eth1&#x27;</span></span><br><span class="line">HWADDR=xxxxx</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=<span class="built_in">yes</span></span><br><span class="line">USERCTL=no  <span class="comment"># ä¿®æ­£ä¸ºæœ‰æ•ˆå€¼</span></span><br><span class="line">BOOTPROTO=none</span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>

<h4 id="ifcfg-bond1"><a href="#ifcfg-bond1" class="headerlink" title="ifcfg-bond1"></a>ifcfg-bond1</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#IP Config for bond1:</span></span><br><span class="line">DEVICE=bond1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=10.215.173.44</span><br><span class="line">NETMASK=255.255.255.128</span><br><span class="line">GATEWAY=10.215.173.1</span><br><span class="line">USERCTL=no</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">TYPE=Bond  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br><span class="line">BONDING_OPTS=<span class="string">&#x27;miimon=100 mode=4 ad_select=0 lacp_rate=fast updelay=200 xmit_hash_policy=2&#x27;</span>  <span class="comment"># ä¿®æ­£å‚æ•°</span></span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mode=4ï¼šè¡¨ç¤ºIEEE 802.3adåŠ¨æ€é“¾è·¯èšåˆï¼ˆLACPï¼‰</span></span><br><span class="line"><span class="comment">#miimon=100ï¼šæ¯100æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡é“¾è·¯çŠ¶æ€</span></span><br><span class="line"><span class="comment">#ad_select=1ï¼šé€‰æ‹©ç­–ç•¥ï¼Œ1è¡¨ç¤ºå¤‡ä»½æ¨¡å¼ï¼ˆä½†æ ¹æ®bondingæ–‡æ¡£ï¼Œad_selectçš„å¯èƒ½å€¼ä¸º0ã€1ã€2ï¼Œ1è¡¨ç¤ºâ€œå¤‡ä»½â€ä¼¼ä¹ä¸å¯¹ï¼Œé€šå¸¸ad_select=0ï¼ˆstableï¼‰æˆ–1ï¼ˆbandwidthï¼‰æˆ–2ï¼ˆcountï¼‰ï¼‰æ³¨æ„ï¼šad_select=1å®é™…ä¸Šè¡¨ç¤ºâ€œå¸¦å®½â€ï¼ˆbandwidthï¼‰ï¼Œå³é€‰æ‹©æ´»åŠ¨èšåˆç»„ä¸­å¸¦å®½æœ€å¤§çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment">#lacp_rate=fastï¼šLACPé€Ÿç‡ï¼Œfastè¡¨ç¤ºæ¯1ç§’å‘é€ä¸€æ¬¡LACPæŠ¥æ–‡ï¼ˆæ…¢é€Ÿä¸º30ç§’ï¼‰</span></span><br><span class="line"><span class="comment">#updelay=0ï¼šå¯ç”¨ç«¯å£çš„å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œä½†è¿™é‡Œè®¾ç½®äº†ä¸¤æ¬¡updelayï¼Œç¬¬ä¸€ä¸ªä¸º0ï¼Œç¬¬äºŒä¸ªä¸º200ï¼Œè¿™å¯èƒ½ä¼šè¢«æœ€åä¸€ä¸ªå€¼è¦†ç›–ã€‚å®é™…ä¸Šï¼Œåœ¨#BONDING_OPTSä¸­ï¼ŒåŒä¸€ä¸ªå‚æ•°å‡ºç°å¤šæ¬¡ï¼Œé€šå¸¸æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚æ‰€ä»¥updelay=200å¯èƒ½ä¼šè¦†ç›–å‰é¢çš„0ã€‚</span></span><br><span class="line"><span class="comment">#xmit_hash_policy=2ï¼šä¼ è¾“å“ˆå¸Œç­–ç•¥ï¼Œ2è¡¨ç¤ºä½¿ç”¨å±‚3+4ï¼ˆIPå’Œç«¯å£ï¼‰çš„å“ˆå¸Œã€‚</span></span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®é—®é¢˜åˆ†æ</strong></p>
<p> <strong>ifcfg-bond1 ä¸­çš„é—®é¢˜</strong></p>
<ul>
<li><strong>é‡å¤çš„ updelay å‚æ•°</strong>ï¼š<code>updelay=0</code> å’Œ <code>updelay=200</code> åŒæ—¶å­˜åœ¨,æœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯æœ€åä¸€ä¸ªï¼Œå³ updelay&#x3D;200ã€‚</li>
<li><strong>ad_select&#x3D;1</strong>ï¼šåœ¨æŸäº›ç³»ç»Ÿç‰ˆæœ¬ä¸­å¯èƒ½ä¸è¢«æ”¯æŒ</li>
</ul>
<p><strong>checké…ç½®å¥½åçš„çŠ¶æ€</strong></p>
<p>1.ping ç½‘å…³ </p>
<p>2.&#x2F;proc&#x2F;net&#x2F;bonding&#x2F;bond1</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Bonding Mode: IEEE 802.3ad Dynamic <span class="built_in">link</span> aggregation - æ­£ç¡®ï¼Œæ¨¡å¼ä¸º4ã€‚</span><br><span class="line">MII Status: up - ç»‘å®šæ¥å£çŠ¶æ€æ­£å¸¸ã€‚</span><br><span class="line">Slave Interface: eth0 å’Œ eth1 éƒ½æ˜¯ upï¼Œé€Ÿåº¦å‡ä¸º 25000 Mbpsï¼Œå…¨åŒå·¥ï¼Œé“¾è·¯å¤±è´¥è®¡æ•°ä¸º0ï¼Œç‰©ç†åœ°å€æ­£ç¡®ã€‚</span><br><span class="line">Aggregator ID: ä¸¤ä¸ªæ¥å£çš„ Aggregator ID éƒ½æ˜¯ 1 - è¿™è¡¨ç¤ºä¸¤ä¸ªæ¥å£æˆåŠŸèšåˆåˆ°åŒä¸€ä¸ªèšåˆç»„ä¸­ã€‚</span><br><span class="line">Actor/Partner Churn State: å‡ä¸º noneï¼Œè¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿæ‰°åŠ¨ï¼Œè¿æ¥ç¨³å®šã€‚</span><br><span class="line">Partner Mac Address: ä¸¤ä¸ªæ¥å£çš„ Partner Mac Address éƒ½æ˜¯ 00:01:00:01:00:01ï¼Œè¿™è¡¨ç¤ºå®ƒä»¬è¿æ¥åˆ°åŒä¸€ä¸ªå¯¹ç«¯è®¾å¤‡ï¼ˆäº¤æ¢æœºï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>3.ä½¿ç”¨ <code>ethtool eth0</code> å’Œ <code>ethtool eth1</code> å†æ¬¡ç¡®è®¤é“¾è·¯çŠ¶æ€ä¸º <code>Link detected: yes</code> ä¸”é€Ÿç‡ä¸º 25000Mb&#x2F;sã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nmcli</tag>
        <tag>bond</tag>
      </tags>
  </entry>
</search>
