<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=sans-serif:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="æˆ‘çš„åšå®¢">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="æˆ‘çš„åšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¸…æ±‡">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>æˆ‘çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">æˆ‘çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">è®°å½•æŠ€æœ¯ç‚¹æ»´</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/11/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8703/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/11/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8703/" class="post-title-link" itemprop="url">å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡03</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-11 14:11:35" itemprop="dateCreated datePublished" datetime="2025-09-11T14:11:35+08:00">2025-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-12 09:51:15" itemprop="dateModified" datetime="2025-09-12T09:51:15+08:00">2025-09-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning  SystemLoadIsFull  56s (x1313 over 2d2h)  custom-plugin-monitor  (combined from similar events): system load/cores percent exceeded threshold 80%, load/cores percent: 118.09%, load15m: 37.79</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/08/ES%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%8601/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/08/ES%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%8601/" class="post-title-link" itemprop="url">ESåŸºæœ¬ä½¿ç”¨åŠé—®é¢˜å¤„ç†01</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-08 14:20:17" itemprop="dateCreated datePublished" datetime="2025-09-08T14:20:17+08:00">2025-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-12 09:21:00" itemprop="dateModified" datetime="2025-09-12T09:21:00+08:00">2025-09-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">ä¸­é—´ä»¶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä¸šåŠ¡è¿›è¡Œå‹æµ‹ï¼Œåé¢é€ æˆESæ•°æ®æ»¡äº†ï¼Œæœ‰90%å‘Šè­¦ã€‚é’ˆå¯¹è¯¥æƒ…å†µéœ€è¦æ¸…ç†ESï¼Œæ•°æ®å¯ä»¥æ­£å¸¸å†™å…¥ã€‚</p>
<h3 id="æ¸…ç†æ•°æ®"><a href="#æ¸…ç†æ•°æ®" class="headerlink" title="æ¸…ç†æ•°æ®"></a>æ¸…ç†æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl 10.25.83.242:9200/_cluster/health?pretty <span class="comment">#æŸ¥çœ‹ç›‘æ§</span></span><br><span class="line">curl 10.25.83.242:9200/_cat/indices?v |grep gb <span class="comment">#æŸ¥çœ‹æ•°æ®</span></span><br><span class="line">curl -XDELETE 10.25.83.242:9200/xxxxx <span class="comment">#åˆ é™¤æ•°æ®</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å‘ç°æ¸…ç†æ•°æ®å®Œå€™ï¼ŒESåªè¯»ï¼Œæ•°æ®å†™ä¸è¿›æ•°æ®</p>
<h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p><strong>åªè¯»æ ‡è®°æœªæ‰‹åŠ¨æ¸…é™¤</strong>ï¼šè¿™æ˜¯æœ€å¸¸è§çš„åŸå› ã€‚Elasticsearch <strong>ä¸ä¼šè‡ªåŠ¨</strong>å°†ç´¢å¼•çš„ <code>read_only_allow_delete</code> å±æ€§æ”¹å› <code>false</code></p>
<p><strong>ç£ç›˜ç©ºé—´æœªçœŸæ­£æœ‰æ•ˆé‡Šæ”¾</strong>ï¼š</p>
<ul>
<li><p><strong>å»¶è¿Ÿé‡Šæ”¾</strong>ï¼šä½¿ç”¨ <code>DELETE</code> æ“ä½œæˆ– <code>_delete_by_query</code> è¿›è¡Œæ•°æ®åˆ é™¤æ—¶ï¼ŒElasticsearch é‡‡ç”¨çš„æ˜¯â€œæ ‡è®°åˆ é™¤â€è€Œéç«‹å³ä»ç£ç›˜æ“¦é™¤ã€‚çœŸæ­£çš„ç©ºé—´é‡Šæ”¾éœ€è¦ç­‰å¾… <strong>Segment Merge</strong> è¿‡ç¨‹å®Œæˆã€‚</p>
</li>
<li><p><strong>æ¸…ç†é‡ä¸è¶³</strong>ï¼šå¯èƒ½åˆ é™¤çš„æ•°æ®é‡ä¸è¶³ä»¥è®©æ‰€æœ‰ç£ç›˜çš„ä½¿ç”¨ç‡éƒ½é™åˆ°æ°´ä½çº¿ï¼ˆç‰¹åˆ«æ˜¯ flood_stage, ä¾‹å¦‚95%ï¼‰ä»¥ä¸‹ã€‚Elasticsearch ä¼šæ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹ç£ç›˜ç©ºé—´ã€‚</p>
</li>
</ul>
<p>æ°´ä½çº¿æ£€æŸ¥æœ‰å»¶è¿Ÿæˆ–ç¼“å­˜ï¼šElasticsearch æ£€æµ‹ç£ç›˜ç©ºé—´å’Œä½¿ç”¨ç‡å˜åŒ–å¯èƒ½å­˜åœ¨çŸ­æš‚å»¶è¿Ÿã€‚</p>
<p>åˆ†ç‰‡åˆ†é…é—®é¢˜ï¼šå³ä½¿ç©ºé—´è¶³å¤Ÿï¼Œå¦‚æœä¹‹å‰å› ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´åˆ†ç‰‡æœªåˆ†é…ï¼Œç©ºé—´é‡Šæ”¾åå¯èƒ½éœ€è¦æ‰‹åŠ¨æ¢å¤åˆ†ç‰‡åˆ†é…æˆ–ç­‰å¾…é›†ç¾¤è‡ªåŠ¨é‡æ–°å¹³è¡¡ã€‚</p>
<h3 id="ğŸ“–-æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤"><a href="#ğŸ“–-æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤" class="headerlink" title="ğŸ“– æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤"></a>ğŸ“– æ€»ç»“ï¼šé—®é¢˜è§£å†³æ­¥éª¤</h3><table>
<thead>
<tr>
<th align="left">æ­¥éª¤</th>
<th align="left">æ“ä½œ</th>
<th align="left">å‘½ä»¤&#x2F;æ“ä½œç¤ºä¾‹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1ï¸âƒ£</td>
<td align="left"><strong>ç¡®è®¤ç£ç›˜ç©ºé—´</strong></td>
<td align="left"><code>GET /_cat/allocation?v</code></td>
<td align="left">æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„ç£ç›˜ä½¿ç”¨ç‡ï¼Œç¡®ä¿å‡ä½äºæ´ªæ°´æ°´ä½çº¿ï¼ˆå¦‚95%ï¼‰</td>
</tr>
<tr>
<td align="left">2ï¸âƒ£</td>
<td align="left"><strong>æ£€æŸ¥ç´¢å¼•è®¾ç½®</strong></td>
<td align="left"><code>GET your_index_name/_settings</code></td>
<td align="left">ç¡®è®¤ <code>index.blocks.read_only_allow_delete</code> æ˜¯å¦ä¸º <code>true</code></td>
</tr>
<tr>
<td align="left">3ï¸âƒ£</td>
<td align="left"><strong>æ‰‹åŠ¨è§£é™¤åªè¯»</strong></td>
<td align="left">curl  -H â€œContent-Type:application&#x2F;jsonâ€ -XPUT 10.25.83.242:9200&#x2F;_cluster&#x2F;settings -d â€˜{   â€œpersistentâ€: {     â€œcluster.blocks.read_only_allow_deleteâ€: false   } }â€™</td>
<td align="left">æ ¸å¿ƒæ­¥éª¤ï¼šæ‰‹åŠ¨æ¸…é™¤ç´¢å¼•çš„åªè¯»æ ‡è®°</td>
</tr>
<tr>
<td align="left">4ï¸âƒ£</td>
<td align="left">xxx</td>
<td align="left">curl -H â€œContent-Type: application&#x2F;jsonâ€  -XPUT â€˜10.25.83.242:9200&#x2F;_all&#x2F;_settingsâ€™ -d â€˜{â€œindexâ€:{â€œblocksâ€:{â€œread_only_allow_deleteâ€:null}}}â€™</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">5ï¸âƒ£</td>
<td align="left"><strong>éªŒè¯å†™å…¥</strong></td>
<td align="left"><code>POST your_index_name/_doc &#123; &quot;test&quot;: &quot;data&quot; &#125;</code></td>
<td align="left">å°è¯•å†™å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸ</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/08/clickhouse%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/08/clickhouse%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">clickhouseåˆ†å¸ƒå¼åŸºæœ¬ä½¿ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-08 11:01:56 / ä¿®æ”¹æ—¶é—´ï¼š13:27:57" itemprop="dateCreated datePublished" datetime="2025-09-08T11:01:56+08:00">2025-09-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">ä¸­é—´ä»¶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ç›®å‰clickhouseåˆ›å»ºæ˜¯2å‰¯æœ¬çš„,ä¸šåŠ¡é¡µé¢è®¿é—®clickhouse å‘ç°ä¸¤ä¸ªclickhouseçš„æ•°æ®ä¸åŒæ­¥ã€‚ä¸»è¦åŸå› æ˜¯æœªåˆ›å»ºåˆ†å¸ƒå¼clickhouseå®ä¾‹ã€‚ç›®å‰é’ˆå¯¹è¯¥åœºæ™¯è¿›è¡Œè®°å½•clickhouseåˆ†å¸ƒå¼çš„ä½¿ç”¨</p>
<h3 id="å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“"><a href="#å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“" class="headerlink" title="å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“"></a>å®¹å™¨ç™»é™†clickhouseæ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kubectl  <span class="built_in">exec</span> -it -n sso     clickhouse-sso-test-clickhhouse-0-ss-0  -c clickhouse -- clickhouse-client --user root --password testclickhouse  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse"><a href="#æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse" class="headerlink" title="æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse"></a>æˆ–è€…ä½¿ç”¨curlè¿æ¥clickhouse</h3><p>ç›®å‰ä¸šåŠ¡å¯ä¾æ®ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä½¿ç”¨ä»£ç è¿›è¡Œåˆ›å»ºã€‚æˆ–è€…ä½¿ç”¨å¯è§†åŒ–è§†å›¾è¿›è¡Œåˆ›å»ºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  <span class="string">&quot;http://10.25.83.231:8123/?user=root&amp;password=testclickhouse&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;create database test0814 on cluster defaultCluster;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºåˆ†å¸ƒå¼åº“"><a href="#åˆ›å»ºåˆ†å¸ƒå¼åº“" class="headerlink" title="åˆ›å»ºåˆ†å¸ƒå¼åº“"></a>åˆ›å»ºåˆ†å¸ƒå¼åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test0813 ä¸ºæ•°æ®åº“å</span></span><br><span class="line"><span class="comment">#defaultCluster çš„ ClickHouse é›†ç¾¤</span></span><br><span class="line">create database test0813 on cluster defaultCluster;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæœ¬åœ°è¡¨"><a href="#åˆ›å»ºæœ¬åœ°è¡¨" class="headerlink" title="åˆ›å»ºæœ¬åœ°è¡¨"></a>åˆ›å»ºæœ¬åœ°è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SHOW CREATE TABLE test0813.local_table å¯æŸ¥çœ‹è¡¨ç»“æ„</span></span><br><span class="line">CREATE TABLE test0813.local_table ON CLUSTER defaultCluster</span><br><span class="line">(</span><br><span class="line">    event_date Date,</span><br><span class="line">    user_id UInt64,</span><br><span class="line">    action_type Enum(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    device Array(String)</span><br><span class="line">)</span><br><span class="line">ENGINE = ReplicatedMergeTree(<span class="string">&#x27;/clickhouse/tables/&#123;shard&#125;/test0813/local_table&#x27;</span>, <span class="string">&#x27;&#123;replica&#125;&#x27;</span>)</span><br><span class="line">PARTITION BY toYYYYMM(event_date)</span><br><span class="line">ORDER BY (user_id, action_type)</span><br><span class="line">SETTINGS index_granularity = 8192;</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>1.test0813.local_tableï¼šåˆ›å»ºåœ¨ test0813 æ•°æ®åº“ä¸­çš„ local_table è¡¨</p>
<p>2.ON CLUSTER defaultClusterï¼šåœ¨åä¸º defaultCluster çš„ ClickHouse é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ›å»ºæ­¤è¡¨</p>
<p>3.ReplicatedMergeTreeè¿™ä¸ªå¼•æ“ç”¨äºåˆ›å»ºå…·æœ‰å¤åˆ¶åŠŸèƒ½çš„è¡¨ï¼Œç¡®ä¿æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´åŒæ­¥ã€‚</p>
<table>
<thead>
<tr>
<th><strong>è·¯å¾„ç»„ä»¶</strong></th>
<th><strong>è¯´æ˜</strong></th>
<th><strong>ç¤ºä¾‹å€¼</strong></th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;clickhouse&#x2F;tables</td>
<td>æ ¹è·¯å¾„ï¼ˆClickHouse çº¦å®šï¼‰</td>
<td>å›ºå®šå€¼</td>
</tr>
<tr>
<td>{shard}</td>
<td><strong>åˆ†ç‰‡æ ‡è¯†ç¬¦å ä½ç¬¦</strong></td>
<td>01, shard1</td>
</tr>
<tr>
<td>test0813</td>
<td>æ•°æ®åº“åç§°</td>
<td>æ‚¨çš„æ•°æ®åº“å</td>
</tr>
<tr>
<td>local_table</td>
<td>æœ¬åœ°è¡¨åç§°</td>
<td>æ‚¨çš„è¡¨å</td>
</tr>
</tbody></table>
<p>4.PARTITION BY toYYYYMM(event_date) <em>â€“ æŒ‰æœˆåˆ†åŒº</em></p>
<p>5.ORDER BY (user_id, action_type) <em>â€“ ä¸»é”®ç´¢å¼•</em></p>
<p>6.SETTINGS index_granularity &#x3D; 8192 <em>â€“ ç´¢å¼•ç²’åº¦</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç´¢å¼•ç²’åº¦ï¼šæ¯ 8192 è¡Œç”Ÿæˆä¸€ä¸ªç´¢å¼•æ ‡è®°</span><br><span class="line">æ€§èƒ½å½±å“ï¼š</span><br><span class="line">å€¼è¶Šå° â†’ ç´¢å¼•æ›´ç²¾ç»† â†’ æŸ¥è¯¢æ›´å¿« â†’ ç´¢å¼•æ›´å¤§</span><br><span class="line">å€¼è¶Šå¤§ â†’ ç´¢å¼•æ›´ç²—ç³™ â†’ æŸ¥è¯¢ç¨æ…¢ â†’ ç´¢å¼•æ›´å°</span><br><span class="line">é»˜è®¤å€¼ï¼š8192ï¼ˆå¹³è¡¡é€‰æ‹©ï¼‰</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºåˆ†å¸ƒå¼è¡¨"><a href="#åˆ›å»ºåˆ†å¸ƒå¼è¡¨" class="headerlink" title="åˆ›å»ºåˆ†å¸ƒå¼è¡¨"></a>åˆ›å»ºåˆ†å¸ƒå¼è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test0813.user_data ON CLUSTER defaultCluster</span><br><span class="line">(</span><br><span class="line">    event_date Date,</span><br><span class="line">    user_id UInt64,</span><br><span class="line">    action_type Enum(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;logout&#x27;</span>),</span><br><span class="line">    device Array(String)</span><br><span class="line">)</span><br><span class="line">ENGINE = Distributed(</span><br><span class="line">    defaultCluster,   -- é›†ç¾¤åç§°</span><br><span class="line">    <span class="string">&#x27;test0813&#x27;</span>,       -- æ•°æ®åº“å</span><br><span class="line">    <span class="string">&#x27;local_table&#x27;</span>,    -- åº•å±‚æœ¬åœ°è¡¨å</span><br><span class="line">    rand()            -- åˆ†ç‰‡é”®ï¼ˆéšæœºåˆ†å¸ƒï¼‰</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡åˆ†å¸ƒå¼è¡¨æ’å…¥ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰</span></span><br><span class="line">INSERT INTO test0813.user_data </span><br><span class="line">VALUES</span><br><span class="line">    (<span class="string">&#x27;2023-08-11&#x27;</span>, 1001, <span class="string">&#x27;login&#x27;</span>, [<span class="string">&#x27;iPhone&#x27;</span>,<span class="string">&#x27;iOS 15&#x27;</span>]),</span><br><span class="line">    (<span class="string">&#x27;2023-08-11&#x27;</span>, 1002, <span class="string">&#x27;logout&#x27;</span>, [<span class="string">&#x27;Android&#x27;</span>,<span class="string">&#x27;Chrome&#x27;</span>]),</span><br><span class="line">    (<span class="string">&#x27;2023-08-12&#x27;</span>, 1003, <span class="string">&#x27;login&#x27;</span>, [<span class="string">&#x27;Windows&#x27;</span>,<span class="string">&#x27;Firefox&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰å…¨åˆ é™¤åˆ†å¸ƒå¼è¡¨ï¼Œåˆ é™¤åˆ†å¸ƒå¼è¡¨ï¼ˆä¸å½±å“æ•°æ®ï¼‰</span></span><br><span class="line">DROP TABLE IF EXISTS test0813.user_data ON CLUSTER defaultCluster</span><br><span class="line"><span class="comment">#åˆ é™¤æœ¬åœ°è¡¨ï¼ˆæ°¸ä¹…åˆ é™¤æ•°æ®ï¼‰</span></span><br><span class="line">DROP TABLE IF EXISTS test0813.local_table ON CLUSTER defaultCluster</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–è¯´æ˜"><a href="#å…¶ä»–è¯´æ˜" class="headerlink" title="å…¶ä»–è¯´æ˜"></a>å…¶ä»–è¯´æ˜</h3><ol>
<li>åˆ›å»ºå¤šå¼ è¡¨ï¼Œæ˜¯å¦éœ€è¦åˆ›å»ºå¤šå¼ local_tableçš„è¡¨ï¼Ÿéœ€è¦çš„</li>
<li>éœ€è¦å…³é—­ä¸€å°èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥ã€‚ä¼šåŒæ­¥çš„</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/07/Chronyd-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%8E%92%E9%94%99%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/07/Chronyd-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%8E%92%E9%94%99%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-07 12:38:00 / ä¿®æ”¹æ—¶é—´ï¼š13:42:58" itemprop="dateCreated datePublished" datetime="2025-09-07T12:38:00+08:00">2025-09-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Chronyd-å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—"><a href="#Chronyd-å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—" class="headerlink" title="Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—"></a>Chronyd å®‰è£…ä¸é…ç½®æ’é”™æŒ‡å—</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li>Chronyd å®‰è£…ä¸é…ç½®</li>
<li>ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®</li>
<li>æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­</li>
<li>ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ</li>
<li>æ—¶åŒºé…ç½®</li>
</ol>
<hr>
<h2 id="1-Chronyd-å®‰è£…ä¸é…ç½®"><a href="#1-Chronyd-å®‰è£…ä¸é…ç½®" class="headerlink" title="1. Chronyd å®‰è£…ä¸é…ç½®"></a>1. Chronyd å®‰è£…ä¸é…ç½®</h2><h3 id="å®‰è£…-Chronyd"><a href="#å®‰è£…-Chronyd" class="headerlink" title="å®‰è£… Chronyd"></a>å®‰è£… Chronyd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install chronyd -y</span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥æ—¶é—´åŒæ­¥æº"><a href="#æ£€æŸ¥æ—¶é—´åŒæ­¥æº" class="headerlink" title="æ£€æŸ¥æ—¶é—´åŒæ­¥æº"></a>æ£€æŸ¥æ—¶é—´åŒæ­¥æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chronyc sources -v</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯-Chronyd-æœåŠ¡çŠ¶æ€"><a href="#éªŒè¯-Chronyd-æœåŠ¡çŠ¶æ€" class="headerlink" title="éªŒè¯ Chronyd æœåŠ¡çŠ¶æ€"></a>éªŒè¯ Chronyd æœåŠ¡çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nlap | grep 123  <span class="comment"># æŸ¥çœ‹ UDP ç«¯å£ï¼Œç¡®è®¤ chronyd å·²å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®"><a href="#2-ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®" class="headerlink" title="2. ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®"></a>2. ç«¯å£æ£€æŸ¥ä¸é˜²ç«å¢™é…ç½®</h2><h3 id="æ£€æŸ¥-UDP-ç«¯å£è¿é€šæ€§"><a href="#æ£€æŸ¥-UDP-ç«¯å£è¿é€šæ€§" class="headerlink" title="æ£€æŸ¥ UDP ç«¯å£è¿é€šæ€§"></a>æ£€æŸ¥ UDP ç«¯å£è¿é€šæ€§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ¡ˆ1ï¼šä½¿ç”¨ nmap</span></span><br><span class="line">nmap -sU 192.168.70.2 -p 123 -Pn</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ¡ˆ2ï¼šä½¿ç”¨ netcat</span></span><br><span class="line">nc -uvz 192.168.70.2 123</span><br></pre></td></tr></table></figure>

<h3 id="ç«¯å£çŠ¶æ€è¯´æ˜"><a href="#ç«¯å£çŠ¶æ€è¯´æ˜" class="headerlink" title="ç«¯å£çŠ¶æ€è¯´æ˜"></a>ç«¯å£çŠ¶æ€è¯´æ˜</h3><ul>
<li><strong>æ­£å¸¸çŠ¶æ€</strong>: <code>123/udp open ntp</code></li>
<li><strong>å¼‚å¸¸çŠ¶æ€</strong>: <code>123/udp open|filtered ntp</code> (è¡¨ç¤ºç«¯å£ä¸å¯ç”¨)</li>
</ul>
<h3 id="é…ç½®é˜²ç«å¢™è§„åˆ™-UFW-ç¤ºä¾‹"><a href="#é…ç½®é˜²ç«å¢™è§„åˆ™-UFW-ç¤ºä¾‹" class="headerlink" title="é…ç½®é˜²ç«å¢™è§„åˆ™ (UFW ç¤ºä¾‹)"></a>é…ç½®é˜²ç«å¢™è§„åˆ™ (UFW ç¤ºä¾‹)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é˜²ç«å¢™è§„åˆ™</span></span><br><span class="line">ufw status</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æ”¾ NTP æœåŠ¡æ‰€éœ€ç«¯å£</span></span><br><span class="line">ufw allow 123/udp</span><br><span class="line">ufw allow 323/udp</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­"><a href="#3-æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­" class="headerlink" title="3. æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­"></a>3. æ—¶é—´åŒæ­¥çŠ¶æ€è¯Šæ–­</h2><h3 id="å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹"><a href="#å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹" class="headerlink" title="å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹"></a>å¼‚å¸¸çŠ¶æ€ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ chrony æœåŠ¡çŠ¶æ€</span></span><br><span class="line">chronyc sources</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^? 192.168.70.2                  0   9     0     -     +0ns[   +0ns] +/-    0ns</span><br></pre></td></tr></table></figure>

<h3 id="æ­£å¸¸çŠ¶æ€ç¤ºä¾‹"><a href="#æ­£å¸¸çŠ¶æ€ç¤ºä¾‹" class="headerlink" title="æ­£å¸¸çŠ¶æ€ç¤ºä¾‹"></a>æ­£å¸¸çŠ¶æ€ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^* 192.168.70.2                 10   6    17     1    -12us[+23us] +/- 276us</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#4-ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>4. ç¡¬ä»¶æ—¶é’Ÿé—®é¢˜è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€"><a href="#æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€" class="headerlink" title="æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€"></a>æ£€æŸ¥å½“å‰æ—¶é—´çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span>                    <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --show          <span class="comment"># æŸ¥çœ‹ç¡¬ä»¶æ—¶é’Ÿæ—¶é—´</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ"><a href="#ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ" class="headerlink" title="ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ"></a>ç¡¬ä»¶æ—¶é’ŸåŒæ­¥æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿæ—¶é—´</span></span><br><span class="line">hwclock --<span class="built_in">set</span> --<span class="built_in">date</span> <span class="string">&#x27;2018-08-20 14:05:25&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ­¥ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --hctosys       <span class="comment"># ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">hwclock --systohc       <span class="comment"># ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ—¶é’Ÿè®¾ç½®</span></span><br><span class="line">clock -w</span><br></pre></td></tr></table></figure>

<h3 id="é«˜çº§æ—¶é—´ç®¡ç†"><a href="#é«˜çº§æ—¶é—´ç®¡ç†" class="headerlink" title="é«˜çº§æ—¶é—´ç®¡ç†"></a>é«˜çº§æ—¶é—´ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€</span></span><br><span class="line">chronyc sourcestats -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³æ‰‹åŠ¨åŒæ­¥æ—¶é—´ï¼ˆé€‚ç”¨äºæ—¶é—´åå·®è¾ƒå¤§æ—¶ï¼‰</span></span><br><span class="line">chronyc -a makestep</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¡å‡†æ—¶é—´æœåŠ¡å™¨</span></span><br><span class="line">chronyc tracking</span><br></pre></td></tr></table></figure>

<h3 id="ç¡¬ä»¶æ—¶é’Ÿé…ç½®"><a href="#ç¡¬ä»¶æ—¶é’Ÿé…ç½®" class="headerlink" title="ç¡¬ä»¶æ—¶é’Ÿé…ç½®"></a>ç¡¬ä»¶æ—¶é’Ÿé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ç¡¬ä»¶æ—¶é’Ÿé…ç½®</span></span><br><span class="line">timedatectl | grep <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨æœ¬åœ°æ—¶åŒº</span></span><br><span class="line">timedatectl set-local-rtc 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨ UTCï¼ˆæ¨èï¼‰</span></span><br><span class="line">timedatectl set-local-rtc 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ NTP æ—¶é—´åŒæ­¥</span></span><br><span class="line">timedatectl set-ntp <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-æ—¶åŒºé…ç½®"><a href="#5-æ—¶åŒºé…ç½®" class="headerlink" title="5. æ—¶åŒºé…ç½®"></a>5. æ—¶åŒºé…ç½®</h2><h3 id="æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä»-EST-æ”¹ä¸º-CSTï¼‰"><a href="#æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä»-EST-æ”¹ä¸º-CSTï¼‰" class="headerlink" title="æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä» EST æ”¹ä¸º CSTï¼‰"></a>æ›´æ”¹æ—¶åŒºï¼ˆä¾‹å¦‚ä» EST æ”¹ä¸º CSTï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½åŸæ—¶åŒºé…ç½®</span></span><br><span class="line"><span class="built_in">mv</span> /etc/localtime /etc/localtime.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸Šæµ·æ—¶åŒºï¼ˆä¸­å›½æ ‡å‡†æ—¶é—´ CSTï¼‰</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ•…éšœæ’é™¤æµç¨‹å›¾"><a href="#æ•…éšœæ’é™¤æµç¨‹å›¾" class="headerlink" title="æ•…éšœæ’é™¤æµç¨‹å›¾"></a>æ•…éšœæ’é™¤æµç¨‹å›¾</h2><ol>
<li><strong>æ—¶é—´ä¸åŒæ­¥</strong><ul>
<li>æ£€æŸ¥ <code>chronyc sources</code> è¾“å‡º</li>
<li>éªŒè¯ NTP ç«¯å£è¿é€šæ€§</li>
<li>ç¡®è®¤é˜²ç«å¢™é…ç½®</li>
</ul>
</li>
<li><strong>ç¡¬ä»¶æ—¶é’Ÿä¸ç³»ç»Ÿæ—¶é—´ä¸ä¸€è‡´</strong><ul>
<li>ä½¿ç”¨ <code>hwclock --hctosys</code> æˆ– <code>hwclock --systohc</code> åŒæ­¥</li>
<li>æ£€æŸ¥æ—¶åŒºè®¾ç½®æ˜¯å¦æ­£ç¡®</li>
</ul>
</li>
<li><strong>æ—¶åŒºé”™è¯¯</strong><ul>
<li>ä½¿ç”¨ <code>timedatectl</code> æ£€æŸ¥å½“å‰æ—¶åŒº</li>
<li>é‡æ–°é“¾æ¥æ­£ç¡®çš„æ—¶åŒºæ–‡ä»¶</li>
</ul>
</li>
</ol>
<hr>
<h2 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨"><a href="#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨" class="headerlink" title="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨"></a>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</h2><table>
<thead>
<tr>
<th align="left">å‘½ä»¤</th>
<th align="left">åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>chronyc sources</code></td>
<td align="left">æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€</td>
</tr>
<tr>
<td align="left"><code>chronyc -a makestep</code></td>
<td align="left">ç«‹å³å¼ºåˆ¶æ—¶é—´åŒæ­¥</td>
</tr>
<tr>
<td align="left"><code>hwclock --hctosys</code></td>
<td align="left">ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´</td>
</tr>
<tr>
<td align="left"><code>hwclock --systohc</code></td>
<td align="left">ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</td>
</tr>
<tr>
<td align="left"><code>timedatectl set-local-rtc 1</code></td>
<td align="left">è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿä½¿ç”¨æœ¬åœ°æ—¶åŒº</td>
</tr>
<tr>
<td align="left"><code>timedatectl set-ntp yes</code></td>
<td align="left">å¯ç”¨ NTP æ—¶é—´åŒæ­¥</td>
</tr>
</tbody></table>
<hr>
<p><strong>é€‚ç”¨ç³»ç»Ÿ</strong>: CentOS&#x2F;RHEL 7+ã€Ubuntu 16.04+</p>
<blockquote>
<p>æç¤ºï¼šç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®å°†ç¡¬ä»¶æ—¶é’Ÿè®¾ç½®ä¸º UTC (<code>timedatectl set-local-rtc 0</code>)ï¼Œå¹¶ç¡®ä¿é˜²ç«å¢™æ­£ç¡®é…ç½®å…è®¸ NTP æµé‡ã€‚</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/07/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8702/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/07/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8702/" class="post-title-link" itemprop="url">å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡02</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-07 09:54:09 / ä¿®æ”¹æ—¶é—´ï¼š11:07:59" itemprop="dateCreated datePublished" datetime="2025-09-07T09:54:09+08:00">2025-09-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">å®¹å™¨åŒ–</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>èƒŒæ™¯ï¼šé¡¹ç›®ä¸Šéœ€è¦å°†æœåŠ¡çš„æ—¥å¿—éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯¹äºæœ‰ä¸¤ç±»æ—¥å¿—æ–‡ä»¶ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—å‡ºæ¥çš„ã€‚<br>æƒ…å†µ1ï¼šä¸šåŠ¡æœåŠ¡ä¸­æœªå°†æœåŠ¡æ—¥å¿—æ‰“å°åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒæŸ¥çœ‹å®¹å™¨æ‰€åœ¨èŠ‚ç‚¹æœ‰æŸ¥çœ‹åˆ°0.log ç±»ä¼¼çš„æ—¥å¿—ï¼Œéœ€è¦ç¡®è®¤è¯¥æ—¥å¿—æ˜¯å¦å°±æ˜¯æœåŠ¡çš„è¿è¡Œæ—¥å¿—ï¼Œç›®å‰é’ˆå¯¹è¯¥ç§æ—¥å¿—äº§ç”Ÿçš„è¿‡ç¨‹æµç¨‹æ¢³ç†</p>
<p>å®¹å™¨çš„æ ‡å‡†è¾“å‡º<br>&#x2F;var&#x2F;log&#x2F;pods&#x2F;â€¦&#x2F;0.log æ–‡ä»¶çš„äº§ç”Ÿè¿‡ç¨‹æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">App è¾“å‡º -&gt; stdout/stderr</span><br><span class="line"></span><br><span class="line">è¿è¡Œæ—¶æ•è· -&gt; å®¹å™¨è¿è¡Œæ—¶ï¼ˆDocker/containerdï¼‰å°†å…¶å†™å…¥è‡ªå·±çš„ JSON æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">kubelet ç»„ç»‡ -&gt; kubelet åˆ›å»ºæ¸…æ™°çš„ç›®å½•ç»“æ„ï¼Œå¹¶é€šè¿‡ç¬¦å·é“¾æ¥æŒ‡å‘å®¹å™¨è¿è¡Œæ—¶çš„åŸå§‹æ—¥å¿—æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹å¤–æ¥å£ -&gt; è¿™ä¸ªè·¯å¾„æˆä¸ºäº†è¯¥å®¹å™¨æ—¥å¿—åœ¨èŠ‚ç‚¹ä¸Šçš„æ ‡å‡†åŒ–ã€ç¨³å®šçš„è®¿é—®ç‚¹ã€‚æ— è®ºæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ã€æ—¥å¿—é‡‡é›†ä»£ç†ï¼ˆå¦‚ Filebeatã€Fluentdï¼‰ï¼Œè¿˜æ˜¯ kubectl logs å‘½ä»¤ï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡è¯»å–è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶æ¥è·å–æ—¥å¿—å†…å®¹çš„ã€‚</span><br><span class="line"></span><br><span class="line">kubectl logs å‘½ä»¤çš„å·¥ä½œåŸç†å°±æ˜¯ï¼šapiserver -&gt; å¯¹åº”èŠ‚ç‚¹çš„ kubelet -&gt; kubelet è¯»å– /var/log/pods/.../0.<span class="built_in">log</span> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè§£æ JSON æ ¼å¼ï¼Œåªæå– <span class="built_in">log</span> å­—æ®µçš„çº¯æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åæµå¼ä¼ è¾“å›ç»™è¯·æ±‚è€…ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="å…³ç³»ä¸åŒºåˆ«"><a href="#å…³ç³»ä¸åŒºåˆ«" class="headerlink" title="å…³ç³»ä¸åŒºåˆ«"></a>å…³ç³»ä¸åŒºåˆ«</h3><table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left"><code>/var/log/pods/.../0.log</code> (æºæ–‡ä»¶:ç±»æ¯”æ•°æ®åº“åŸå§‹è¡¨)</th>
<th align="left"><code>kubectl logs</code> (è§£æåçš„è§†å›¾:ç±»æ¯”æ‰§è¡ŒSQLåçš„è§†å›¾)</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å†…å®¹</strong></td>
<td align="left"><strong>åŸå§‹ã€å®Œæ•´</strong>çš„æ•°æ®</td>
<td align="left"><strong>è§£æåã€ç­›é€‰è¿‡</strong>çš„å†…å®¹</td>
</tr>
<tr>
<td align="left"><strong>æ ¼å¼</strong></td>
<td align="left"><strong>JSONæ ¼å¼</strong>ï¼Œæ¯è¡Œä¸€æ¡å®Œæ•´çš„JSONè®°å½•</td>
<td align="left"><strong>çº¯æ–‡æœ¬</strong>ï¼Œåªæå–äº†JSONä¸­çš„æ—¥å¿—æ¶ˆæ¯æœ¬èº«</td>
</tr>
<tr>
<td align="left"><strong>å…ƒæ•°æ®</strong></td>
<td align="left"><strong>åŒ…å«ä¸°å¯Œå…ƒæ•°æ®</strong>ï¼Œå¦‚å®Œæ•´çš„æ—¶é—´æˆ³ã€æµç±»å‹ï¼ˆstdout&#x2F;stderrï¼‰</td>
<td align="left"><strong>ä¸åŒ…å«</strong>JSONä¸­çš„å…ƒæ•°æ®ï¼Œä½†å¯èƒ½ä¼šæ ¼å¼åŒ–è¾“å‡ºæ—¶é—´æˆ³ï¼ˆéœ€åŠ  <code>--timestamps</code>ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>è®¿é—®æ–¹å¼</strong></td>
<td align="left">ç›´æ¥ç™»å½•åˆ°èŠ‚ç‚¹æœåŠ¡å™¨æŸ¥çœ‹æ–‡ä»¶</td>
<td align="left">é€šè¿‡Kubernetes API Serverè¿œç¨‹æŸ¥è¯¢</td>
</tr>
<tr>
<td align="left"><strong>ä¸»è¦ä½¿ç”¨è€…</strong></td>
<td align="left">ç³»ç»Ÿã€æ—¥å¿—é‡‡é›†ä»£ç†ï¼ˆå¦‚Fluentd, Filebeatï¼‰</td>
<td align="left"><strong>å¼€å‘è€…ã€è¿ç»´äººå‘˜</strong></td>
</tr>
</tbody></table>
<p>æƒ…å†µ2ï¼šä¸šåŠ¡æœåŠ¡ä¸­æ—¥å¿—æ‰“å°æ˜¾ç¤ºæ˜¯éœ€è¦æ—¥å¿—æ–‡ä»¶çš„æŒ‚è½½ï¼Œç›®å‰æŒ‚è½½æ–‡ä»¶æ—¥å¿—æ˜¾ç¤ºå¦‚ä¸‹ã€‚mountPath: &#x2F;root&#x2F;app (æœåŠ¡å¯åŠ¨jaråœ¨æ”¹ç›®å½•) åˆ™ä¼šæŒ‚è½½å¤±è´¥ã€‚åŸå› :å…±äº«å·ä¼šæŠŠå…¶ä»–é•œåƒå†…ç½®çš„æ–‡ä»¶æ¸…ç©ºçš„ã€‚æ‰€ä»¥ä½¿ç”¨è¯¥ç§æ–¹å¼æœ€å¥½ç»Ÿä¸€æ”¾åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ˜¯è¯¥ç§æƒ…å†µçš„æœ€ä½³å®è·µ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/root/app/log</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">test-log-l9ynkeyd-1</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">name:</span> <span class="string">test-log-l9ynkeyd-1</span></span><br></pre></td></tr></table></figure>

<h3 id="å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼"><a href="#å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼" class="headerlink" title="å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼:"></a>å­˜å‚¨ç±»å‹æ€»ç»“å¯¹æ¯”è¡¨æ ¼:</h3><table>
<thead>
<tr>
<th align="left">å­˜å‚¨ç±»å‹</th>
<th align="left">æ¦‚å¿µç†è§£</th>
<th align="left">ç”Ÿå‘½å‘¨æœŸ</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>emptyDir</strong></td>
<td align="left">ä¸´æ—¶å­˜å‚¨ï¼Œä¼šåœ¨èŠ‚ç‚¹åˆ›å»ºç©ºç›®å½•</td>
<td align="left">ç”Ÿå‘½å‘¨æœŸ&#x3D;pod</td>
</tr>
<tr>
<td align="left"><strong>hostPath</strong></td>
<td align="left">å…è®¸æŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶åˆ°pod</td>
<td align="left">ç”Ÿå‘½å‘¨æœŸ&#x3D;å®¿ä¸»æœº</td>
</tr>
<tr>
<td align="left"><strong>PVC&#x2F;PV</strong></td>
<td align="left">Kubernetesä¸­æŒä¹…å­˜å‚¨çš„æŠ½è±¡ï¼Œç”¨æˆ·é€šè¿‡å£°æ˜PVCè¯·æ±‚å­˜å‚¨èµ„æºï¼Œè€ŒPVCä¼šç»‘å®šåˆ°æ»¡è¶³å…¶éœ€æ±‚çš„PV</td>
<td align="left">æŒä¹…å­˜å‚¨</td>
</tr>
<tr>
<td align="left"><strong>StorageClass</strong></td>
<td align="left">å¤šä¸ªStorageClassï¼Œç”¨æˆ·åœ¨åˆ›å»ºPVCæ—¶æŒ‡å®šStorageClassåç§°ï¼Œä»¥åŠ¨æ€ç”³è¯·å­˜å‚¨èµ„æºã€‚</td>
<td align="left">æŒä¹…å­˜å‚¨</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1650296">è¯¦ç»†åœºæ™¯è¯´æ˜</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/06/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8701/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/06/%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%E7%AF%8701/" class="post-title-link" itemprop="url">å®¹å™¨åŒ–ä¹‹ç»†èŠ‚é—®é¢˜å¤„ç†ç¯‡01</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-06 19:18:23" itemprop="dateCreated datePublished" datetime="2025-09-06T19:18:23+08:00">2025-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-12 09:50:42" itemprop="dateModified" datetime="2025-09-12T09:50:42+08:00">2025-09-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">å®¹å™¨åŒ–</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>é—®é¢˜ç°è±¡ï¼š<br>å®¹å™¨1ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PID 1ï¼š Javaè¿›ç¨‹</span><br></pre></td></tr></table></figure>

<p>å®¹å™¨2ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PID 1: /sbin/tini -- ./entrypoint.sh</span><br><span class="line">PID 6: Javaè¿›ç¨‹</span><br></pre></td></tr></table></figure>

<p>å…³é”®åŒºåˆ«åœ¨äºï¼šç¬¬äºŒä¸ªå®¹å™¨çš„entrypoint.shè„šæœ¬å¯èƒ½æ˜¯é€šè¿‡tiniå¯åŠ¨çš„ã€‚è€Œç¬¬ä¸€ä¸ªå®¹å™¨å¯èƒ½æ˜¯ç›´æ¥ä»¥entrypoint.shä½œä¸ºå…¥å£ç‚¹ï¼Œæ²¡æœ‰ä½¿ç”¨tiniï¼Œæ‰€ä»¥åœ¨execæ‰§è¡ŒåJavaè¿›ç¨‹æ›¿æ¢äº†shellè¿›ç¨‹æˆä¸ºPID 1ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a --no-trunc |grep xxx <span class="comment">#æŸ¥çœ‹docker å¯åŠ¨å‘½ä»¤è¿›è¡Œç¡®è®¤,ä½¿ç”¨docker runæ—¶æŒ‡å®šäº†initç¨‹åºä¸ºtiniã€‚</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºåœ¨Dockerfileä¸­å¯èƒ½ä½¿ç”¨äº†ç±»ä¼¼ä»¥ä¸‹çš„æŒ‡ä»¤ï¼š<br>ENTRYPOINT [â€œ&#x2F;sbin&#x2F;tiniâ€, â€œâ€“â€, â€œ.&#x2F;entrypoint.shâ€]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> entrypoint.sh </span><br><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The application will start in <span class="variable">$&#123;APP_SLEEP&#125;</span>s...&quot;</span> &amp;&amp; <span class="built_in">sleep</span> <span class="variable">$&#123;APP_SLEEP&#125;</span></span><br><span class="line"><span class="built_in">exec</span> /usr/bin/java -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap <span class="variable">$&#123;JAVA_OPTS&#125;</span> \</span><br><span class="line">     	-Djava.security.egd=file:/dev/./urandom \</span><br><span class="line">      -Dtsf.swagger.enabled=<span class="literal">false</span> \</span><br><span class="line">     	-jar /root/app/element-server2*.jar <span class="variable">$&#123;RUN_ARGS&#125;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>


<p><strong>tini çš„ä½œç”¨</strong></p>
<ul>
<li><p>1.tini æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œä¸“é—¨ä¸ºå®¹å™¨è®¾è®¡</p>
</li>
<li><p>1.å¯ä»¥ç¡®ä¿å®ƒèƒ½æ­£ç¡®æ¥æ”¶ Docker åœæ­¢å‘½ä»¤å‘é€çš„ä¿¡å·</p>
</li>
<li><p>2.å®ƒä½œä¸º PID 1 è¿è¡Œï¼Œè´Ÿè´£ç®¡ç†å­è¿›ç¨‹ï¼ˆè¿™é‡Œæ˜¯ entrypoint.shï¼‰</p>
</li>
<li><p>3.entrypoint.sh è„šæœ¬ä»ç„¶ä½¿ç”¨ exec å¯åŠ¨ Javaï¼Œä½†æ­¤æ—¶ï¼š</p>
<p>  exec æ›¿æ¢çš„æ˜¯ entrypoint.sh è¿›ç¨‹ï¼ˆPID 6ï¼‰ï¼Œè€Œä¸æ˜¯ PID 1</p>
<p>  tini ä¿æŒä¸º PID 1ï¼ŒJava è¿›ç¨‹ä½œä¸ºå…¶å­è¿›ç¨‹è¿è¡Œ</p>
</li>
</ul>
<h2 id="ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ"><a href="#ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ" class="headerlink" title="ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ"></a>ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒ</h2><table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left">ç›´æ¥ exec (æ—  tini)</th>
<th align="left">ä½¿ç”¨ tini</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PID 1 è¿›ç¨‹</td>
<td align="left">Java åº”ç”¨</td>
<td align="left">tini</td>
</tr>
<tr>
<td align="left">ä¿¡å·å¤„ç†</td>
<td align="left">åº”ç”¨éœ€è‡ªè¡Œå¤„ç†</td>
<td align="left">tini ååŠ©å¤„ç†</td>
</tr>
<tr>
<td align="left">åƒµå°¸è¿›ç¨‹å›æ”¶</td>
<td align="left">å¯èƒ½å­˜åœ¨é—®é¢˜</td>
<td align="left">è‡ªåŠ¨å›æ”¶</td>
</tr>
<tr>
<td align="left">è¿›ç¨‹æ ‘ç»“æ„</td>
<td align="left">æ›´ç®€å•</td>
<td align="left">ç¨å¤æ‚ä½†æ›´å¥å£®</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/06/shell%E4%B9%8B%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84cpu%E4%B8%8E%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/06/shell%E4%B9%8B%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84cpu%E4%B8%8E%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87/" class="post-title-link" itemprop="url">shellä¹‹è·å–dockerå®¹å™¨ä¸­çš„cpuä¸å†…å­˜ä½¿ç”¨ç‡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-06 16:50:28" itemprop="dateCreated datePublished" datetime="2025-09-06T16:50:28+08:00">2025-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-07 11:09:35" itemprop="dateModified" datetime="2025-09-07T11:09:35+08:00">2025-09-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">å·¥å…·</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>èƒŒæ™¯ï¼šè¯¥é¡¹ç›®è¿ç§»è‡³æ–°ç¯å¢ƒéœ€æ±‚ï¼Œå°†åŸå…ˆTSFé›†ç¾¤ï¼ˆèŠ‚ç‚¹æ•°ï¼šxxxï¼‰è¿ç§»åˆ°æ–°ç¯å¢ƒä¸­ï¼Œjmeter å‹æµ‹ä¸€ä¸ªæŸ¥è¯¢æ¥å£çš„æ•°æ®ã€‚åˆ†åˆ«åœ¨æ—§ç¯å¢ƒä¸æ–°ç¯å¢ƒçš„æ¥å£æ•°æ®è¿›è¡Œå‹æµ‹ï¼Œå¯¹æ¯”ç›‘æ§CPUã€å†…å­˜åˆ©ç”¨ç‡æƒ…å†µã€‚ç›®å‰æ—§ç¯å¢ƒå®¹å™¨æ— ç›‘æ§ï¼Œæ•…æ€è·¯ä¸Šä½¿ç”¨è„šæœ¬æ¥è·å–ç›‘æ§æ•°æ®ï¼Œè·å–çš„æ•°æ®ç”¨å›¾æ ‡å±•ç¤ºå‡ºæ¥ã€‚åº•å±‚çš„k8sæ¯”è¾ƒè€ï¼Œæš‚æœªæ”¯æŒkubectl  top  å®¹å™¨ã€‚</p>
<p>é—®é¢˜:ä¸ºä»€ä¹ˆä¸è¿›å…¥å®¹å™¨ä¸­æŸ¥çœ‹ï¼ŒtopæŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨é‡ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å®¹å™¨ä¸­è¿è¡Œ top å‘½ä»¤ï¼Œè™½ç„¶å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æ¯ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ï¼Œä½†æ˜¯ top ä¸­â€%Cpu(s)â€é‚£ä¸€è¡Œä¸­æ˜¾ç¤ºçš„æ•°å€¼ï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªå®¹å™¨çš„ CPU æ•´ä½“ä½¿ç”¨ç‡ï¼Œè€Œæ˜¯å®¹å™¨å®¿ä¸»æœºçš„ CPU ä½¿ç”¨ç‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">HOST_NAME=$(hostname -I | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/docker_stats_20250719_<span class="variable">$HOST_NAME</span>.log&quot;</span></span><br><span class="line">DOCKER_NAME=$(docker ps |grep  <span class="string">&quot;tsf_1/element-server&quot;</span> |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">INTERVAL=5 <span class="comment"># æ”¶é›†é—´éš”ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¹¶æ·»åŠ è¡¨å¤´</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ—¶é—´æˆ³,å®¹å™¨ID,CPUä½¿ç”¨ç‡%,å†…å­˜ä½¿ç”¨ç‡%&quot;</span> &gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">    TIMESTAMP=$(<span class="built_in">date</span> <span class="string">&#x27;+%H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ top æ”¶é›† CPU ä½¿ç”¨ç‡ï¼ˆæå– %Cpu(s): åçš„æ•°å€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line">    CPU_MEM_USAGE=$(docker stats <span class="variable">$DOCKER_NAME</span> --no-stream --format <span class="string">&quot;&#123;&#123;.Container&#125;&#125;,\t&#123;&#123;.CPUPerc&#125;&#125;,\t\t&#123;&#123;.MemPerc&#125;&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$CPU_MEM_USAGE</span></span><br><span class="line">    <span class="comment">#top -bn1 | grep &#x27;%Cpu&#x27; | awk &#x27;&#123;print &quot;CPUä½¿ç”¨ç‡: &quot; 100 - $8 &quot;%&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$TIMESTAMP</span>ï¼Œ <span class="variable">$CPU_MEM_USAGE</span> &quot;</span>  &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="comment"># ç­‰å¾…ä¸‹ä¸€æ¬¡æ”¶é›†</span></span><br><span class="line">    <span class="built_in">sleep</span> <span class="variable">$INTERVAL</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€ååˆ¶ä½œå‡ºæ¥çš„å›¾æ ‡å¦‚ä¸‹ï¼š</p>
<p><img src="/2025/09/06/shell%E4%B9%8B%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84cpu%E4%B8%8E%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87/image-20250906170446394.png" alt="image-20250906170446394"></p>
<p>å…³äºå¾—åˆ°çš„æ•°æ®çš„ç–‘é—®çš„è®°å½•</p>
<p>ä»å›¾æ ‡ä¸Šå¯ä»¥å¾—å‡ºæœ‰çš„CPUè¶…100%äº†ï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ­£å¸¸æ¥çœ‹è¿™ä¸ªCPUåº”è¯¥æ˜¯å¤šå°‘çš„</p>
<ol>
<li>ç»å¯¹èµ„æºæ¶ˆè€—é‡</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">307% = 3.07 ä¸ªé€»è¾‘ CPU æ ¸å¿ƒæ»¡è½½</span><br><span class="line"><span class="comment">#è¡¨ç¤ºå®¹å™¨å½“å‰æ¯ç§’æ¶ˆè€— 3.07 æ ¸å¿ƒç§’çš„è®¡ç®—èµ„</span></span><br><span class="line"><span class="comment">#ç›¸å½“äºï¼š 3 ä¸ªæ ¸å¿ƒ 100% æ»¡è½½ + ç¬¬ 4 ä¸ªæ ¸å¿ƒ 7% è´Ÿè½½ æˆ– 4 ä¸ªæ ¸å¿ƒå¹³å‡ 76.75% è´Ÿè½½</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>docker stats ä¸­æŸ¥çœ‹ ä»¥ä¸‹å‚æ•° docker æœ‰å…³cpué…ç½®çš„åŒºåˆ«ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@x.x.x.x ~]# docker inspect 1f77b1a2b98e |grep -i cpu</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 4096, <span class="comment">#cpu requestçš„å€¼</span></span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 100000,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 400000, <span class="comment">#cpu limitçš„å€¼</span></span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;9-12&quot;</span>, <span class="comment">#è¿è¡Œåœ¨å“ªä¸ªcpuä¸Š</span></span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BD%91%E5%8D%A1%E4%BF%AE%E6%94%B9%E5%8F%8Anmcli-%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BD%91%E5%8D%A1%E4%BF%AE%E6%94%B9%E5%8F%8Anmcli-%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡ç½‘å¡ä¿®æ”¹åŠnmcli ä½¿ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-06 13:47:42" itemprop="dateCreated datePublished" datetime="2025-09-06T13:47:42+08:00">2025-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-12 13:35:54" itemprop="dateModified" datetime="2025-09-12T13:35:54+08:00">2025-09-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å› éœ€è¦ä¿®æ”¹ç³»ç»Ÿå‚æ•°ç½‘å¡é˜Ÿåˆ—ï¼Œéœ€è¦å°†å…¶æœºå™¨éœ€è¦é‡å¯ã€‚ç›®å‰å‘ç°é›†ç¾¤ä¸€å…±100å¤šå°æœºå™¨ï¼Œé‡å¯å…¶ä¸­ä¸€å°masteræœºå™¨åï¼Œä¸€ç›´å¤„äºnotReadyçŠ¶æ€ã€‚<br>åŸå› æ˜¯å› ä¸ºæ”¹æœºå™¨ä¸ºåŒç½‘å¡ï¼Œä½†æ˜¯å› ä¸ºç½‘å¡åæœªå›ºå®šã€‚é€ æˆä½¿ç”¨ä¸ºå›ºå®šçš„ç½‘å¡æœªå¯åŠ¨æˆåŠŸã€‚</p>
<p>è§£å†³æ€è·¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. æŸ¥è¯¢100å¤šå°æœºå™¨ï¼Œ/etc/udev/rules.d/70-persistent-net.rules  æ–‡ä»¶æ˜¯å¦éƒ½å«2æ¡è®°å½•</span><br><span class="line"></span><br><span class="line">2.é’ˆå¯¹æœªå«çš„èŠ‚ç‚¹æ“ä½œï¼Œæ·»åŠ è¯¥æ¡ä¿¡æ¯ï¼Œç½‘å¡åä¸å¯ä¿®æ”¹ï¼Œè¦ä¸åŸå…ˆé‡å¯å‰ä¸€è‡´ã€‚æ·»åŠ åå¦‚ä¸‹ï¼š</span><br><span class="line">SUBSYSTEM==<span class="string">&quot;net&quot;</span>, ACTION==<span class="string">&quot;add&quot;</span>, DRIVERS==<span class="string">&quot;?*&quot;</span>, ATTR&#123;address&#125;==<span class="string">&quot;fa:16:3e:98:70:9c&quot;</span>, NAME=<span class="string">&quot;ens3&quot;</span></span><br><span class="line">SUBSYSTEM==<span class="string">&quot;net&quot;</span>, ACTION==<span class="string">&quot;add&quot;</span>, DRIVERS==<span class="string">&quot;?*&quot;</span>, ATTR&#123;address&#125;==<span class="string">&quot;fa:16:3e:f5:e0:f1&quot;</span>, NAME=<span class="string">&quot;ens10&quot;</span> <span class="comment">#æ›´æ–°çš„ç›®æ ‡ç½‘å¡å</span></span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼š<br>å› åŠ çš„ç½‘å¡åå˜æ›´ä¸ºens4ï¼Œé€ æˆç½‘å¡ä¸€ç›´upä¸èµ·æ¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tcs-10-25-83-48 network-scripts]# nmcli  device conn ens4</span><br><span class="line">é”™è¯¯ï¼šæ·»åŠ /æ¿€æ´»æ–°è¿æ¥å¤±è´¥ï¼šConnection <span class="string">&#x27;ens4&#x27;</span> is not available on device ens4 because device is strictly unmanaged</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="nmcliå¤„ç†è¿‡ç¨‹ï¼š"><a href="#nmcliå¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="nmcliå¤„ç†è¿‡ç¨‹ï¼š"></a>nmcliå¤„ç†è¿‡ç¨‹ï¼š</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">show</span>  <span class="comment">#æŸ¥çœ‹è®¾å¤‡è¿æ¥æƒ…å†µ</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">show</span> <span class="string">&quot;System ens4&quot;</span> <span class="comment">#æŸ¥çœ‹ç½‘å¡è®¾ç½®çš„è¯¦æƒ…</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">reload</span> <span class="comment">#é‡å¯è®¾å¤‡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">conn</span> <span class="string">up</span> <span class="string">ens4</span> <span class="comment">#è¿æ¥ens4è®¾ç½®</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">set</span> <span class="string">&lt;ç½‘å¡åç§°&gt;</span> <span class="string">managed</span> <span class="literal">yes</span> <span class="comment">#æ¿€æ´»ç½‘å¡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="comment">#æŸ¥çœ‹æ‰€æœ‰çš„è®¾å¤‡</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">conn</span> <span class="comment">#å°†æ‰€æœ‰è®¾å¤‡conn</span></span><br><span class="line"><span class="string">nmcli</span> <span class="string">device</span> <span class="string">conn</span> <span class="string">ens4</span> <span class="comment">#ç½‘å¡è¿æ¥</span></span><br><span class="line"><span class="string">nmcli</span>  <span class="string">networking</span> <span class="comment">#æŸ¥çœ‹ç½‘ç»œæ˜¯ç”±è®¾ç½®</span></span><br></pre></td></tr></table></figure>

<p>åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@X-x.1-x.1-x.1-x.1 network-scripts]# <span class="built_in">cd</span> /etc/NetworkManager/conf.d/</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">ls</span></span><br><span class="line">99-cloud-init.conf  99-container.conf</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">cat</span> 99-cloud-init.conf </span><br><span class="line"><span class="comment"># Created by cloud-init on instance boot automatically, do not edit.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[main]</span><br><span class="line">dns = none</span><br><span class="line">[root@X-x.1-x.1-x.1-x.1 conf.d]# <span class="built_in">cat</span> 99-container.conf</span><br><span class="line"><span class="comment"># avoid making container interface down</span></span><br><span class="line">[keyfile]</span><br><span class="line">unmanaged-devices=*,except:interface-name:ens10,except:interface-name:ens3 </span><br><span class="line"><span class="comment">#99-container.confï¼Œå› å®¹å™¨å¹³å°éƒ¨ç½²å®Œåï¼Œç½‘å¡åè¢«è·å–åˆ°äº†å¹¶å†™å…¥åˆ°ç±»ä¼¼æ–‡ä»¶ä¸­ï¼Œæ•…ä¸å»ºè®®ä¿®æ”¹ç½‘å¡åç§°(å³NAME=&quot;ens10&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‹“å±•ï¼šè®°å½•ä¸€æ¬¡å› bondæ–‡ä»¶é…ç½®é—®é¢˜é€ æˆçš„äº¤æ¢æœºç½‘å£å…·æœ‰downçš„æƒ…å†µï¼Œæ²¡æœ‰nmcliå·¥å…·éœ€è¦é…ç½®ç½‘å¡é…ç½®bond4ï¼Œé…ç½®ä¿¡æ¯åŠå…¶å«ä¹‰ï¼Œè®°å½•æ­£å¸¸çš„é…ç½®ä¿¡æ¯åŠå¦‚ä½•å†æœºå™¨èŠ‚ç‚¹ä¸Šè¿›è¡Œæ’æŸ¥ç¡®è®¤ç½‘å£bondæ­£å¸¸</p>
<h4 id="ifcfg-eth0"><a href="#ifcfg-eth0" class="headerlink" title="ifcfg-eth0"></a>ifcfg-eth0</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#IP Config for eth0:</span></span><br><span class="line">DEVICE=<span class="string">&#x27;eth0&#x27;</span></span><br><span class="line">HWADDR=10:70:fd:aa:d9:72</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">SLAVE=<span class="built_in">yes</span>  <span class="comment"># ä¿®æ­£æ‹¼å†™é”™è¯¯</span></span><br><span class="line">MASTER=bond1</span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>

<h4 id="ifcfg-eth1"><a href="#ifcfg-eth1" class="headerlink" title="ifcfg-eth1"></a>ifcfg-eth1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#IP Config for eth1:</span></span><br><span class="line">DEVICE=<span class="string">&#x27;eth1&#x27;</span></span><br><span class="line">HWADDR=10:70:fd:aa:d9:73</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=<span class="built_in">yes</span></span><br><span class="line">USERCTL=no  <span class="comment"># ä¿®æ­£ä¸ºæœ‰æ•ˆå€¼</span></span><br><span class="line">BOOTPROTO=none</span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>

<h4 id="ifcfg-bond1"><a href="#ifcfg-bond1" class="headerlink" title="ifcfg-bond1"></a>ifcfg-bond1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#IP Config for bond1:</span></span><br><span class="line">DEVICE=bond1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=10.215.173.44</span><br><span class="line">NETMASK=255.255.255.128</span><br><span class="line">GATEWAY=10.215.173.1</span><br><span class="line">USERCTL=no</span><br><span class="line">ONBOOT=<span class="string">&#x27;yes&#x27;</span></span><br><span class="line">TYPE=Bond  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br><span class="line">BONDING_OPTS=<span class="string">&#x27;miimon=100 mode=4 ad_select=0 lacp_rate=fast updelay=200 xmit_hash_policy=2&#x27;</span>  <span class="comment"># ä¿®æ­£å‚æ•°</span></span><br><span class="line">NM_CONTROLLED=no  <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mode=4ï¼šè¡¨ç¤ºIEEE 802.3adåŠ¨æ€é“¾è·¯èšåˆï¼ˆLACPï¼‰</span></span><br><span class="line"><span class="comment">#miimon=100ï¼šæ¯100æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡é“¾è·¯çŠ¶æ€</span></span><br><span class="line"><span class="comment">#ad_select=1ï¼šé€‰æ‹©ç­–ç•¥ï¼Œ1è¡¨ç¤ºå¤‡ä»½æ¨¡å¼ï¼ˆä½†æ ¹æ®bondingæ–‡æ¡£ï¼Œad_selectçš„å¯èƒ½å€¼ä¸º0ã€1ã€2ï¼Œ1è¡¨ç¤ºâ€œå¤‡ä»½â€ä¼¼ä¹ä¸å¯¹ï¼Œé€šå¸¸ad_select=0ï¼ˆstableï¼‰æˆ–1ï¼ˆbandwidthï¼‰æˆ–2ï¼ˆcountï¼‰ï¼‰æ³¨æ„ï¼šad_select=1å®é™…ä¸Šè¡¨ç¤ºâ€œå¸¦å®½â€ï¼ˆbandwidthï¼‰ï¼Œå³é€‰æ‹©æ´»åŠ¨èšåˆç»„ä¸­å¸¦å®½æœ€å¤§çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="comment">#lacp_rate=fastï¼šLACPé€Ÿç‡ï¼Œfastè¡¨ç¤ºæ¯1ç§’å‘é€ä¸€æ¬¡LACPæŠ¥æ–‡ï¼ˆæ…¢é€Ÿä¸º30ç§’ï¼‰</span></span><br><span class="line"><span class="comment">#updelay=0ï¼šå¯ç”¨ç«¯å£çš„å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œä½†è¿™é‡Œè®¾ç½®äº†ä¸¤æ¬¡updelayï¼Œç¬¬ä¸€ä¸ªä¸º0ï¼Œç¬¬äºŒä¸ªä¸º200ï¼Œè¿™å¯èƒ½ä¼šè¢«æœ€åä¸€ä¸ªå€¼è¦†ç›–ã€‚å®é™…ä¸Šï¼Œåœ¨#BONDING_OPTSä¸­ï¼ŒåŒä¸€ä¸ªå‚æ•°å‡ºç°å¤šæ¬¡ï¼Œé€šå¸¸æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚æ‰€ä»¥updelay=200å¯èƒ½ä¼šè¦†ç›–å‰é¢çš„0ã€‚</span></span><br><span class="line"><span class="comment">#xmit_hash_policy=2ï¼šä¼ è¾“å“ˆå¸Œç­–ç•¥ï¼Œ2è¡¨ç¤ºä½¿ç”¨å±‚3+4ï¼ˆIPå’Œç«¯å£ï¼‰çš„å“ˆå¸Œã€‚</span></span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®é—®é¢˜åˆ†æ</strong></p>
<p> <strong>ifcfg-bond1 ä¸­çš„é—®é¢˜</strong></p>
<ul>
<li><strong>é‡å¤çš„ updelay å‚æ•°</strong>ï¼š<code>updelay=0</code> å’Œ <code>updelay=200</code> åŒæ—¶å­˜åœ¨,æœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯æœ€åä¸€ä¸ªï¼Œå³ updelay&#x3D;200ã€‚</li>
<li><strong>ad_select&#x3D;1</strong>ï¼šåœ¨æŸäº›ç³»ç»Ÿç‰ˆæœ¬ä¸­å¯èƒ½ä¸è¢«æ”¯æŒ</li>
</ul>
<p><strong>checké…ç½®å¥½åçš„çŠ¶æ€</strong></p>
<p>1.ping ç½‘å…³ </p>
<p>2.&#x2F;proc&#x2F;net&#x2F;bonding&#x2F;bond1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Bonding Mode: IEEE 802.3ad Dynamic <span class="built_in">link</span> aggregation - æ­£ç¡®ï¼Œæ¨¡å¼ä¸º4ã€‚</span><br><span class="line">MII Status: up - ç»‘å®šæ¥å£çŠ¶æ€æ­£å¸¸ã€‚</span><br><span class="line">Slave Interface: eth0 å’Œ eth1 éƒ½æ˜¯ upï¼Œé€Ÿåº¦å‡ä¸º 25000 Mbpsï¼Œå…¨åŒå·¥ï¼Œé“¾è·¯å¤±è´¥è®¡æ•°ä¸º0ï¼Œç‰©ç†åœ°å€æ­£ç¡®ã€‚</span><br><span class="line">Aggregator ID: ä¸¤ä¸ªæ¥å£çš„ Aggregator ID éƒ½æ˜¯ 1 - è¿™è¡¨ç¤ºä¸¤ä¸ªæ¥å£æˆåŠŸèšåˆåˆ°åŒä¸€ä¸ªèšåˆç»„ä¸­ã€‚</span><br><span class="line">Actor/Partner Churn State: å‡ä¸º noneï¼Œè¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿæ‰°åŠ¨ï¼Œè¿æ¥ç¨³å®šã€‚</span><br><span class="line">Partner Mac Address: ä¸¤ä¸ªæ¥å£çš„ Partner Mac Address éƒ½æ˜¯ 00:01:00:01:00:01ï¼Œè¿™è¡¨ç¤ºå®ƒä»¬è¿æ¥åˆ°åŒä¸€ä¸ªå¯¹ç«¯è®¾å¤‡ï¼ˆäº¤æ¢æœºï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>3.ä½¿ç”¨ <code>ethtool eth0</code> å’Œ <code>ethtool eth1</code> å†æ¬¡ç¡®è®¤é“¾è·¯çŠ¶æ€ä¸º <code>Link detected: yes</code> ä¸”é€Ÿç‡ä¸º 25000Mb&#x2F;sã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/06/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å¸…æ±‡">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æˆ‘çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/06/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-06 11:29:57" itemprop="dateCreated datePublished" datetime="2025-09-06T11:29:57+08:00">2025-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-12 09:23:38" itemprop="dateModified" datetime="2025-09-12T09:23:38+08:00">2025-09-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">æ‚ç¯‡</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼</p>
<p>ä¸€ä¸‹æ˜¯å¼€å¯æˆ‘åšå®¢çš„å¼€å§‹ä¹‹è·¯</p>
<h2 id="ä¸€ã€åˆ›å»º"><a href="#ä¸€ã€åˆ›å»º" class="headerlink" title="ä¸€ã€åˆ›å»º"></a>ä¸€ã€åˆ›å»º</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/CHUXUEZHE8210/article/details/146291775">äº Hexo + GitHub Pages çš„æ­å»ºä¸ªäººåšå®¢ç½‘ç«™çš„è¯¦ç»†æ•™ç¨‹</a></p>
<h2 id="äºŒã€æ›´æ–°"><a href="#äºŒã€æ›´æ–°" class="headerlink" title="äºŒã€æ›´æ–°"></a>äºŒã€æ›´æ–°</h2><p>åšå®¢çš„<strong>æºç </strong>ï¼ˆMarkdownæ–‡ç« ã€ä¸»é¢˜ã€é…ç½®ç­‰ï¼‰é€šå¸¸å­˜æ”¾åœ¨ä¸€ä¸ªGitHubä»“åº“ä¸­ï¼Œè€Œé€šè¿‡Hexoç”Ÿæˆçš„<strong>é™æ€ç½‘ç«™æ–‡ä»¶</strong>åˆ™éƒ¨ç½²åˆ°GitHub Pagesï¼ˆé€šå¸¸æ˜¯ <code>username.github.io</code> ä»“åº“çš„ç‰¹å®šåˆ†æ”¯ï¼Œå¦‚ <code>gh-pages</code> æˆ– <code>main</code>ï¼‰ã€‚</p>
<hr>
<h3 id="ğŸ“-æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰"><a href="#ğŸ“-æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰" class="headerlink" title="ğŸ“ æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰"></a>ğŸ“ æ‰‹åŠ¨æ›´æ–°å‘å¸ƒæµç¨‹ï¼ˆæœ¬åœ°å®Œæˆï¼‰</h3><p>è¿™ç§æ–¹å¼éœ€è¦åœ¨è®¡ç®—æœºä¸Šé…ç½®å¥½Hexoç¯å¢ƒï¼ˆNode.js, Git, Hexoç­‰ï¼‰ã€‚</p>
<ol>
<li><p><strong>æ–°å»ºåšæ–‡</strong>ï¼šä½¿ç”¨å‘½ä»¤åˆ›å»ºæ–°çš„Markdownæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;æ–‡ç« é¢˜ç›®&quot;  # æˆ– hexo n &quot;æ–‡ç« é¢˜ç›®&quot;</span><br></pre></td></tr></table></figure>



<p>è¿™ä¼šåœ¨ <code>source/_posts</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>æ–‡ç« é¢˜ç›®.md</code> æ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>ç¼–å†™&#x2F;æ›´æ–°å†…å®¹</strong>ï¼šç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚VS Codeï¼‰ç¼–è¾‘ç”Ÿæˆçš„Markdownæ–‡ä»¶ã€‚</p>
</li>
<li><p><strong>ç”Ÿæˆé™æ€æ–‡ä»¶</strong>ï¼šåœ¨Hexoç«™ç‚¹æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œå°†Markdownè½¬æ¢ä¸ºHTMLç­‰é™æ€èµ„æºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate  # æˆ– hexo g</span><br></pre></td></tr></table></figure>



<p>å¦‚æœéœ€è¦å…ˆ<strong>æ¸…é™¤ç¼“å­˜</strong>å’Œæ—§æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate</span><br><span class="line">```:cite[1]</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>æœ¬åœ°é¢„è§ˆï¼ˆå¯é€‰ä½†æ¨èï¼‰</strong>ï¼šåœ¨éƒ¨ç½²å‰ï¼Œæœ€å¥½å…ˆåœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨æ£€æŸ¥æ•ˆæœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server  # æˆ– hexo s </span><br></pre></td></tr></table></figure>



<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:4000</code> æŸ¥çœ‹ã€‚</p>
</li>
<li><p><strong>éƒ¨ç½²åˆ°GitHub Pages</strong>ï¼šå°†ç”Ÿæˆå¥½çš„é™æ€æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ <code>public</code> ç›®å½•ï¼‰æ¨é€è‡³GitHubä»“åº“çš„ç‰¹å®šåˆ†æ”¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy  # æˆ– hexo d</span><br></pre></td></tr></table></figure>



<p>å¸¸ç”¨çš„ä¾¿æ·ç»„åˆå‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line"></span><br><span class="line">ä¸ºäº†èƒ½ä½¿ç”¨ `hexo deploy` å‘½ä»¤ï¼Œæ‚¨éœ€è¦ï¼š</span><br><span class="line">åœ¨Hexoçš„**ç«™ç‚¹é…ç½®æ–‡ä»¶** (`_config.yml`) ä¸­æ­£ç¡®è®¾ç½®éƒ¨ç½²ä¿¡æ¯:</span><br><span class="line">    deploy:</span><br><span class="line">      type: git</span><br><span class="line">      repo: &lt;æ‚¨çš„GitHubä»“åº“SSHæˆ–HTTPSåœ°å€&gt;  # ä¾‹å¦‚ git@github.com:username/username.github.io.git</span><br><span class="line">      branch: &lt;éƒ¨ç½²åˆ†æ”¯ï¼Œå¦‚gh-pagesæˆ–main&gt;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ul>
<li>ç¡®ä¿å·²å®‰è£… <strong>hexo-deployer-git</strong> æ’ä»¶:cite[4]:cite[6]ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>æ¨é€æºç ï¼ˆé‡è¦ï¼‰</strong>ï¼š<code>hexo deploy</code> é€šå¸¸åªéƒ¨ç½²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ã€‚åˆ«å¿˜äº†å°†æ‚¨çš„<strong>åšå®¢æºç </strong>ï¼ˆMarkdownæ–‡ç« ã€ä¸»é¢˜ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰ä¹Ÿæ¨é€åˆ°GitHubä»“åº“çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¾‹å¦‚ <code>source</code> æˆ– <code>hexo-source</code>ï¼‰ï¼Œä»¥ä¾¿å¤‡ä»½å’Œåœ¨å¤šè®¾å¤‡é—´åŒæ­¥ã€‚</p>
</li>
</ol>
<h2 id="ä¸‰ã€next-å®¢åˆ¶åŒ–é¡µé¢"><a href="#ä¸‰ã€next-å®¢åˆ¶åŒ–é¡µé¢" class="headerlink" title="ä¸‰ã€next å®¢åˆ¶åŒ–é¡µé¢"></a>ä¸‰ã€next å®¢åˆ¶åŒ–é¡µé¢</h2><p>3.1 å­—ä½“è®¾ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="comment">#enable: false</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Uri of fonts host, e.g. https://fonts.googleapis.com (Default).</span></span><br><span class="line">  <span class="attr">host:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font options:</span></span><br><span class="line">  <span class="comment"># `external: true` will load this font family from `host` above.</span></span><br><span class="line">  <span class="comment"># `family: Times New Roman`. Without any quotes.</span></span><br><span class="line">  <span class="comment"># `size: x.x`. Use `em` as unit. Default: 1 (16px)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global font settings used for all elements inside &lt;body&gt;.</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">sans-serif</span></span><br><span class="line">    <span class="attr">size:</span> <span class="number">0.</span><span class="string">725em</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for site title (.site-title).</span></span><br><span class="line">  <span class="attr">title:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;).</span></span><br><span class="line">  <span class="attr">headings:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for posts (.post-body).</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line">  <span class="comment">#Roboto</span></span><br><span class="line">  <span class="attr">codes:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Fira</span> <span class="string">Code</span>  </span><br><span class="line">    <span class="attr">size:</span> <span class="string">.6em</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3.2 é¡µé¢å­—ä½“è®¾ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat  themes/next/source/css/_variables/base.styl</span><br><span class="line">$font-size-base           = (hexo-config(&#x27;font.enable&#x27;) and hexo-config(&#x27;font.global.size&#x27;) is a &#x27;unit&#x27;) ? unit(hexo-config(&#x27;font.global.size&#x27;), em) : .8125em;</span><br><span class="line">//$font-size-base           = .8125em; #ç»Ÿä¸€æ›´æ”¹è¿™ä¸ªå¤§å°</span><br></pre></td></tr></table></figure>

<p>3.3 ç”Ÿæ•ˆå¹¶éƒ¨ç½²</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d <span class="comment">#æ¸…é™¤ç¼“å­˜ä¸”æµè§ˆå™¨ä¹Ÿéœ€æ— ç—•</span></span><br></pre></td></tr></table></figure>

<p>3.4 å›¾ç‰‡é—®é¢˜ä¸è®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‚æ•°å¼€å¯+æ’ä»¶å®‰è£…+ç”¨hexo n æ–‡æ¡£ å»ç”Ÿæˆæ–‡æ¡£æ–‡ä»¶</span></span><br><span class="line">1.å°†_config.yml æ–‡ä»¶ä¸­çš„post_asset_folder é€‰é¡¹è®¾ä¸º <span class="literal">true</span> æ¥æ‰“å¼€</span><br><span class="line">2.npm install https://github.com/CodeFalling/hexo-asset-image --save</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_43401436/article/details/107191688">å›¾ç‰‡è®¾ç½®ä¸ç”Ÿæ•ˆ</a>  <a target="_blank" rel="noopener" href="https://juejin.cn/post/6921750181297782798">æ ‡ç­¾ä¸åˆ†ç±»é…ç½®</a>  <a target="_blank" rel="noopener" href="https://ifonlybean.github.io/note/hexo-site/">ç«™ç‚¹å¯¼èˆª</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¸…æ±‡</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¸…æ±‡</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
